[{"title":"Kafaé‡å¤æ¶ˆè´¹ä¸æ¶ˆæ¯ä¸¢å¤±è§£å†³æ–¹æ¡ˆ","url":"/2023/03/28/Kafaé‡å¤æ¶ˆè´¹ä¸æ¶ˆæ¯ä¸¢å¤±è§£å†³æ–¹æ¡ˆ/","content":"\n# kafkaçš„é‡å¤æ¶ˆè´¹ä¸æ¶ˆæ¯ä¸¢å¤±è§£å†³æ–¹æ¡ˆ\n\nã€€ã€€åœ¨ä½¿ç”¨kafkaçš„è¿‡ç¨‹ä¸­æˆ–è€…é¢è¯•çš„è¿‡ç¨‹ä¸­ï¼Œkafkaçš„æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜å’Œæ¶ˆæ¯ä¸¢å¤±é—®é¢˜éƒ½æ˜¯æ¯”è¾ƒé‡è¦çš„æ–¹é¢ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹é‡å¤æ¶ˆè´¹å’Œæ¶ˆæ¯ä¸¢å¤±çš„è§£å†³æ–¹æ¡ˆï¼Œä¸è®²å…·ä½“åŸç†ã€‚\n\n<!-- more -->\n\n- é‡å¤æ¶ˆè´¹ï¼š\n\n  å‡ºç°é‡å¤æ¶ˆè´¹çš„åœºæ™¯ä¸»è¦æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ Consumer åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è¿›ç¨‹è¢«å¼ºåˆ¶killæ‰æˆ–è€…å‘ç”Ÿå¼‚å¸¸é€€å‡ºï¼ˆæŒ‚æ‰â€¦ï¼‰ï¼Œå¦ä¸€ç§åˆ™æ˜¯Consumeræ¶ˆè´¹çš„æ—¶é—´è¿‡é•¿ã€‚\n\n  - é’ˆå¯¹æ¶ˆè´¹ç«¯æŒ‚æ‰ç­‰åŸå› å¯¼è‡´é‡å¤æ¶ˆè´¹ï¼š\n\n    - å¯¹æ¶ˆæ¯å¢åŠ æ ‡è¯†ï¼Œå¯ä»¥ä¿å­˜åœ¨ç¬¬ä¸‰æ–¹ä»‹è´¨ä¸­ï¼Œä¾‹å¦‚ï¼šRedisï¼ŒMySQLä¸­ï¼Œåœ¨å¤„ç†æ•°æ®ä¹‹å‰å…ˆåˆ¤æ–­ç¬¬ä¸‰æ–¹ä»‹è´¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨è¿™ä¸ªæ ‡è¯†äº†\n\n    - å°†ç‰ˆæœ¬å·ï¼ˆoffsetï¼‰å­˜åˆ°æ¶ˆæ¯ä¸­ï¼Œåœ¨å¤„ç†æ¶ˆæ¯çš„çš„æ—¶å€™ç”¨è¿™ä¸ªç‰ˆæœ¬å·åšä¹è§‚é”ï¼Œåªæœ‰å½“å‰ç‰ˆæœ¬å·å¤§äºä¹‹å‰çš„ç‰ˆæœ¬å·æ‰èƒ½ç»§ç»­å¤„ç†ã€‚\n\n  - é’ˆå¯¹ Consumer æ¶ˆè´¹æ—¶é—´è¿‡é•¿å¯¼è‡´çš„é‡å¤æ¶ˆè´¹ï¼š\n\n    - æé«˜å•æ¡æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ï¼Œæ¯”å¦‚å¯¹æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶æ˜¯å°±å¯ä»¥é‡‡ç”¨å¼‚æ­¥å¤„ç†æˆ–è€…å¤šçº¿ç¨‹çš„æ–¹å¼å¤„ç†æ¶ˆæ¯\n    - æ ¹æ®å®é™…åœºæ™¯å¯å°† `max.poll.interval.ms` (ç­‰å¾…æ–°æ¶ˆæ¯æœ€å¤§æ—¶é•¿)å€¼è®¾ç½®å¤§ä¸€ç‚¹ï¼Œé¿å…ä¸å¿…è¦çš„rebalanceï¼Œæ­¤å¤–å¯é€‚å½“å‡å° `max.poll.records` (ä¸€æ¬¡æ‹‰å–æ¶ˆæ¯æ¡æ•°)çš„å€¼ï¼Œé»˜è®¤å€¼æ˜¯500ï¼Œå¯æ ¹æ®å®é™…æ¶ˆæ¯é€Ÿç‡é€‚å½“è°ƒå°ã€‚\n\n- æ¶ˆæ¯ä¸¢å¤±ï¼š\n\n  æ¶ˆæ¯ä¸¢å¤±çš„åœºæ™¯åœ¨ç”Ÿäº§ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½ä¼šå‘ç”Ÿï¼Œè¿™é‡Œåˆ†åˆ«è¯´æ€ä¹ˆå¤„ç†\n\n  - ç”Ÿäº§ç«¯ï¼šï¼š\n\n    - é€šè¿‡è®¾ç½®ACKæ¨¡å¼æ¥è§£å†³ã€‚0ã€1ã€-1ä¸‰ç§æ¨¡å¼ã€‚\n      1. 0ï¼šä¸è¿›è¡Œæ¶ˆæ¯ç¡®è®¤\n      2. 1ï¼šleaderç¡®è®¤å³å¯\n      3. -1ï¼šleader å’Œ follower éƒ½è¦ç¡®è®¤\n    - å¼•å…¥é‡è¯•æœºåˆ¶ï¼Œè®¾ç½®é‡è¯•æ¬¡æ•°å’Œé‡è¯•é—´éš”\n    - é‡‡ç”¨é›†ç¾¤ï¼Œkafkaçš„å¤šå‰¯æœ¬æœºåˆ¶å¯ä»¥ä¿è¯é›†ç¾¤çš„å¯é æ–°ï¼Œå½“ leader å®•æœºåï¼Œä¼šæœ‰æ–°çš„ follower é€‰ä¸¾æ™‹å‡ä¸ºleader\n\n  - æ¶ˆè´¹ç«¯ï¼š\n\n    ã€€ã€€æ¶ˆè´¹ç«¯å‡ºç°æ¶ˆæ¯ä¸¢å¤±é—®é¢˜çš„ä¸»è¦åœºæ™¯å°±æ˜¯æ¶ˆè´¹æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œä½†æ˜¯æ­¤æ—¶ offset å·²ç»æäº¤äº†ï¼Œè¿™å°±å¯¼è‡´äº†æ¶ˆæ¯ä¸¢å¤±ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¥½è§£å†³ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è§£å†³æ–¹æ¡ˆï¼š\n\n    - kafka çš„ offset æäº¤åˆ†ä¸º è‡ªåŠ¨ å’Œ æ‰‹åŠ¨ ä¸¤ç§ï¼Œè€Œå¼•èµ·æ¶ˆæ¯ä¸¢å¤±å¤§æ¦‚ç‡æ˜¯å› ä¸ºè‡ªåŠ¨æäº¤äº† offsetï¼Œæˆ‘ä»¬å¯å·²å°† offset è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤ï¼Œåœ¨æˆ‘ä»¬æ¶ˆè´¹å®Œæ¶ˆæ¯ï¼Œå¤„ç†å®Œä¸šåŠ¡ä¹‹ååœ¨è¿›è¡Œæäº¤ offset çš„æ“ä½œã€‚\n","tags":["kafka"],"categories":["æŠ€æœ¯é—®é¢˜","kafka"]},{"title":"SpringCloudAlibaba-Seataåˆ†å¸ƒå¼äº‹åŠ¡","url":"/2023/03/26/SpringCloudAlibaba-Seataåˆ†å¸ƒå¼äº‹åŠ¡/","content":"\n# ä¸€ã€ä»€ä¹ˆæ˜¯Seata\n\nã€€ã€€Seataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œæä¾›åˆ†å¸ƒå¼æ¡†æ¶çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼Œä¸ºç”¨æˆ·æä¾›äº† ATï¼ŒTCCï¼ŒSAGAå’ŒXAäº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ\n\n<!-- more -->\n\nã€€ã€€åœ¨äº†è§£åˆ†å¸ƒå¼äº‹åŠ¡ä¹‹å‰æˆ‘ä»¬è¦å…ˆäº†è§£ä¸€ä¸ªåè®®ï¼Œå°±æ˜¯**2PC** ä¸¤é˜¶æ®µæäº¤åè®®ï¼Œç›®å‰å¸‚é¢ä¸Šé¢çš„å¤šç§åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆä¹Ÿéƒ½æ˜¯é‡‡ç”¨äº†è¿™ç§åè®®ï¼Œé‚£ä»€ä¹ˆæ˜¯ **2PC** ä¸¤é˜¶æ®µæäº¤åè®®å‘¢ã€‚\n\nã€€ã€€**2PC** å°±æ˜¯å°†äº‹åŠ¡çš„æäº¤åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š**perpare**ï¼ˆé¢„å¤„ç†ï¼‰ã€**commit**ï¼ˆæäº¤ï¼‰ä¸¤ä¸ªé˜¶æ®µã€‚\n\nã€€ã€€åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ä¼šå…ˆç”±äº‹åŠ¡åè°ƒè€…è¿›è¡Œé¢„å¤„ç†é˜¶æ®µï¼Œå°±æ˜¯å…ˆå‘äº‹åŠ¡çš„å‚ä¸è€…å‘å‡ºé€šçŸ¥ï¼Œäº‹åŠ¡çš„çš„å‚ä¸è€…æ¥åˆ°é€šçŸ¥åä¼šè¿›è¡Œé¢„å¤„ç†åˆ¤æ–­æ˜¯å¦æ»¡è¶³æäº¤äº‹åŠ¡çš„æ¡ä»¶ï¼Œé¢„å¤„ç†åä¼šè¿”å›ç»™äº‹åŠ¡åè°ƒè€…ä¸€ä¸ªåº”ç­”ã€‚å½“æ‰€æœ‰çš„å‚ä¸è€…éƒ½å¤„ç†å®Œæˆå¹¶å›å¤åº”ç­”å°±ä¼šè¿›è¡Œä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æäº¤æˆ–å›æ»šçš„é˜¶æ®µ\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](1.png)\n\n# äºŒã€Seataçš„ä¸‰å¤§è§’è‰²\n\n1. **TC(Transaction coordinator) - äº‹åŠ¡åè°ƒè€…**\n\n   ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»š\n\n2. **TM(Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨**\n\n   å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹ã€æäº¤ã€å›æ»šå…¨å±€äº‹åŠ¡\n\n3. **RM(Resource Manager) - èµ„æºç®¡ç†å™¨**\n\n   ç®¡ç†åˆ†æ”¯å®ç‰©å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»š\n\n<font color=\"red\">å…¶ä¸­ï¼ŒTC ä¸ºå•ç‹¬éƒ¨ç½²çš„ Server æœåŠ¡ç«¯ï¼ŒTMå’ŒRMä¸ºåµŒå…¥åˆ°åº”ç”¨ä¸­çš„ Client å®¢æˆ·ç«¯</font>\n\n# ä¸‰ã€ATæ¨¡å¼ä¸TCCæ¨¡å¼\n\n## 1ã€ATæ¨¡å¼ï¼ˆauto transcationï¼‰\n\nã€€ã€€AT æ¨¡å¼æ˜¯ä¸€ç§æ— å…¥ä¾µçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œé˜¿é‡ŒSeataæ¡†æ¶å®ç°äº†è¯¥æ¨¡å¼ã€‚\n\nã€€ã€€åœ¨ AT æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åªéœ€è¦å…³æ³¨è‡ªå·±çš„ â€œä¸šåŠ¡SQLâ€ï¼Œç”¨æˆ·çš„â€œä¸šåŠ¡SQLâ€ä½œä¸ºç¬¬ä¸€é˜¶æ®µï¼ŒSeataæ¡†æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆäº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤å’Œå›æ»šæ“ä½œã€‚\n\n### 1.ä¸€é˜¶æ®µ\n\nã€€ã€€åœ¨ä¸€é˜¶æ®µï¼ŒSeataä¼šæ‹¦æˆªâ€œä¸šåŠ¡SQLâ€ï¼Œé¦–å…ˆè§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆä¸€ä¸ªâ€œbefore imageâ€ï¼Œç„¶åæ‰§è¡Œâ€œä¸šåŠ¡SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°åï¼Œå†å°†å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªè¡Œé”ï¼Œé¿å…å…¶ä»–ä¸šåŠ¡æ“ä½œè¯»å–åˆ°è¿™æ¡æ•°æ®ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæäº¤åŸå­æ€§ã€‚\n\nã€€ã€€è¿™å°±æ˜¯ä¸€é˜¶æ®µæäº¤ï¼Œå¯ä»¥ç†è§£ä¸ºåœ¨ä¸€é˜¶æ®µå°±å·²ç»å°†æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„SQLæ‰§è¡Œäº†ï¼Œä¸è¿‡æ˜¯åŒæ—¶ä¿å­˜äº†SQLæ‰§è¡Œå‰åçš„æ•°æ®å¿«ç…§ä»¥åŠè¡Œé”ã€‚æ‰§è¡Œå‰åçš„å¿«ç…§æ•°æ®å°±æ˜¯ä¿è¯æ•°æ®çš„å›æ»šã€æäº¤ã€‚è¡Œé”åˆ™æ˜¯å› ä¸ºæˆ‘ä»¬çš„SQLå·²ç»æ‰§è¡Œäº†ï¼Œä½†æ˜¯æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡è¿˜æœªå®Œæˆï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡è¯»å–ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](2.png)\n\n### 2.äºŒé˜¶æ®µæäº¤\n\nã€€ã€€äºŒé˜¶æ®µå¦‚æœæ˜¯æäº¤çš„è¯ï¼Œå› ä¸ºâ€œä¸šåŠ¡SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œæ‰€ä»¥ Seata æ¡†æ¶åªéœ€è¦å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ é™¤æ‰ï¼Œå°±å®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](3.png)\n\n### 3.äºŒé˜¶æ®µå›æ»š\n\nã€€ã€€äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œä¸šåŠ¡SQLâ€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚å›æ»šçš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ä¸€é˜¶æ®µä¸­åˆ›å»ºçš„â€œbefore imageâ€å¿«ç…§æ•°æ®æ¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†æ˜¯è¿˜åŸä¹‹å‰è¦å…ˆæ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€ä¸â€œbefore imageâ€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯æ˜åˆè„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†äº†ã€‚\n\nã€€ã€€å…¶å®è„å†™åŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½å‘ç”Ÿçš„ï¼Œå› ä¸ºåœ¨ä¸€é˜¶æ®µä¸­æ‰§è¡Œâ€œä¸šåŠ¡SQLâ€œåå·²ç»è¿›è¡Œäº†è¡Œé”çš„æ“ä½œã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](4.png)  \n\n## 2ã€TCCæ¨¡å¼ï¼ˆTry Confirm Cancelï¼‰\n\n### 1.äºŒé˜¶æ®µæäº¤å¤„ç†\n\nã€€ã€€TCC æ¨¡å¼éœ€è¦ç”¨æˆ·æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯å®ç°Tryã€Confirm å’Œ Cancel ä¸‰ä¸ªæ“ä½œï¼›äº‹åŠ¡å‘èµ·æ–¹åœ¨ç¬¬ä¸€é˜¶æ®µæ‰§è¡Œ Try æ–¹å¼ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µæäº¤æ‰§è¡Œ Confirm æ–¹æ³•ï¼ŒäºŒé˜¶æ®µå›æ»šæ‰§è¡Œ Cancel æ–¹æ³•ã€‚\n\nã€€ã€€å°±æ˜¯ TCC æ¨¡å¼å°±æ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µä¼šé€šçŸ¥æ‰€æœ‰äº‹åŠ¡çš„å‚ä¸è€…å°è¯•æ‰§è¡Œï¼Œå‡†å¤‡æ‰€éœ€èµ„æºã€‚ç¬¬äºŒé˜¶æ®µæ‰§è¡Œä¸šåŠ¡ä¿®æ”¹æ•°æ®åº“ï¼Œå‘ç”Ÿé”™è¯¯è¿›è¡Œå›æ»šï¼Œå›å¤å·²ä¿®æ”¹æ•°æ®åº“ã€‚\n\nã€€ã€€ä¾‹å¦‚ï¼šæ”¯ä»˜è®¢å•ä¸å‡åº“å­˜çš„ä¸šåŠ¡åœºæ™¯\n\n- ä¸€é˜¶æ®µï¼šå°†è®¢å•çš„çŠ¶æ€ä¿®æ”¹ä¸º â€œæ”¯ä»˜ä¸­â€ï¼Œåº“å­˜æœåŠ¡è®°å½•éœ€è¦å‡å°‘çš„åº“å­˜æ•°é‡\n- äºŒé˜¶æ®µï¼š\n  - æäº¤ï¼šå°†è®¢å•çš„çŠ¶æ€ä¿®æ”¹ä¸º â€œå·²æ”¯ä»˜â€ï¼Œåº“å­˜æœåŠ¡åˆ™å‡å°‘ç›¸åº”çš„åº“å­˜æ•°é‡\n  - å–æ¶ˆï¼šå¦‚æœåœ¨ä¸€é˜¶æ®µæˆ–è€…äºŒé˜¶æ®µæäº¤çš„ä¸šåŠ¡å¤„ç†ä¸­å‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿›è¡Œå›æ»šæ“ä½œï¼Œä¹Ÿå°±æ˜¯å°†è®¢å•çŠ¶æ€æ¢å¤ï¼Œå°†å·²ç»å‡å°‘çš„åº“å­˜åŠ å›å»æˆ–è€…æ¸…ç©ºä¸€é˜¶æ®µä¸­è®°å½•çš„éœ€è¦å‡å°‘çš„åº“å­˜æ•°é‡ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](5.png)\n","tags":["Seata"],"categories":["æŠ€æœ¯å­¦ä¹ ","SpringCloudAlibaba","Seata"]},{"title":"Sentinel&Nacosæ³¨å†Œä¸ºLinuxæœåŠ¡","url":"/2023/03/26/Sentinel-Nacosæ³¨å†Œä¸ºLinuxæœåŠ¡/","content":"\n# ä¸€ã€ç¯å¢ƒå‡†å¤‡\n\nå› ä¸ºæ¯æ¬¡å¯åŠ¨æœåŠ¡å™¨/è™šæ‹Ÿæœºéƒ½è¦é‡æ–°å¯åŠ¨Nacoså’ŒSentinelç­‰ä¸€å †ä¸œè¥¿ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿å°†Nacoså’ŒSentinelæ³¨å†Œä¸ºLinuxçš„æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯ã€‚\n\né¦–å…ˆæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šé¢å‡†å¤‡ä»¥ä¸‹æ–‡ä»¶ï¼š\n\n- Nacos\n- Sentinel\n\n<!-- more -->\n\n# äºŒã€ç¼–å†™Nacos.serviceä¸Sentinel.serviceæ–‡ä»¶\n\né¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨`/usr/lib/systemd/system/`ç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹æœåŠ¡æ–‡ä»¶\n\nNacos.serviceæ–‡ä»¶å¦‚ä¸‹ï¼š\n\n~~~shell\n[Unit]\nDescription=Nacos service\nAfter=network.target\n\n[Service]\nPrivateTmp=true\nRestart=on-failure\nRestartSec=5\nType=forking\nExecStart=/bin/bash /home/nacos/bin/startup.sh  #å¯åŠ¨å‘½ä»¤ å¯åŠ¨è„šæœ¬æ¢æˆè‡ªå·±å¯¹åº”çš„ç›®å½•å³å¯\nExecStop=/bin/bash /home/nacos/bin/shutdown.sh #åœæ­¢å‘½ä»¤ åœæ­¢è„šæœ¬æ¢æˆè‡ªå·±å¯¹åº”çš„ç›®å½•å³å¯\n\n[Install]\nWantedBy=multi-user.target\n~~~\n\nSentinel.service\n\n~~~shell\n[Unit]\nDescription=Sentinel-Dashboard service\nAfter=network.target\n\n[Service]\nPrivateTmp=true\nRestart=always\nRestartSec=5\nExecStart=/usr/software/jdk-11.0.14/bin/java -Dserver.port=8858 -Dproject.name=sentinel-dashboard -jar /home/sentinel-dashboard/sentinel-dashboard-1.8.6.jar  #å¯åŠ¨å‘½ä»¤\nExecStop=/usr/bin/kill -15  $MAINPID #åœæ­¢å‘½ä»¤\n\n[Install]\nWantedBy=multi-user.target\n~~~\n\nè¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œserviceæ–‡ä»¶ä¸­çš„Javaç¯å¢ƒä¸ºä½ è‡ªå·±æœåŠ¡å™¨ä¸­çš„jdkç»å¯¹ç›®å½•\n\n# ä¸‰ã€å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯\n\n1. å¯åŠ¨æœåŠ¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n   `systemctl start nacos.service`\n\n   `systemctl start sentinel.service`\n\n2. åœæ­¢æœåŠ¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n   `systemctl stop nacos.service`\n\n   `systemctl stop sentinel.service`\n\n3. è®¾ç½®æœåŠ¡å¼€æœºè‡ªå¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n   `systemctl enable nacos.service`\n\n   `systemctl enable sentinel.service`\n\n4. å…³é—­æœåŠ¡å¼€å¯è‡ªå¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n   `systemctl disable nacos.service`\n\n   `systemctl disable sentinel.service` \n\nå¦‚æœå¯¹æœåŠ¡æ–‡ä»¶è¿›è¡Œäº†ç¼–è¾‘ï¼Œåœ¨ç¼–è¾‘åéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°åŠ è½½æœåŠ¡æ–‡ä»¶ï¼š\n\n`systemctl daemon-reload nacos.service`\n\n`systemctl daemon-reload sentinel.service`\n\n\n\næŸ¥çœ‹æœåŠ¡æ—¥å¿—ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n\n`journalctl -f -u æœåŠ¡å`\n\n-f å‚æ•°ä¸ºæ»šåŠ¨å®æ—¶æ‰“å°æ—¥å¿—ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥ä¸åŠ ã€‚\n","tags":["LinuxæœåŠ¡æ³¨å†Œ"],"categories":["Linux","æœåŠ¡æ³¨å†Œ"]},{"title":"SpringCloudAlibaba-SentinelæœåŠ¡é«˜å¯ç”¨","url":"/2023/03/05/SpringCloudAlibaba-SentinelæœåŠ¡é«˜å¯ç”¨/","content":"\n# ä¸€ã€ä»€ä¹ˆæ˜¯Sentinel\n\nSentinelæ˜¯Alibabaå¼€æºçš„ï¼Œé¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„é«˜å¯ç”¨ç»„ä»¶ã€‚å…¶æ‹¥æœ‰å¤šç»´åº¦çš„æµæ§é™çº§èƒ½åŠ›ï¼Œä¸»è¦ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»é™æµã€æµé‡æ•´å½¢ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ã€çƒ­ç‚¹é˜²æŠ¤ç­‰å¤šä¸ªç»´åº¦æ¥å¸®åŠ©å¼€å‘è€…ç¨³å®šå¾®æœåŠ¡çš„ç¨³å®šæ€§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡[å®˜ç½‘](https://github.com/alibaba/Sentinel/wiki/)çš„æ–‡æ¡£äº†è§£åˆ°æ›´å¤šã€‚\n\n<!--more-->\n\n# äºŒã€ä¾èµ–å¼•å…¥é…ç½®\n\nè¿™é‡Œåªæ˜¯ä½¿ç”¨äº†å•çº¯çš„Sentinelï¼Œå¹¶æ²¡æœ‰æ•´åˆSpringCloudAlibabaï¼Œåé¢ä¼šå†™åˆ°æ•´åˆåˆ°SpringCloudAlibabaæ¡†æ¶çš„é¡¹ç›®ä¸­ã€‚\n\n1. ä¾èµ–å¼•å…¥\n\n   ~~~xml\n   <!-- sentinel -->\n   <dependency>\n       <groupId>com.alibaba.csp</groupId>\n       <artifactId>sentinel-core</artifactId>\n   </dependency>\n   <!-- ä½¿ç”¨sentinelçš„æ³¨è§£ -->\n   <dependency>\n       <groupId>com.alibaba.csp</groupId>\n       <artifactId>sentinel-annotation-aspectj</artifactId>\n   </dependency>\n   ~~~\n\n2. å¦‚æœè¦ä½¿ç”¨Sentinelçš„æ³¨è§£è¿˜éœ€è¦å°†SentinelResourceAspectç±»å‹çš„beanåŠ å…¥åˆ°springçš„å®¹å™¨ä¸­\n\n   ~~~java\n   /**\n    * @ClassName SentinelConfig\n    * @Description\n    * @Author sunyu\n    * @Date 2023/3/6 21:56\n    * @Version 1.0\n    **/\n   @Component\n   public class SentinelConfig {\n   \n   \n       /**\n        * @Description é…ç½®å¯åŠ¨Sentinelçš„æ³¨è§£\n        * @Author sy\n        * @Date 2023/3/6\n        * @Version 1.0\n        **/\n       @Bean\n       public SentinelResourceAspect sentinelResourceAspect() {\n           return new SentinelResourceAspect();\n       }\n   }\n   ~~~\n\n   \n\n# ä¸‰ã€åŸºäºä»£ç æ§æµå’Œé™çº§çš„ç¤ºä¾‹\n\nè¿™é‡Œåªæ¼”ç¤ºç®€å•çš„æµæ§å’Œé™çº§çš„ä»£ç ç¤ºä¾‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ **æµæ§è§„åˆ™ä¸€èˆ¬åœ¨è¢«è°ƒç”¨ç«¯** è€Œ **ç†”æ–­é™çº§è§„åˆ™ä¸€èˆ¬åœ¨è°ƒç”¨ç«¯**\n\n```java\n/**\n * @ClassName SentinelContoller\n * @Description Sentinel æµæ§å®ä¾‹\n * @Author sunyu\n * @Date 2023/3/5 20:32\n * @Version 1.0\n **/\n@Slf4j\n@RestController\n@RequestMapping(value = \"/sentinel\")\npublic class SentinelController {\n\n    private static final String RESOURCE_NAME = \"hello\";\n\n    private static final String USER_RESOURCE_NAME = \"user\";\n\n    private static final String DEGRADE_RESOURCE_NAME = \"degrade\";\n\n    /**\n     * @Description æµ‹è¯•æµæ§æ¥å£\n     * @Author sy\n     * @Date 2023/3/6\n     * @Version 1.0\n     **/\n    @GetMapping(\"/hello\")\n    public String hello() {\n        Entry entry = null;\n        try {\n            // sentinel é’ˆå¯¹èµ„æºè¿›è¡Œçš„é™åˆ¶\n            entry = SphU.entry(RESOURCE_NAME);\n            String result = \"Hello World!\";\n            log.info(result);\n            return result;\n        } catch (BlockException e) {\n            // è‡ªæ„¿è®¿é—®ç»„ç»‡ï¼Œè¢«é™æµæˆ–è¢«é™çº§\n            // è¿›è¡Œç›¸åº”çš„å¤„ç†æ“ä½œ\n            log.info(\"è¢«é™æµäº†\");\n            return \"è¢«æµæ§äº†ï¼\";\n        } catch (Exception e) {\n            // è‹¥éœ€è¦é…ç½®é™çº§è§„åˆ™ï¼Œéœ€è¦é€šè¿‡è¿™ç§æ–¹å¼è®°å½•ä¸šåŠ¡å¼‚å¸¸\n            Tracer.traceEntry(e, entry);\n        }finally {\n            if (entry != null) {\n                entry.exit();\n            }\n        }\n        return null;\n    }\n\n\n    /**\n     * @Description æµ‹è¯•æµæ§æ³¨è§£æ¥å£\n     * @SentinelResource æ”¹å–„æ¥å£ä¸­èµ„æºå®šä¹‰å’Œè¢«æµæ§é™çº§åçš„å¤„ç†æ–¹æ³•\n     * value: å®šä¹‰çš„èµ„æºåç§°\n     * blockHandler: è¢«æµæ§é™çº§åçš„å¤„ç†æ–¹æ³•(é»˜è®¤è¯¥æ–¹æ³•å¿…é¡»ç”Ÿå‘½åœ¨åŒä¸€ä¸ªç±»ä¸­)ï¼ˆä¼˜å…ˆçº§é«˜äºfallbackï¼‰\n     * blockHandlerClass: å¯ä»¥å°†å¤„ç†æ–¹æ³•æ”¾åˆ°åˆ«çš„ç±»ä¸­\n     * fallback: å¼‚å¸¸çš„å¤„ç†æ–¹æ³•\n     * fallbackClass: å¯ä»¥å¼‚å¸¸çš„å¤„ç†æ–¹æ³•æ”¾åœ¨ç™½çš„ç±»ä¸­\n     * ExceptionsToIgnoreï¼šæ’é™¤å¼‚å¸¸ä¸è¢«fallbackæ‹¦æˆª\n     * @Author sy\n     * @Date 2023/3/6\n     * @Version 1.0\n     **/\n    @GetMapping(\"/user\")\n    @SentinelResource(value = USER_RESOURCE_NAME, blockHandler = \"blockHandleForUser\")\n    public String user(String id) {\n        log.info(\"user:\" + id);\n        return \"user\";\n    }\n\n    /**\n     * @Description è¢«æµæ§åçš„å¤„ç†æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¿…é¡»æ˜¯ç”±publicå£°æ˜çš„ï¼Œå…¥å‚ä¸è¿”å›å€¼è¦ä¸åŸæ–¹æ³•ä¸€è‡´\n     * @Author sy\n     * @Date 2023/3/6\n     * @Version 1.0\n     **/\n    public String blockHandleForUser(String id, BlockException e) {\n        e.printStackTrace();\n        log.info(\"userè¢«æµæ§äº†\");\n        return \"userè¢«æµæ§äº†\";\n    }\n\n\n    /**\n     * @Description æµ‹è¯•ç†”æ–­é™çº§æ¥å£\n     * @Author sy\n     * @Date 2023/3/6\n     * @Version 1.0\n     **/\n    @GetMapping(\"/degrade\")\n    @SentinelResource(value = DEGRADE_RESOURCE_NAME, entryType = EntryType.IN, blockHandler = \"blockHandleForDegrade\")\n    public String degrade() {\n        int s = 1 / 0;\n        return \"degrade\";\n    }\n\n    /**\n     * @Description è¢«ç†”æ–­é™çº§åçš„å¤„ç†æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¿…é¡»æ˜¯ç”±publicå£°æ˜çš„ï¼Œå…¥å‚ä¸è¿”å›å€¼è¦ä¸åŸæ–¹æ³•ä¸€è‡´\n     * @Author sy\n     * @Date 2023/3/6\n     * @Version 1.0\n     **/\n    public String blockHandleForDegrade(BlockException e) {\n        e.printStackTrace();\n        log.info(\"userè¢«ç†”æ–­äº†\");\n        return \"userè¢«ç†”æ–­äº†\";\n    }\n\n\n    /**\n     * @Description åˆå§‹åŒ–æµæ§è§„åˆ™\n     * @PostConstruct æ³¨è§£æ˜¯Springçš„æ³¨è§£ï¼Œä½œç”¨å°±æ˜¯å½“å½“å‰ç±»è¢«åŠ è½½çš„æ—¶å€™å°±ä¼šåˆå§‹åŒ–å½“å‰è¿™ä¸ªæ–¹æ³•\n     * @Author sy\n     * @Date 2023/3/5\n     * @Version 1.0\n     **/\n    @PostConstruct\n    private static void initFlowRules() {\n        // æµæ§è§„åˆ™\n        List<FlowRule> rules = new ArrayList<>();\n        // å®šä¹‰æµæ§å¯¹è±¡\n        FlowRule ruleHello = new FlowRule();\n        // è®¾ç½®å—ä¿æŠ¤çš„èµ„æº\n        ruleHello.setResource(RESOURCE_NAME);\n        // è®¾ç½®æµæ§è§„åˆ™ç­–ç•¥ QPS/çº¿ç¨‹æ•°\n        ruleHello.setGrade(RuleConstant.FLOW_GRADE_QPS);\n        // é˜ˆå€¼\n        ruleHello.setCount(1);\n        rules.add(ruleHello);\n\n        // ä¸ºä½¿ç”¨@SentinelResouceæ³¨è§£çš„æ¥å£å®šä¹‰æµæ§è§„åˆ™\n        // å®šä¹‰æµæ§å¯¹è±¡\n        FlowRule ruleUser = new FlowRule();\n        // è®¾ç½®å—ä¿æŠ¤çš„èµ„æº\n        ruleUser.setResource(USER_RESOURCE_NAME);\n        // è®¾ç½®æµæ§è§„åˆ™ç­–ç•¥ QPS/çº¿ç¨‹æ•°\n        ruleUser.setGrade(RuleConstant.FLOW_GRADE_QPS);\n        // é˜ˆå€¼\n        ruleUser.setCount(1);\n        rules.add(ruleUser);\n        // åŠ è½½é…ç½®å¥½çš„è§„åˆ™\n        FlowRuleManager.loadRules(rules);\n\n    }\n\n    /**\n     * @Description åˆå§‹åŒ–é™çº§è§„åˆ™\n     * @Author sy\n     * @Date 2023/3/6\n     * @Version 1.0\n     **/\n    @PostConstruct\n    public void initDegradeRule() {\n        List<DegradeRule> list = new ArrayList<>();\n        // å®šä¹‰é™çº§è§„åˆ™å¯¹è±¡\n        DegradeRule degradeRule = new DegradeRule();\n        // å®šä¹‰é™çº§è§„åˆ™èµ„æº\n        degradeRule.setResource(DEGRADE_RESOURCE_NAME);\n        // è®¾ç½®ç†”æ–­é™çº§çš„ç­–ç•¥ï¼šå¼‚å¸¸æ•°   å¤šç§ç­–ç•¥ï¼šæ…¢è°ƒç”¨ç­–ç•¥ã€å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°ç­–ç•¥\n        degradeRule.setGrade(RuleConstant.DEGRADE_GRADE_EXCEPTION_COUNT);\n        // é˜ˆå€¼\n        degradeRule.setCount(2);\n        // ç†”æ–­æ—¶é•¿  ç†”æ–­è¿‡åä¼šè¿›å…¥åŠå¼€çŠ¶æ€ï¼Œå›å¤è°ƒç”¨çš„ç¬¬ä¸€æ¬¡è°ƒç”¨å°±å‘ç”Ÿå¼‚å¸¸çš„è¯ä¼šç›´æ¥è¿›è¡Œç†”æ–­ï¼Œä¸ä¼šæ ¹æ®è¿™é‡Œçš„é…ç½®è¿›è¡Œåˆ¤æ–­\n        degradeRule.setTimeWindow(10);\n        // ç†”æ–­è§¦å‘çš„æœ€å°è¯·æ±‚æ•°ï¼Œè¯·æ±‚æ•°å°äºè¯¥å€¼æ—¶å³ä½¿å¼‚å¸¸æ¯”ç‡è¶…å‡ºé˜ˆå€¼ä¹Ÿä¸ä¼šç†”æ–­\n        degradeRule.setMinRequestAmount(2);\n        // é—´éš”æ—¶é•¿ï¼Œå¯ä»¥ç†è§£ä¸ºè§¦å‘å¼‚å¸¸éœ€è¦åœ¨è¿™ä¸ªæ—¶é—´é—´éš”å†…\n        degradeRule.setStatIntervalMs(60 * 1000);\n        list.add(degradeRule);\n\n        // åŠ è½½é™çº§è§„åˆ™\n        DegradeRuleManager.loadRules(list);\n\n    }\n\n}\n```\n\nåˆ°è¿™é‡Œç®€å•çš„é€šè¿‡ä»£ç æ–¹å¼å®šä¹‰æµæ§å’Œç†”æ–­é™çº§è§„åˆ™çš„ç¤ºä¾‹å°±å®Œæˆäº†ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ä¸‹é¢çš„æ¥å£æµ‹è¯•ï¼š\n\n- åŸºäºcatchçš„æ–¹å¼æ•è·æµæ§ï¼šxxxxxxxx/hello\n- åŸºäº@SentinelResource çš„æ–¹å¼æ•è·æµæ§ï¼šxxxxxxx/user\n- ç†”æ–­é™çº§ï¼šxxxxxxx/degrade\n\n# å››ã€æ•´åˆåˆ°SpringCloudAlibabaæ¶æ„çš„é¡¹ç›®ä¸­\n\nè¿™é‡Œå¯ä»¥å‚è€ƒSpringCloudAlibabaçš„[å®˜æ–¹æ–‡æ¡£](https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel)æ¥åš\n\n## 1ã€å¼•å…¥ä¾èµ–\n\nè¿™é‡Œå…ˆå°†æˆ‘ä»¬ä¹‹å‰å¼•å…¥çš„ä¾èµ–æ³¨é‡Šæ‰ï¼Œåœ¨åŠ å…¥ğŸ‘‡ğŸ»çš„ä¾èµ–ï¼Œåœ¨æµ‹è¯•ä¸€ä¸‹ä¾ç„¶æ˜¯å¯ä»¥å®ç°ä¸Šé¢çš„æµæ§å’Œç†”æ–­é™çº§è§„åˆ™çš„ã€‚\n\n~~~xml\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\n</dependency>\n~~~\n\n## 2ã€åŠ å…¥Sentinel æ§åˆ¶å°\n\næˆ‘ä»¬å¯ä»¥ä»[sentinel tagé¡µé¢](https://github.com/alibaba/Sentinel/tags)è·å–åˆ°æƒ³è¦çš„ç‰ˆæœ¬\n\n1. é€šè¿‡ä¸€ä¸‹å‘½ä»¤å¯åŠ¨sentinel dashboardæœåŠ¡ï¼Œå¯ä»¥æ ¹æ®æˆ‘ä»¬çš„å®é™…æƒ…å†µä¿®æ”¹ç«¯å£ï¼Œæ›´å¤šç”¨æ³•åŠå‚æ•°å¯ä»¥æŸ¥çœ‹[sentinel-dashboardæ–‡æ¡£](https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0)\n\n   ~~~java\n   java -Dserver.port=8858 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar\n   ~~~\n\n   è®¿é—®8858ç«¯å£å°±å¯ä»¥è¿›å…¥åˆ°æ§åˆ¶å°é¡µé¢äº†\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](1.png)\n\n## 3ã€å°†æœåŠ¡æ³¨å†Œè¿›å…¥åˆ°Sentinelæ§åˆ¶å°ä¸­\n\nä¸€å…±æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯é€šè¿‡å¯åŠ¨å‚æ•°é…ç½®å’Œé€šè¿‡ymlæ–‡ä»¶é…ç½®\n\n1. é€šè¿‡å¯åŠ¨å‚æ•°é…ç½®ï¼šåœ¨å¯åŠ¨å‚æ•°ä¸­æ·»åŠ `-Dcsp.sentinel.dashboard.server=sentinelæœåŠ¡çš„ip:8858`\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](2.png)\n\n   å½“æˆ‘ä»¬å¯åŠ¨åä¼šå‘ç°æœåŠ¡å¹¶æ²¡æœ‰æ³¨å†Œåˆ°Sentinelçš„æ§åˆ¶å°ä¸­ï¼Œè¿™æ—¶æˆ‘ä»¬åªéœ€è¦è®¿é—®å‡ æ¬¡è¦æ³¨å†Œè¿›å»çš„æœåŠ¡çš„æ¥å£ï¼Œä½ å°±ä¼šå‘ç°æœåŠ¡å·²ç»æ³¨å†Œåˆ°Sentinelä¸­äº†\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](3.png)\n\n2. é€šè¿‡ymlé…ç½®ï¼šåœ¨ymlä¸­æ·»åŠ ğŸ‘‡ğŸ»é…ç½®ï¼Œè¿™é‡Œè¦æ³¨æ„client-ipçš„ä¸è¦å†™é”™ï¼Œæˆ‘å°±å› ä¸ºæ²¡æœ‰å†™å’Œå†™æˆäº†SentinelæœåŠ¡ç«¯çš„ipå¯¼è‡´åº”ç”¨æœåŠ¡æ³¨å†Œä¸åˆ°Sentinelï¼Œå¡äº†ä¸€æ™šä¸Š\n\n   ```yaml\n   spring:\n     cloud:\n       sentinel:\n         transport:\n           # å®¢æˆ·ç«¯ipï¼Œå°±æ˜¯ä½ è¦æ³¨å†Œè¿›Sentinelçš„æœåŠ¡çš„æ‰€åœ¨ip\n           client-ip: 192.168.0.101\n           # Sentinelæ§åˆ¶ipç«¯å£\n           dashboard: 192.168.0.107:8858\n         # æœåŠ¡å¯åŠ¨è‡ªåŠ¨æ³¨å†Œåˆ°Sentinelçš„æœåŠ¡ç«¯\n         eager: true\n   ```\n   \n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](4.png)\n\n# äº”ã€æ•´åˆOpenFeign\n\n## 1ã€æ·»åŠ ç›¸å…³ä¾èµ–\n\n```xml\n<!--nacosæœåŠ¡æ³¨å†Œå‘ç°-->\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n<!-- openfeign -->\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n<!-- sentinel -->\n<dependency>\n<groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\n    <version>${alibaba.sentinel.version}</version>\n</dependency>\n```\n\nä¸Šé¢ä¸‰ä¸ªä¾èµ–æ˜¯å¿…é¡»çš„ã€‚\n\n## 2ã€é…ç½®ymlé…ç½®æ–‡ä»¶\n\nå¼€å¯OpenFeignå¯¹Sentinelçš„æ”¯æŒ\n\n~~~yml\nfeign:\n  sentinel:\n    enabled: true\n~~~\n\n## 3ã€å®ç°ä½ çš„OpenFeignæ¥å£ç±»\n\n~~~java\n@Component\npublic class StockSentinelFallback implements Stock{\n    @Override\n    public String reduceStock() {\n        return null;\n    }\n\n    @Override\n    public String reduceStock2() {\n        return \"é™çº§äº†2\";\n    }\n}\n~~~\n\n## 4ã€ä¿®æ”¹å¯¹åº”çš„OpenFeignæ¥å£ç±»\n\nåªéœ€è¦åœ¨`@FeignClient`æ³¨è§£ä¸­å¢åŠ fallbackå…¥å‚å³å¯ï¼ŒæŒ‡å®šå®ç°ç±»\n\n~~~java\n@FeignClient(name = \"stock\", path = \"/stock\", fallback = StockSentinelFallback.class)\npublic interface Stock {\n\n    /**\n     * @Description è¿™é‡Œçš„æ¥å£å°±ä¸è°ƒç”¨çš„Controlleré‡Œé¢çš„æ¥å£ä¸€ç›´å°±å¯ä»¥äº†ï¼Œå…¶å®å°†å¯¹åº”çš„æ¥å£å¤åˆ¶è¿‡æ¥å°±å¯ä»¥äº†ï¼Œåªä¸è¿‡æ˜¯æ²¡æœ‰å®ç°çš„\n     * @Author sy\n     * @Date 2023/3/5\n     * @Version 1.0\n     **/\n    @PostMapping(value = \"/reduceStock\")\n    public String reduceStock();\n\n    @PostMapping(value = \"/reduceStock2\")\n    public String reduceStock2();\n}\n~~~\n\nä¸Šé¢çš„ä»£ç ä¸­`/reduceStock2`æ˜¯ç”¨äºåšé™çº§ç†”æ–­æµ‹è¯•çš„æ¥å£ï¼Œæ‰€ä»¥åœ¨æµ‹è¯•ç±»ä¸­åªå†™äº†reduceStock2çš„è¿”å›å€¼ã€‚\n\n\n\n\n\n# é—®é¢˜è®°å½•\n\n1. æœ¬åœ°æœåŠ¡æ— æ³•æ³¨å†Œåˆ°æœåŠ¡å™¨çš„Sentinel dashboardä¸­\n\n   è¿™ä¸ªé—®é¢˜å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§åŸå› ï¼Œè¿™é‡Œåªå†™æˆ‘é‡åˆ°çš„ï¼š\n\n   - `yml`é…ç½®æ–‡ä»¶ä¸­çš„ `client-ip` é…ç½®é¡¹æ²¡æœ‰é…ç½®æˆ–è€…é…ç½®é”™è¯¯ï¼Œè¿™ä¸ªé…ç½®é¡¹åœ¨ä¸Šé¢æœ‰æåˆ°è¿‡ï¼Œæ˜¯é…ç½®ä½ çš„æœåŠ¡æ‰€åœ¨ipï¼Œå¦‚æœSentinel dashboardå’ŒæœåŠ¡æ˜¯åœ¨ä¸€å°æœºå™¨å¯åŠ¨çš„åˆ™å¯ä»¥å¿½ç•¥è¿™ä¸ªé…ç½®\n\n   - ç‰ˆæœ¬å¯¹åº”çš„é—®é¢˜ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºå®˜æ–¹çš„ç‰ˆæœ¬å¯¹åº”åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚å„ç§æ€€ç–‘è‡ªå·±çš„é…ç½®æˆ–è€…ç½‘ç»œé—®é¢˜ã€‚çªç„¶æƒ³èµ·ç‰ˆæœ¬å¯¹åº”æ‰å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œ`spring-cloud-alibaba-dependencies:2.2.9.RELEASE`å¯¹åº”`spring-cloud-starter-alibaba-sentinel:2.2.8.RELEASE`ï¼Œè¿™ä¸ªæ˜¯ç»è¿‡æˆ‘ä¸æ‡ˆæµ‹è¯•åå¯ä»¥æ­£å¸¸å°†æœåŠ¡æ³¨å†Œåˆ°Sentinel dashboardä¸­çš„ç‰ˆæœ¬\n\n     \n","tags":["Sentinel"],"categories":["æŠ€æœ¯å­¦ä¹ ","SpringCloudAlibaba","Sentinel"]},{"title":"SpringCloudAlibaba-OpenFeignçš„å¼•å…¥åŠä½¿ç”¨","url":"/2023/03/05/SpringCloudAlibaba-OpenFeginçš„å¼•å…¥åŠä½¿ç”¨/","content":"\n# ä¸€ã€OpenFeignæ˜¯ä»€ä¹ˆ\n\n ã€€ã€€ OpenFeignæ˜¯SpringCloudå¯¹Feginçš„å°è£…å‡çº§ï¼ŒåŒ…å«äº†SpringMVCï¼ŒRibbonç­‰åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨SpringMVCçš„ç›¸å…³æ³¨è§£ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨è°ƒç”¨åˆ«çš„æœåŠ¡çš„æ¥å£çš„æ—¶å€™åˆ†åˆ«éƒ½æ˜¯ä½¿ç”¨HttpClientæˆ–è€…RestTemplateç­‰é€šè¿‡æŒ‡å®šURLåœ°å€ç­‰æ“ä½œå»è°ƒç”¨åˆ«çš„æœåŠ¡çš„æ¥å£ã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥OpenFeignç»„ä»¶å®ç°æ›´æ–¹ä¾¿çš„æœåŠ¡é—´çš„è°ƒç”¨ï¼Œæœ€ç®€å•çš„å°±æ˜¯å¯ä»¥é€šè¿‡æŒ‡å®šå…¶ä»–æœåŠ¡çš„åå­—æ¥è°ƒç”¨ç›¸åº”æ¥å£ã€‚\n\n<!--more-->\n\n# äºŒã€å¼•å…¥ä¾èµ–ä»¥åŠé…ç½®\n\n1. é¦–å…ˆæˆ‘ä»¬åœ¨æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æœåŠ¡ä¸‹é¢å¼•å…¥ä¾èµ–\n\n   ~~~xml\n   <dependency>\n       <groupId>org.springframework.cloud</groupId>\n       <artifactId>spring-cloud-starter-openfeign</artifactId>\n   </dependency>\n   ~~~\n\n2. åœ¨å¯åŠ¨ç±»ä¸Šé¢åŠ ä¸Šå¯ç”¨OpenFeignçš„æ³¨è§£ï¼š`@EnableFeignClients`\n\n3. é…ç½®æ‰“å°æ—¥å¿—è°ƒç”¨æ—¥å¿—çš„é…ç½®ç±»\n\n   ~~~java\n   /**\n    * @Description\n    * OpenFeigné…ç½®ç±»\n    * å¦‚æœåŠ äº†@Configurationæ³¨è§£åˆ™ä¸ºå…¨å±€é…ç½®ï¼Œæ‰€æœ‰Feignæ¥å£éƒ½æœ‰æ•ˆ\n    * å¦‚æœæƒ³è¦å®ç°å±€éƒ¨é…ç½®ï¼Œåˆ™ä¸éœ€è¦é…ç½®@Configurationæ³¨è§£ï¼Œåœ¨æƒ³è¦å¯ç”¨è¿™ä¸ªé…ç½®çš„Feignæ¥å£ä¸Šé¢æŒ‡å®šè¿™ä¸ªé…ç½®ç±»\n    * @Author sy\n    * @Date 2023/3/5\n    * @Version 1.0\n    **/\n   @Configuration\n   public class FeignConfig {\n   \n       /** \n        * @Description æ—¥å¿—çº§åˆ«\n        * @Author sy\n        * @Date 2023/3/5\n        * @Version 1.0\n        **/\n       @Bean\n       public Logger.Level feignLoggerLevel() {\n           return Logger.Level.FULL;\n       }\n   }\n   ~~~\n\n4. é…ç½®ymlé…ç½®æ–‡ä»¶\n\n   ```yaml\n   logging:\n     level:\n       # æŒ‡å®šå¯¹åº”åŒ…çš„æ—¥å¿—çº§åˆ«\n       com.sy.springcloud.service.openFeign: debug\n   ```\n\n   \n\n# ä¸‰ã€å®é™…ä½¿ç”¨\n\n```java\n/**\n * @Description\n * feignæ¥å£\n * nameï¼šå¯¹åº”çš„è°ƒç”¨çš„æœåŠ¡çš„å®ä¾‹åç§°\n * pathï¼šå¯¹åº”çš„è°ƒç”¨çš„æ¥å£çš„åœ°å€ï¼Œå°±æ˜¯å¯¹åº”çš„ControlleræŒ‡å®šçš„@RequestMapping()é…ç½®çš„åœ°å€\n * configuration = FeignConfig.classï¼Œå¯ä»¥åŠ å…¥è¿™ä¸ªé…ç½®ï¼Œè¿™ä¸ªé…ç½®ç”¨äºè¿™ä¸ªæ¥å£ä½¿ç”¨çš„feigné…ç½®ç±»ï¼Œå°±æ˜¯å±€éƒ¨é…ç½®çš„æ—¶å€™ä½¿ç”¨çš„\n * @Author sy\n * @Date 2023/3/5\n * @Version 1.0\n **/\n@FeignClient(name = \"stock\", path = \"/stock\")\npublic interface Stock {\n\n    /**\n     * @Description è¿™é‡Œçš„æ¥å£å°±ä¸è°ƒç”¨çš„Controlleré‡Œé¢çš„æ¥å£ä¸€ç›´å°±å¯ä»¥äº†ï¼Œå…¶å®å°†å¯¹åº”çš„æ¥å£å¤åˆ¶è¿‡æ¥å°±å¯ä»¥äº†ï¼Œåªä¸è¿‡æ˜¯æ²¡æœ‰å®ç°çš„\n     * @Author sy\n     * @Date 2023/3/5\n     * @Version 1.0\n     **/\n    @PostMapping(value = \"/reduceStock\")\n    public String reduceStock();\n}\n```\n\nåˆ°è¿™é‡Œï¼Œæœ€åŸºæœ¬çš„é…ç½®ä½¿ç”¨å¯ä»¥äº†ã€‚åé¢è¿˜ä¼šå¢åŠ æ›´å¤šä½¿ç”¨çš„é…ç½®\n\n\n\n# å››ã€å¥‘çº¦æ¨¡å¼\n\nã€€ã€€å°†OpenFeignçš„æ³¨è§£è¿˜åŸæˆåŸç”Ÿæ³¨è§£ï¼Œä½¿ç”¨åœºæ™¯ï¼šä¾‹å¦‚æˆ‘ä»¬çš„é¡¹ç›®æ˜¯ä¸€ä¸ªæ—©æœŸç‰ˆæœ¬çš„SpringCloudï¼Œå½“ä½ æƒ³è¦å¯¹æ¡†æ¶è¿›è¡Œå‡çº§ï¼Œé‚£ä¹ˆç”±äºæ—©æœŸçš„æ¡†æ¶ä½¿ç”¨çš„æ˜¯Feignç»„ä»¶ï¼Œå½“ä½ å‡çº§åè¦ä½¿ç”¨çš„æ˜¯OpenFeginç»„ä»¶ï¼Œå°±ä¼šå‡ºç°å…¼å®¹æ€§çš„é—®é¢˜ï¼Œé‚£è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¥‘çº¦æ¨¡å¼å»æŒ‡å®šæŸäº›æ¥å£ä½¿ç”¨åŸç”Ÿæ³¨è§£ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡å¤šç§é…ç½®æ–¹å¼æ¥å®ç°ï¼Œæˆ‘ä»¬è¿™é‡Œå°±æ¼”ç¤ºç®€å•çš„ä¸¤ç§åˆ†åˆ«æ˜¯å…¨å±€æ¨¡å¼ä¸å±€éƒ¨æ¨¡å¼ï¼š\n\n1. å…¨å±€æ¨¡å¼ï¼šè¿˜æ˜¯å¯ä»¥é€šè¿‡é…ç½®ç±»æ¥å®ç°\n\n   ```java\n   @Configuration\n   public class FeignConfig {\n   \n       /**\n        * @Description æ—¥å¿—çº§åˆ«\n        * @Author sy\n        * @Date 2023/3/5\n        * @Version 1.0\n        **/\n       @Bean\n       public Logger.Level feignLoggerLevel() {\n           return Logger.Level.FULL;\n       }\n   \n       /**\n        * @Description å¥‘çº¦æ¨¡å¼ï¼Œå°†OpenFeignæ³¨è§£è¿˜åŸæˆåŸç”Ÿæ³¨è§£ï¼ŒåŸºæœ¬ä¸ä¼šä½¿ç”¨åˆ°\n        * @Author sy\n        * @Date 2023/3/5\n        * @Version 1.0\n        **/\n       @Bean\n       public Contract feignContract() {\n           return new Contract.Default();\n       }\n   }\n   ```\n\n2. é€šè¿‡ymlçš„æ–¹å¼æ¥é…ç½®å±€éƒ¨\n\n   ```yaml\n   # feignå±€éƒ¨é…ç½®\n   feign:\n     client:\n       config:\n         # å¯¹åº”çš„æœåŠ¡åç§°\n         stock:\n           # æ—¥å¿—çº§åˆ«\n           logger-level: basic\n           # å¥‘çº¦æ¨¡å¼ï¼Œè¿˜åŸFeignåŸç”Ÿæ³¨è§£\n           contract: feign.Contract.Default\n   ```\n\n# äº”ã€è¶…æ—¶æ—¶é—´\n\nå¯ä»¥é…ç½®è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œä¸è¯·æ±‚å¤„ç†è¶…æ—¶æ—¶é—´\n\n1. é€šè¿‡é…ç½®ç±»é…ç½®\n\n   ```java\n   /**\n    * @Description\n    * OpenFeigné…ç½®ç±»\n    * å¦‚æœåŠ äº†@Configurationæ³¨è§£åˆ™ä¸ºå…¨å±€é…ç½®ï¼Œæ‰€æœ‰Feignæ¥å£éƒ½æœ‰æ•ˆ\n    * å¦‚æœæƒ³è¦å®ç°å±€éƒ¨é…ç½®ï¼Œåˆ™ä¸éœ€è¦é…ç½®@Configurationæ³¨è§£ï¼Œåœ¨æƒ³è¦å¯ç”¨è¿™ä¸ªé…ç½®çš„Feignæ¥å£ä¸Šé¢æŒ‡å®šè¿™ä¸ªé…ç½®ç±»\n    * @Author sy\n    * @Date 2023/3/5\n    * @Version 1.0\n    **/\n   @Configuration\n   public class FeignConfig {\n   \n       /**\n        * @Description æ—¥å¿—çº§åˆ«\n        * @Author sy\n        * @Date 2023/3/5\n        * @Version 1.0\n        **/\n       @Bean\n       public Logger.Level feignLoggerLevel() {\n           return Logger.Level.FULL;\n       }\n   \n       /**\n        * @Description å¥‘çº¦æ¨¡å¼ï¼Œå°†OpenFeignæ³¨è§£è¿˜åŸæˆåŸç”Ÿæ³¨è§£ï¼ŒåŸºæœ¬ä¸ä¼šä½¿ç”¨åˆ°\n        * @Author sy\n        * @Date 2023/3/5\n        * @Version 1.0\n        **/\n       @Bean\n       public Contract feignContract() {\n           return new Contract.Default();\n       }\n   \n       /**\n        * @Description è¶…æ—¶æ—¶é—´é…ç½®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°é…ç½®çš„æ˜¯è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°é…ç½®çš„æ˜¯è¯·æ±‚å¤„ç†è¶…æ—¶æ—¶é—´\n        * @Author sy\n        * @Date 2023/3/5\n        * @Version 1.0\n        **/\n       @Bean\n       public Request.Options options() {\n           return new Request.Options(5000, 10000);\n       }\n   }\n   ```\n\n2. é€šè¿‡ymlé…ç½®æ–‡ä»¶é…ç½®\n\n   ~~~yml\n   # feignå±€éƒ¨é…ç½®\n   feign:\n     client:\n       config:\n         # å¯¹åº”çš„æœåŠ¡å®ä¾‹åç§°\n         stock:\n           # æ—¥å¿—çº§åˆ«\n           logger-level: basic\n           # å¥‘çº¦æ¨¡å¼ï¼Œè¿˜åŸFeignåŸç”Ÿæ³¨è§£\n           contract: feign.Contract.Default\n           # è¿æ¥è¶…æ—¶æ—¶é—´é…ç½®\n           connect-timeout: 5000\n           # è¯·æ±‚å¤„ç†è¶…æ—¶æ—¶é—´é…ç½®\n           read-timeout: 10000\n   ~~~\n\n   \n","tags":["OpenFegin"],"categories":["æŠ€æœ¯å­¦ä¹ ","SpringCloudAlibaba","OpenFegin"]},{"title":"SpringCloudAlibaba-Ribbonè´Ÿè½½å‡è¡¡","url":"/2023/02/27/SpringCloudAlibaba-Ribbonè´Ÿè½½å‡è¡¡/","content":"\n# \tä¸€ã€ä»€ä¹ˆè¦è¿›è¡Œè´Ÿè½½å‡è¡¡\n\nè´Ÿè½½å‡è¡¡å°±æ˜¯ä¸ºé¿å…æ‰€æœ‰è¯·æ±‚éƒ½æ‰“åˆ°ä¸€ä¸ªæœåŠ¡å™¨ä¸Šé¢ï¼Œå¯¼è‡´æœåŠ¡å™¨å¼‚å¸¸å„¿äº§ç”Ÿçš„æœåŠ¡ä¸å¯é—®é¢˜ã€‚\n\nä¸‹é¢æˆ‘ä»¬å°±æ¥è‡ªå®šè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œæˆ‘è¿™è¾¹å®ç°çš„åªæœ‰ä¸€ä¸‹ä¸‰ç§ï¼Œä½†æ˜¯å®é™…ä¸Šæ ¹æ®ä¸šåŠ¡éœ€æ±‚çš„ä¸åŒä¼šäº§ç”Ÿå„ç§å‡è¡¡ç­–ç•¥ï¼š\n\n- æ ¹æ®æƒé‡éšæœºé€‰æ‹©ä¸€ä¸ªå®ä¾‹\n- ä¼˜å…ˆé€‰æ‹©åŒé›†ç¾¤\n- ä¼˜å…ˆé€‰æ‹©åŒç‰ˆæœ¬åŒé›†ç¾¤çš„ç¤ºä¾‹ï¼ˆé‡‘ä¸é›€å‘å¸ƒ---å®ç°åŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰\n\n<!--more--> \n\n# äºŒã€è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥\n\nè¿™é‡Œæˆ‘å…ˆå°†æˆ‘çš„ç›®å½•æ”¾åœ¨è¿™é‡Œï¼Œä¸‹é¢æ˜¯å„ç§å®ç°\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](1.png)\n\n### ç¬¬ä¸€æ­¥ï¼šè‡ªå®šä¹‰ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„é…ç½®ç±»\n\nè¿™é‡Œä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„å…¨å±€é…ç½®ç±»\n\n```java\npackage com.sy.springcloud.config.ribbon;\n\n\nimport com.sy.ribbon.GlobalRibbonConfig;\nimport org.springframework.cloud.netflix.ribbon.RibbonClients;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@RibbonClients(defaultConfiguration = GlobalRibbonConfig.class)\npublic class CustomeRibbonConfig {\n}\n\n```\n\n### ç¬¬äºŒæ­¥ï¼šåœ¨æˆ‘ä»¬çš„å…¨å±€é…ç½®ç±»ä¸­é…ç½®æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥\n\n```java\npackage com.sy.ribbon;\n\nimport com.netflix.loadbalancer.IRule;\nimport com.sy.springcloud.config.ribbon.rule.TheSameClusterPriorityRule;\nimport com.sy.springcloud.config.ribbon.rule.TheSameClusterPriorityWithVersionRule;\nimport com.sy.springcloud.config.ribbon.rule.WeightedBalancerRule;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.stereotype.Component;\n\n/**\n * å…¨å±€è´Ÿè½½å‡è¡¡é…\n */\n@Component\npublic class GlobalRibbonConfig {\n\n    @Bean\n    public IRule iRule() {\n        // å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥\n        return new WeightedBalancerRule();\n        // å®ç°åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡ç­–ç•¥\n        //return new TheSameClusterPriorityRule();\n        // å®ç°åŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå¿…é¡»åŒç‰ˆæœ¬ï¼Œå¯ä»¥ä¸åŒé›†ç¾¤ï¼‰\n        //return new TheSameClusterPriorityWithVersionRule();\n    }\n\n}\n\n```\n\n### ç¬¬ä¸‰æ­¥ï¼šè‡ªå®šä¹‰æˆ‘ä»¬çš„è´Ÿè½½å‡è¡¡ç­–ç•¥\n\n#### ç¬¬1ç§ç±»å‹ï¼šæ ¹æ®æƒé‡éšæœºé€‰æ‹©ä¸€ä¸ªå®ä¾‹\n\n~~~ java\npackage com.sy.springcloud.config.ribbon.rule;\n\nimport com.alibaba.cloud.nacos.NacosServiceManager;\nimport com.alibaba.cloud.nacos.ribbon.NacosServer;\nimport com.alibaba.nacos.api.naming.NamingService;\nimport com.alibaba.nacos.api.naming.pojo.Instance;\nimport com.netflix.client.config.IClientConfig;\nimport com.netflix.loadbalancer.AbstractLoadBalancerRule;\nimport com.netflix.loadbalancer.BaseLoadBalancer;\nimport com.netflix.loadbalancer.Server;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\n\n/**\n * æ ¹æ®æƒé‡éšæœºé€‰æ‹©ä¸€ä¸ªå®ä¾‹\n */\n@Slf4j\npublic class WeightedBalancerRule extends AbstractLoadBalancerRule {\n\n    @Autowired\n    private NacosServiceManager nacosServiceManager;\n    @Override\n    public void initWithNiwsConfig(IClientConfig iClientConfig) {\n\n    }\n\n    @Override\n    public Server choose(Object o) {\n        try {\n            log.info(\"key:{}\",o);\n            // è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œè·å¾—å½“å‰ä½¿ç”¨çš„å‡è¡¡è´Ÿè½½å™¨\n            BaseLoadBalancer loadBalancer = (BaseLoadBalancer) this.getLoadBalancer();\n            // è·å–ç›®æ ‡æœåŠ¡çš„åç§°\n            String serviceName = loadBalancer.getName();\n            // è·å–nacosçš„æœåŠ¡å‘ç°çš„API\n            NamingService namingService = nacosServiceManager.getNamingService();\n\n            // æ ¹æ®åç§°è·å–æœåŠ¡å‘ç°å®ä¾‹ï¼Œåœ¨selectOneHealthyInstanceä¸­ï¼Œnacoså®ç°äº†æƒé‡çš„è´Ÿè½½å‡è¡¡ç®—æ³•\n            Instance instance = namingService.selectOneHealthyInstance(serviceName);\n\n            return new NacosServer(instance);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n}\n\n~~~\n\n#### ç¬¬2ç§ç±»å‹ï¼šä¼˜å…ˆé€‰æ‹©åŒé›†ç¾¤\n\n~~~java\npackage com.sy.springcloud.config.ribbon.rule;\n\n\nimport com.alibaba.cloud.nacos.NacosDiscoveryProperties;\nimport com.alibaba.cloud.nacos.NacosServiceManager;\nimport com.alibaba.cloud.nacos.ribbon.NacosServer;\nimport com.alibaba.nacos.api.naming.NamingService;\nimport com.alibaba.nacos.api.naming.pojo.Instance;\nimport com.netflix.client.config.IClientConfig;\nimport com.netflix.loadbalancer.AbstractLoadBalancerRule;\nimport com.netflix.loadbalancer.BaseLoadBalancer;\nimport com.netflix.loadbalancer.Server;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n/**\n * åŒé›†ç¾¤ä¼˜å…ˆè°ƒç”¨--è´Ÿè½½å‡è¡¡ç­–ç•¥\n */\n@Slf4j\npublic class TheSameClusterPriorityRule extends AbstractLoadBalancerRule {\n\n    @Autowired\n    private NacosServiceManager nacosServiceManager;\n\n    @Autowired\n    private NacosDiscoveryProperties nacosDiscoveryProperties;\n\n\n    @Override\n    public void initWithNiwsConfig(IClientConfig iClientConfig) {\n\n    }\n\n    @Override\n    public Server choose(Object o) {\n        try {\n            // è·å–æœåŠ¡æ‰€åœ¨çš„é›†ç¾¤åç§°\n            String clusterName = nacosDiscoveryProperties.getClusterName();\n            log.info(\"å½“å‰é›†ç¾¤åç§°ï¼š{}\", clusterName);\n            // è·å–å½“å‰çš„è´Ÿè½½å‡è¡¡å™¨\n            BaseLoadBalancer loadBalancer = (BaseLoadBalancer) this.getLoadBalancer();\n            // è·å–ç›®æ ‡æœåŠ¡çš„å®ä¾‹åç§°\n            String serviceName = loadBalancer.getName();\n            log.info(\"ç›®æ ‡æœåŠ¡çš„å®ä¾‹åç§°ï¼š{}\", serviceName);\n            // è·å–nacosæœåŠ¡æ³¨å†Œå‘ç°çš„api\n            NamingService namingService = nacosServiceManager.getNamingService();\n            // é€šè¿‡namimgServiceè·å–å½“å‰æ³¨å†Œçš„æ‰€æœ‰å®ä¾‹\n            List<Instance> allInstance = namingService.getAllInstances(serviceName);\n\n            List<Instance> sameClusterInstanceList;\n            // è¿‡æ»¤ç­›é€‰åŒé›†ç¾¤ä¸‹çš„æœåŠ¡å®ä¾‹\n            sameClusterInstanceList = allInstance.stream().filter(instance -> instance.getClusterName().equals(clusterName)).collect(Collectors.toList());\n            log.info(\"ç»Ÿè®¡ç¾¤çš„æœåŠ¡å®ä¾‹ï¼š{}\", sameClusterInstanceList);\n            Instance toBeChooseInstance;\n            // é€‰æ‹©åˆé€‚çš„æœåŠ¡å®ä¾‹\n            if (sameClusterInstanceList == null || sameClusterInstanceList.size() == 0) {\n                // ä»å…¶ä»–é›†ç¾¤ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹\n                toBeChooseInstance = WeightedBalancer.chooseInstanceByRandomWeight(allInstance);\n                log.info(\"è·¨é›†ç¾¤è°ƒç”¨---{}\", toBeChooseInstance.getPort());\n            } else {\n                // ä»æœ¬é›†ç¾¤ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹\n                toBeChooseInstance = WeightedBalancer.chooseInstanceByRandomWeight(sameClusterInstanceList);\n                log.info(\"åŒé›†ç¾¤è°ƒç”¨---{}\", toBeChooseInstance.getPort());\n            }\n            return new NacosServer(toBeChooseInstance);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        return null;\n    }\n}\n\n~~~\n\nè¿™é‡Œä»¥åŠä¸‹ä¸€ç§ç±»å‹ä¼šç”¨åˆ°ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»çš„ä½œç”¨æ˜¯æ ¹æ®åœ¨ç¬¦åˆçš„å®ä¾‹ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª\n\n~~~java\npackage com.sy.springcloud.config.ribbon.rule;\n\nimport com.alibaba.nacos.api.naming.pojo.Instance;\nimport com.alibaba.nacos.client.naming.core.Balancer;\n\nimport java.util.List;\n\n/**\n * æ ¹æ®æƒé‡éšæœºé€‰æ‹©ä¸€ä¸ªå®ä¾‹\n */\npublic class WeightedBalancer extends Balancer {\n    public static Instance chooseInstanceByRandomWeight(List<Instance> instanceList) {\n        return getHostByRandomWeight(instanceList);\n    }\n}\n\n~~~\n\n#### ç¬¬3ç§ç±»å‹ï¼šåŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆæ‹©è´Ÿè½½å‡è¡¡ç­–ç•¥\n\nè¿™ä¸ªç­–ç•¥ä¹Ÿå¯ä»¥å«åšé‡‘ä¸é›€å‘å¸ƒç­–ç•¥ï¼šç°åº¦æµ‹è¯•çš„åœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨\n\n~~~java\npackage com.sy.springcloud.config.ribbon.rule;\n\n\nimport com.alibaba.cloud.nacos.NacosDiscoveryProperties;\nimport com.alibaba.cloud.nacos.NacosServiceManager;\nimport com.alibaba.cloud.nacos.ribbon.NacosServer;\nimport com.alibaba.nacos.api.naming.NamingService;\nimport com.alibaba.nacos.api.naming.pojo.Instance;\nimport com.netflix.client.config.IClientConfig;\nimport com.netflix.loadbalancer.AbstractLoadBalancerRule;\nimport com.netflix.loadbalancer.BaseLoadBalancer;\nimport com.netflix.loadbalancer.Server;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n/**\n * åŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆè°ƒç”¨--è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆé‡‘ä¸é›€/ç°åº¦æµ‹è¯•ï¼‰\n * 1ã€ä¼˜å…ˆåŒç‰ˆæœ¬åŒé›†ç¾¤çš„æœåŠ¡è°ƒç”¨\n * 2ã€æ²¡æœ‰ æ¡ä»¶1çš„ï¼ŒåŒç‰ˆæœ¬è·¨é›†ç¾¤çš„æœåŠ¡è°ƒç”¨\n * 3ã€ä¸å¯ä»¥è¿›è¡Œä¸åŒç‰ˆæœ¬çš„æœåŠ¡è°ƒç”¨\n */\n@Slf4j\npublic class TheSameClusterPriorityWithVersionRule extends AbstractLoadBalancerRule {\n\n    @Autowired\n    private NacosServiceManager nacosServiceManager;\n\n    @Autowired\n    private NacosDiscoveryProperties nacosDiscoveryProperties;\n\n\n    @Override\n    public void initWithNiwsConfig(IClientConfig iClientConfig) {\n\n    }\n\n    @Override\n    public Server choose(Object o) {\n        try {\n            // è·å–æœåŠ¡æ‰€åœ¨çš„é›†ç¾¤åç§°\n            String clusterName = nacosDiscoveryProperties.getClusterName();\n            // è·å–æœåŠ¡çš„ç‰ˆæœ¬å·\n            String version = nacosDiscoveryProperties.getMetadata().get(\"version\");\n            log.info(\"å½“å‰é›†ç¾¤åç§°ï¼š{},æœåŠ¡ç‰ˆæœ¬å·ï¼š{}\", clusterName, version);\n            // è·å–å½“å‰çš„è´Ÿè½½å‡è¡¡å™¨\n            BaseLoadBalancer loadBalancer = (BaseLoadBalancer) this.getLoadBalancer();\n            // è·å–ç›®æ ‡æœåŠ¡çš„å®ä¾‹åç§°\n            String serviceName = loadBalancer.getName();\n            log.info(\"ç›®æ ‡æœåŠ¡çš„å®ä¾‹åç§°ï¼š{}\", serviceName);\n            // è·å–nacosæœåŠ¡æ³¨å†Œå‘ç°çš„api\n            NamingService namingService = nacosServiceManager.getNamingService();\n            // é€šè¿‡namimgServiceè·å–å½“å‰æ³¨å†Œçš„æ‰€æœ‰å®ä¾‹\n            List<Instance> allInstance = namingService.getAllInstances(serviceName);\n\n            // è¿‡æ»¤ç­›é€‰åŒç‰ˆæœ¬çš„æœåŠ¡\n            List<Instance> sameVersionInstance;\n            sameVersionInstance = allInstance.stream().filter(instance -> instance.getMetadata().get(\"version\").equals(version)).collect(Collectors.toList());\n\n\n            // è¿‡æ»¤ç­›é€‰åŒç‰ˆæœ¬ä¸‹çš„åŒé›†ç¾¤çš„æœåŠ¡å®ä¾‹\n            List<Instance> sameClusterInstanceList;\n            sameClusterInstanceList = sameVersionInstance.stream().filter(instance -> instance.getClusterName().equals(clusterName)).collect(Collectors.toList());\n            log.info(\"ç»Ÿè®¡ç¾¤çš„æœåŠ¡å®ä¾‹ï¼š{}\", sameClusterInstanceList);\n            Instance toBeChooseInstance;\n            // é€‰æ‹©åˆé€‚çš„æœåŠ¡å®ä¾‹ï¼ˆå¿…é¡»åŒç‰ˆæœ¬ï¼‰\n            if (sameClusterInstanceList == null || sameClusterInstanceList.size() == 0) {\n                // ä»æ‰€æœ‰åŒç‰ˆæœ¬çš„æœåŠ¡å®ä¾‹ä¸­é€‰ä¸€ä¸ª\n                toBeChooseInstance = WeightedBalancer.chooseInstanceByRandomWeight(sameVersionInstance);\n                log.info(\"è·¨é›†ç¾¤è°ƒç”¨---{}\", toBeChooseInstance.getPort());\n            } else {\n                // ä»æœ¬é›†ç¾¤ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹\n                toBeChooseInstance = WeightedBalancer.chooseInstanceByRandomWeight(sameClusterInstanceList);\n                log.info(\"åŒé›†ç¾¤è°ƒç”¨---{}\", toBeChooseInstance.getPort());\n            }\n            return new NacosServer(toBeChooseInstance);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        return null;\n    }\n}\n\n~~~\n\nä¸‰ç§é…ç½®åˆ°è¿™é‡Œå°±å®Œäº‹äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥åœ¨Nacosä¸­é…ç½®æƒé‡ä¸ç‰ˆæœ¬å·è¿›è¡Œæµ‹è¯•äº†\n","tags":["Ribbon"],"categories":["æŠ€æœ¯å­¦ä¹ ","SpringCloudAlibaba","Ribbon"]},{"title":"Dockeréƒ¨ç½²Nginx","url":"/2023/02/22/Dockeréƒ¨ç½²Nginx/","content":"\n# å‰è¨€\n\nåœ¨ä¸Šä¸€ç¯‡ä¸­ä½¿ç”¨Dockeréƒ¨ç½²äº†Nacosï¼ŒNacosåœ¨é›†ç¾¤ä¸‹æ˜¯éœ€è¦Nginxè¿›è¡Œä»£ç†ï¼Œè´Ÿè½½å‡è¡¡çš„ã€‚æ‰€ä»¥å°±æœ‰äº†è¿™ä¸€éå¸–å­ã€‚\n\n<!-- more -->\n\n## 1ã€æ‹‰å– Nginx é•œåƒ\n\nä½¿ç”¨`docker pull nginx`å‘½ä»¤æ‹‰å– Nginx é•œåƒ\n\n## 2ã€åˆ›å»ºæŒ‚è½½ç›®å½•\n\n1. åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•\n\n   `mkdir -p /home/nginx/conf`\n\n2. åˆ›å»ºç«™ç‚¹ç›®å½•\n\n   `mkdir -p /home/nginx/html`\n\n3. åˆ›å»ºNginxæ—¥å¿—ç›®å½•\n\n   `mkdir -p /home/nginx/log`\n\n## 3ã€å°†å®¹å™¨ä¸­çš„é…ç½®æ–‡ä»¶ç­‰å¤åˆ¶åˆ°å®¿ä¸»æœºå¯¹åº”ç›®å½•ä¸­\n\n1. å¯åŠ¨ nginx å®¹å™¨\n\n   `docker run --name nginx -p 80:80 -d nginx`\n\n2. å°†å®¹å™¨ä¸­çš„ nginx.conf æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºçš„æŒ‚è½½ç›®å½•ä¸­\n\n   `docker cp nginx:/etc/nginx/nginx.conf /home/nginx/conf/`\n\n3. å°†å®¹å™¨ä¸­çš„ conf.d æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºçš„æŒ‚è½½ç›®å½•ä¸­\n\n   `docker cp nginx:/etc/nginx/conf.d /home/nginx/conf/`\n\n4. å°†å®¹å™¨ä¸­çš„ html æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºçš„æŒ‚è½½ç›®å½•ä¸­\n\n   `docker cp nginx:/usr/share/nginx/html /home/nginx/html/`\n\n## 4ã€åˆ›å»ºå¯åŠ¨è„šæœ¬\n\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Nginx å®¹å™¨ï¼š\n\n```shell\ndocker run --name nginx -p 5000:80 \\ \n       -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \\ \n       -v /home/nginx/conf/conf.d:/etc/nginx/conf.d \\ \n       -v /home/nginx/log:/var/log/nginx \\ \n       -v /home/nginx/html:/usr/share/nginx/html \\ \n       -d nginx\n```\n\n## 5ã€è®¾ç½®ä»£ç†\n\nå°†ä»¥ä¸‹é…ç½®é…ç½®åˆ°nginx.confé…ç½®æ–‡ä»¶çš„httpä¸‹å³å¯\n\n```properties\n\t\t\t\tupstream nacoscluster {\n                server 192.168.0.107:8848;\n                server 192.168.0.108:8848;\n                server 192.168.0.109:8848;\n        }\n\n        server {\n                listen 80;\n                server_name localhost;\n\n                location /nacos/{\n                        proxy_pass http://nacoscluster/nacos/;\n                }\n        }\n\n```\n\n\n\n","tags":["Nginx"],"categories":["æŠ€æœ¯å­¦ä¹ ","SpringCloudAlibaba"]},{"title":"Dockeréƒ¨ç½²Nacos","url":"/2023/02/21/Dockeréƒ¨ç½²Nacos/","content":"\n# å‰è¨€\n\nã€€ã€€å› ä¸ºæœ€è¿‘åœ¨å‡†å¤‡é¢è¯•ï¼Œä¹Ÿåœ¨å­¦ä¹ ä¸€äº›æŠ€æœ¯ï¼Œç›®å‰æ­£åœ¨çœ‹ SpringCloudAlibaba è¿™ä¸€å¥—æ¡†æ¶ï¼Œåœ¨è¿›è¡Œ Nacos é›†ç¾¤éƒ¨ç½²çš„æ—¶å€™æ„Ÿè§‰æ¯æ¬¡éƒ½è¦è§£å‹ä»€ä¹ˆçš„å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥å†³å®šç›´æ¥ç”¨ Docker å»è¿›è¡Œéƒ¨ç½²ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿä¼šä¸€ç‚¹ç‚¹æ…¢æ…¢å®Œå–„çš„ã€‚å¥½äº†ï¼Œè¯ä¸å¤šè¯´ğŸ‘‡ğŸ»å°±è¦å¼€å§‹äº†\n\n<!-- more -->\n\n## 1ã€æ‹‰å– Nacos é•œåƒ\n\n æ‰§è¡Œ `docker pull nacos/nacos-server:v2.1.0` å‘½ä»¤æ‹‰å–nacosé•œåƒ\n\n## 2ã€åœ¨æœ¬æœºåˆ›å»ºnacoså®¹å™¨éœ€è¦æŒ‚è½½çš„ç›®å½•\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](1.png)\n\n## 3ã€ç¼–å†™nacosçš„é…ç½®æ–‡ä»¶\n\nè¿™é‡Œçš„é…ç½®æ–‡ä»¶ä¸æ˜¯ä¿®æ”¹å®¹å™¨å†…çš„é…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯ç¼–è¾‘æŒ‚è½½ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ï¼š\n\n1. åœ¨confç›®å½•ä¸‹æ‰§è¡Œ`vim application.properties` å‘½ä»¤ç¼–å†™é…ç½®æ–‡ä»¶\n\n2. åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®ä½ éœ€è¦çš„é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œåªæ·»åŠ è‡ªå·±éœ€è¦çš„å°±å¥½ï¼Œå°±ä¼šè¦†ç›–æ‰å®¹å™¨å†…å¯¹åº”çš„é…ç½®\n\n   mysqlï¼šnacosæ•°æ®åº“è„šæœ¬ï¼š[nacos-db.sql](nacos-db.sql)\n\n   ```properties\n   #*************** Config Module Related Configurations ***************#\n   ### If use MySQL as datasource:\n   spring.datasource.platform=mysql\n   \n   ### Count of DB:\n   db.num=1\n   #è¿æ¥mysql8.0æ•°æ®åº“\n   ### Connect URL of DB:\n   db.url.0=jdbc:mysql://è¿™é‡Œå¡«å†™ä½ æ•°æ®çš„ip:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC&useSSL=false\n   db.user.0=root\n   db.password.0=root\n   ```\n\n\n## 4ã€åˆ°è¿™é‡Œå°±é…ç½®å¥½äº†ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¿›è¡Œå¯åŠ¨äº†\n\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨nacoså®¹å™¨ï¼š\n\n```dockerfile\ndocker  run --name nacos -p 8848:8848 \\\n        --privileged=true \\\n        --restart=always \\\n        -e JVM_XMS=128m \\\n        -e JVM_XMX=128m \\\n        -e MODE=standalone \\\n        -e PREFER_HOST_MODE=ip \\\n        -v /home/nacos/logs:/home/nacos/logs \\\n        -v /home/nacos/conf/application.properties:/home/nacos/conf/application.properties \\\n        -d nacos/nacos-server:v2.1.0\n\n```\n\nè¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº† `-e MODE=stanalone` å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„å«ä¹‰æ˜¯å•æœºå¯åŠ¨ï¼Œå¦‚æœæ˜¯é›†ç¾¤å¯åŠ¨ï¼Œè¿™é‡Œéœ€è¦è¿›è¡Œä¿®æ”¹ã€‚\n\nè¿™æ¡å‘½ä»¤æˆ‘ä»¬å¯ä»¥ä¿å­˜ä¸ºä¸€ä¸ªshellè„šæœ¬ï¼Œéœ€è¦çš„æ—¶å€™æ‰§è¡Œå°±å¯ä»¥äº†ã€‚\n\n## 5ã€Nacos é›†ç¾¤\n\né¦–å…ˆä½ éœ€è¦ä¸‰å°è™šæ‹Ÿæœºï¼Œæˆ–è€…ç›´æ¥åœ¨ä¸€å°æœºå™¨ä¸Šé¢å¯åŠ¨ä¸‰ä¸ªç«¯å£ä¸é€šNacoså®¹å™¨ã€‚\n\n1. å°† Nacos å¯åŠ¨æ¨¡å¼ä¿®æ”¹ä¸ºé›†ç¾¤ `-e MODE=cluster`\n\n2. å¢åŠ é›†ç¾¤èŠ‚ç‚¹ `-e NACOS_SERVERS=\"192.168.0.108:8848 192.168.0.109:8848\"`è¿™é‡Œçš„ipã€ç«¯å£æ ¹æ®è‡ªå·±çš„ç¯å¢ƒè¿›è¡Œé…ç½®å³å¯ã€‚\n\n","tags":["Nacos"],"categories":["æŠ€æœ¯å­¦ä¹ ","SpringCloudAlibaba"]},{"title":"é¢è¯•è®°å½•ã€é—®é¢˜","url":"/2022/11/25/é¢è¯•è®°å½•ã€é—®é¢˜/","content":"\n# 2022-11-25-1ï¼ˆä¸‰æ–¹æ”¯ä»˜ï¼‰\n\n## 1ã€i++æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨11\n\n<!-- more -->\n\nå¦‚æœæ˜¯<font color=\"red\">å…¨å±€å˜é‡</font>ï¼Œåˆ™ `i++` ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å› ä¸ºjavaåœ¨å¤„ç† `i++` çš„æ—¶å€™æ˜¯åˆ†æ­¥æ“ä½œçš„ï¼Œç¼–è¯‘åç›¸å½“äº `i= i+1`ã€‚è¿™æ ·çš„è¯å¦‚æœç¬¬ä¸€æ¡çº¿ç¨‹æ‰§è¡Œè¿›æ¥ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œåˆ° `i++` çš„æ—¶å€™ï¼Œç¬¬äºŒæ¡çº¿ç¨‹è¿›æ¥äº†ï¼Œè¿™ä¸ªæ—¶å€™ i çš„å€¼è¿˜æ˜¯åŸæ¥çš„å€¼ã€‚æ‰€ä»¥æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚\n\nè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `synchronization` æˆ–è€…ä½¿ç”¨ `AtomicInteger`.\n\n## 2ã€çº¿ç¨‹ä¸å®‰å…¨ä¼šæœ‰ä»€ä¹ˆé—®é¢˜\n\nä¼šé€ æˆæ•°æ®ç´Šä¹±ï¼Œå¯¼è‡´ä¸šåŠ¡æ•°æ®é”™è¯¯ç­‰ã€‚ä¾‹å¦‚æŠ¢ç¥¨ï¼Œå¦‚æœçº¿ç¨‹ä¸å®‰å…¨åˆ™ä¼šå‘ç”Ÿç¥¨æ•°é”™è¯¯ï¼Œå¤šä¸ªäººæŠ¢äº†ç¥¨ï¼Œä½†æ˜¯å‰©ä½™ç¥¨æ•°åªå‡1ï¼Œè¿™ç§é—®é¢˜ã€‚\n\n## 3ã€çº¿ç¨‹æ± åˆ›å»ºæ–¹å¼åŠä¸»è¦å‚æ•°\n\nçº¿ç¨‹æ± çš„åˆ›å»ºä¸»è¦æœ‰ä¸¤ç§ï¼š\n\n1. é€šè¿‡Executorsåˆ›å»ºï¼Œåˆ†åˆ«å¯ä»¥åˆ›å»ºï¼š\n\n   - FixedThreadPool(5) å›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥æŒ‡å®šå¹¶å‘æ•°é‡ã€‚è¶…è¿‡åˆ™åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚\n   - CachedThreadPool() å¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œè‹¥çº¿ç¨‹æ•°è¶…è¿‡å¤„ç†æ‰€éœ€ï¼Œåˆ™ä¼šåœ¨ç¼“å­˜ä¸€æ®µæ—¶é—´åè¢«å›æ”¶ã€‚å¦‚æœçº¿ç¨‹ä¸å¤Ÿåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚\n   - SingleThreadPool() åˆ›å»ºå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¿è¯äº†å…ˆè¿›å…ˆå‡ºçš„é¡ºåºã€‚\n   - ScheduledThreadPool() å¯ä»¥æ‰§è¡Œå»¶æ—¶ä»»åŠ¡çš„çº¿ç¨‹æ± \n   - SingleThreadScheduledExecutor() åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„å¯æ‰§è¡Œå»¶æ—¶ä»»åŠ¡çš„çº¿ç¨‹æ± \n   - WorkStealingPool() åˆ›å»ºä¸€ä¸ªæŠ¢å å¼æ‰§è¡Œçš„çº¿ç¨‹æ± ï¼ˆä»»åŠ¡æ‰§è¡Œé¡ºåºä¸ç¡®å®šï¼‰\n\n2. é€šè¿‡ ThreadPoolExecutor åˆ›å»ºï¼Œä¹Ÿæ˜¯é˜¿é‡Œè§„èŒƒä¸­æ¨èä½¿ç”¨çš„æ–¹å¼ï¼Œå› ä¸ºä»–å¯ä»¥æ˜ç¡®çº¿ç¨‹æ± çš„è§„åˆ™ï¼Œé¿å…äº†èµ„æºè€—å°½ç­‰é—®é¢˜\n\n   ä¸»è¦å‚æ•°ï¼š\n\n   - corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¸€ç›´ä¿æŒå­˜æ´»çš„çº¿ç¨‹æ•°ã€‚å½“çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°çš„æ—¶å€™ï¼Œå³ä½¿æœ‰ç©ºé—²çº¿ç¨‹ï¼Œæ¥äº†æ–°ä»»åŠ¡ä¹Ÿä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹å¤„ç†ã€‚\n\n   - maxPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°ã€‚å½“çº¿ç¨‹æ•° >= æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¸”é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹å¤„ç†ã€‚å½“çº¿ç¨‹æ•° = æœ€å¤§çº¿ç¨‹æ•°çš„æ—¶å€™ï¼Œåˆ™ä¼šæ‹’ç»ä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸ªå¯ä»¥æ ¹æ®æ‹’ç»ç­–ç•¥å†³å®šå¤„ç†æ–¹å¼ã€‚\n\n   - keepAliveTimeï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œå½“çº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¾¾åˆ°è®¾å®šå€¼çš„æ—¶å€™ä¼šé€€å‡ºï¼Œç›´åˆ°çº¿ç¨‹æ•°é‡ = æ ¸å¿ƒçº¿ç¨‹æ•°ä¸ºæ­¢ã€‚å¦‚æœè®¾ç½®äº†allowCoreThreadTimeout = trueï¼Œåˆ™æ ¸å¿ƒçº¿ç¨‹ä¹Ÿä¼šè¶…æ—¶é€€å‡ºã€‚\n\n   - TimeUnitï¼šæ—¶é—´å•ä½\n\n   - BlockQueueï¼šä»»åŠ¡é˜Ÿåˆ—ï¼Œå¯æŒ‡å®šå®¹é‡ï¼Œå½“æ ¸å¿ƒçº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§çš„æ˜¯åï¼Œå†æ¥æ–°çš„ä»»åŠ¡åˆ™ä¼šæ”¾åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸­ç­‰å¾…\n\n   - ThreadFactoryï¼šçº¿ç¨‹å·¥å‚\n\n   - reJectedExecutionHandlerï¼šä»»åŠ¡æ‹’ç»å¤„ç†å™¨ã€‚\n\n     ä¸¤ç§æƒ…å†µä¼šæ‹’ç»å¤„ç†ä»»åŠ¡ï¼š\n\n     - å½“çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸”é˜Ÿåˆ—å·²æ»¡ï¼Œæ€ä¼šæ‹’ç»æ–°ä»»åŠ¡\n     - å½“çº¿ç¨‹æ± çš„ shutdown() è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå†shutdownã€‚å¦‚æœåœ¨è°ƒç”¨ shutdown å’Œçº¿ç¨‹æ± çœŸæ­£shutdwonä¹‹é—´è¿›æ¥æ–°ä»»åŠ¡ï¼Œåˆ™ä¼šæ‹’ç»ã€‚\n\n     ThreadPoolExecutoræœ‰å‡ ä¸ªè‡ªå·±çš„å†…éƒ¨å®ç°æ¥å¤„ç†ï¼š\n\n     - AbortPolicyï¼šé»˜è®¤å€¼ï¼Œä¸¢å¼ƒä»»åŠ¡ï¼ŒæŠ›è¿è¡Œæ—¶å¼‚å¸¸\n     - CallerRunsPolicyï¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡\n     - DiscardPolicyï¼šå¿½è§†ï¼Œä»€ä¹ˆéƒ½ä¸ç®¡\n     - DiscarOldestPolicyï¼šä»é˜Ÿåˆ—ä¸­è¸¢å‡ºæœ€å…ˆè¿›å…¥ï¼ˆæœ€åä¸€ä¸ªæ‰§è¡Œï¼‰çš„ä»»åŠ¡\n     - è¿˜å¯ä»¥å®ç°ReJectedExecutionHandleræ¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ã€‚\n\n## 4ã€å¦‚ä½•è§£å†³sqlæ…¢æŸ¥è¯¢\n\n1. æ•°æ®åº“åˆ›å»ºæ˜¯å¦é€‚åˆï¼Œä¾‹å¦‚ï¼šæ ¹æ®è¡¨æ¶‰åŠçš„ä¸šåŠ¡é€‰æ‹©ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œæ•°æ®é‡çš„å¤§å°è€ƒè™‘æ˜¯å¦éœ€è¦åˆ†åº“åˆ†è¡¨\n2. ä¸»é”®æ˜¯å¦è‡ªå¢ç±»å‹ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•å‘é¡µé¢åˆ†è£‚å’Œè®°å½•è¿ç§»\n3. æ˜¯å¦è¿‡å¤šçš„è¡¨å…³è”æŸ¥è¯¢ï¼Œæ ¹æ®é˜¿é‡Œè§„èŒƒæ¥è¯´æ˜¯å»ºè®®ä¸è¦è¶…è¿‡ä¸‰å¼ è¡¨çš„å…³è”æŸ¥è¯¢\n4. åˆ›å»ºç´¢å¼•ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯è¯´åˆ›å»ºçš„ç´¢å¼•è¶Šå¤šè¶Šå¥½ï¼Œä¹Ÿè¦è€ƒè™‘åˆ°ä¸€ä¸‹å‡ ç§æƒ…å†µ\n   - è¡¨æ¶‰åŠçš„ä¸šåŠ¡æ˜¯å¦ä¼šé¢‘ç¹å‘ç”Ÿå˜åŒ–ï¼Œæ¯•ç«Ÿæ•°æ®ä¿®æ”¹æ˜¯è¦æ¶‰åŠåˆ°æ„å»ºç´¢å¼•çš„\n   - åˆ›å»ºçš„ç´¢å¼•æ˜¯å¦å‘½ä¸­\n   - å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œè¦è€ƒè™‘æœ€å·¦åŒ¹é…åŸåˆ™\n   - ç´¢å¼•å¤±æ•ˆ\n     - æœ€å·¦åŒ¹é…åŸåˆ™ä¸ºæ»¡è¶³\n     - è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢éƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ\n     - ä¸ç­‰äºä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ\n     - is null å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œä½†æ˜¯is not null å°±æ— æ³•ä½¿ç”¨ç´¢å¼•\n     - like é€šé…ç¬¦ä»¥å·¦æ¨¡ç³ŠæŸ¥è¯¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ\n     - or å…³é”®å­—å‰ååªè¦å­˜å’‹éç´¢å¼•çš„åˆ—éƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ \n5. è€ƒè™‘å…¨è¡¨æ‰«æé—®é¢˜ï¼Œå¦‚æœåªæ˜¯æŸ¥è¯¢ä¸€æ¡æ•°æ®çš„è¯å°±å¯ä»¥åŠ ä¸Š `limit 1` ä½¿æŸ¥è¯¢åˆ°å°±ç«‹å³è¿”å›ï¼Œä¸è¿›è¡Œå…¨è¡¨æ‰«æ\n6. ä½¿ç”¨ä»£ç æ¥è¿›è¡Œå¤„ç†ï¼Œå¿…è¦çš„æƒ…å†µä¸‹å¯ä»¥å¤šæ¬¡æŸ¥è¯¢ï¼Œä¹‹ååœ¨å¤„ç†æ•°æ®\n\n## 5ã€ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿé”è¡¨é—®é¢˜\n\né”è¡¨ä¸»è¦å‘ç”Ÿåœ¨ insertã€updateã€deleteä¸­\n\n1. Aç¨‹åºæ‰§è¡Œäº†å¯¹tabbleAçš„insertï¼Œè¿˜æ²¡æœ‰commiteæ—¶ï¼ŒBç¨‹åºä¹Ÿå¯¹tableAè¿›è¡Œäº†insertï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿé”è¡¨çš„é—®é¢˜\n2. é”è¡¨å¸¸å‘ç”Ÿåœ¨å¹¶å‘çš„æƒ…å†µè€Œä¸æ˜¯å¹¶è¡Œï¼Œå¹¶è¡Œæ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹æ“ä½œæ•°æ®åº“ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸èƒ½æ“ä½œæ•°æ®åº“çš„ï¼Œè¿™é‡Œæ˜¯cpuçš„ i/o åˆ†é…åŸåˆ™\n\næ€ä¹ˆå‡å°‘é”è¡¨çš„å‘ç”Ÿæ¦‚ç‡ï¼š\n\nå‡å°‘insertã€updateã€deleteè¯­å¥çš„æ‰§è¡Œåˆ°commiteä¹‹é—´çš„æ—¶é—´ï¼Œå…·ä½“è¯´å°±æ˜¯æ‰¹é‡æ‰§è¡Œå°½é‡æ”¹æˆå•ä¸ªæ‰§è¡Œ\n\n## 6ã€é¢‘ç¹FullGCä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œæ€ä¹ˆå¼•èµ·çš„ï¼Œæ€ä¹ˆè§£å†³\n\n1. ","tags":["Java é¢è¯•"],"categories":["Java é¢è¯•é¢˜"]},{"title":"Dockerå­¦ä¹ ","url":"/2021/08/26/Dockerå­¦ä¹ /","content":"\n# ä¸€ã€ç¯å¢ƒå‡†å¤‡\n\n- linuxç³»ç»Ÿï¼Œæœ¬äººä½¿ç”¨çš„æ˜¯centos8ï¼Œæœ€å°åŒ–å®‰è£…\n\n<!-- more -->\n\n# äºŒã€å®‰è£…\n\n1. ä¸‹è½½ **docker** è„šæœ¬\n\n   - å¯ä»¥é€šè¿‡ [get.docker](https://get.docker.com/) ä¸‹è½½ **docker** çš„å®‰è£…è„šæœ¬\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](1.png)\n\n   - ç›´æ¥é€šè¿‡ ``curl -fsSL get.docker.com -o get-docker.sh`` å‘½ä»¤ä¸‹è½½ **docker** è„šæœ¬\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](2.png)\n\n2. æ‰§è¡Œè„šæœ¬\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](3.png)\n\n3. éªŒè¯\n\n   - æ‰§è¡Œ ``docker version`` æŸ¥çœ‹ **docker** ç‰ˆæœ¬\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](4.png)\n\n     åœ¨ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° **docker** çš„ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ° **docker** æ²¡æœ‰è¿æ¥ã€‚è¿™æ˜¯å› ä¸ºæ²¡æœ‰å¯åŠ¨ **docker** çš„æœåŠ¡\n\n   - æ‰§è¡Œ ``systemctl start docker`` å¯åŠ¨ **docker** çš„æœåŠ¡\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](5.png)\n\n     å¯åŠ¨åæˆ‘ä»¬å·²ç»å¯ä»¥çœ‹åˆ° **docker** çš„æœåŠ¡çš„ç›¸å…³ä¿¡æ¯äº†\n\nåˆ°è¿™é‡Œï¼Œ**docker** å°±å·²ç»å®‰è£…å®Œæˆäº†\n\n# ä¸‰ã€å®¹å™¨çš„å¿«é€Ÿä¸Šæ‰‹\n\n## 1ã€docker çš„å‘½ä»¤è¡Œ\n\n- æˆ‘ä»¬å¯ä»¥é€šè¿‡ ``docker`` å‘½ä»¤æŸ¥çœ‹éƒ½æœ‰ä»€ä¹ˆå¯ä»¥æ‰§è¡Œçš„å‘½ä»¤\n\n  ![å›¾ç‰‡åŠ è½½å¤±è´¥](6.png)\n\n- **docer** å‘½ä»¤è¡Œçš„ç»“æ„:\n\n  ```shell\n  docker æƒ³è¦æ“ä½œçš„å¯¹è±¡\n  ```\n\n  ä¾‹å¦‚ï¼š\n\n  - æˆ‘ä»¬å¯ä»¥è¾“å…¥ ``docker container --help`` æŸ¥çœ‹éƒ½æœ‰ä»€ä¹ˆå¯ä»¥æ‰§è¡Œçš„å‘½ä»¤\n\n    ![å›¾ç‰‡åŠ è½½å¤±è´¥](7.png)\n\n    ```shell\n    # åˆ—å‡ºå½“å‰è¿è¡Œçš„å®¹å™¨\n    docker container ls\n    \n    # åˆ—å‡ºæ‰€æœ‰å®¹å™¨\n    docker container ls -a\n    ```\n\n  - æˆ‘ä»¬ä¹Ÿå¯ä»¥è¾“å…¥ ``docker container ls --help`` æ¥æŸ¥çœ‹éƒ½æœ‰ä»€ä¹ˆå‚æ•°\n\n    ![å›¾ç‰‡åŠ è½½å¤±è´¥](8.png)\n\n    **Aliasesï¼š**ls å¯ä»¥æ›¿æ¢æˆä»€ä¹ˆ\n\n    **Optionsï¼š**å¯ä»¥ä½¿ç”¨çš„å‚æ•°é€‰é¡¹\n\n\n## 2ã€docker çš„é•œåƒ VS å®¹å™¨\n\n### 1.**image** é•œåƒ\n\n- **Docker image** æ˜¯ä¸€ä¸ª **read only** æ–‡ä»¶\n- è¿™ä¸ªæ–‡ä»¶åŒ…å«æ–‡ä»¶ç³»ç»Ÿï¼Œæºç ï¼Œåº“æ–‡ä»¶ï¼Œä¾èµ–ï¼Œå·¥å…·ç­‰ä¸€äº›è¿è¡Œ **application** æ‰€éœ€è¦çš„æ–‡ä»¶\n- å¯ä»¥ç†è§£æˆä¸€ä¸ªæ¨¡æ¿\n- **Docker image** å…·æœ‰åˆ†å±‚çš„æ¦‚å¿µ\n\n### 2.**container** å®¹å™¨\n\n- å¯ä»¥ç†è§£æˆï¼šâ€œä¸€ä¸ªè¿è¡Œä¸­çš„ **docker image**â€ \n- å®è´¨æ˜¯å¤åˆ¶ **image** å¹¶åœ¨ **image** æœ€ä¸Šå±‚åŠ ä¸Šä¸€å±‚ **read write** çš„å±‚ï¼ˆç§°ä¹‹ä¸º **container layer**ï¼Œå®¹å™¨å±‚ï¼‰\n- åŸºäºåŒä¸€ä¸ª **image** å¯ä»¥åˆ›å»ºå¤šä¸ª **container**\n\n### 3.docker image çš„è·å–\n\n- è‡ªå·±åˆ¶ä½œ\n- ä» **registry** æ‹‰å–ï¼ˆæ¯”å¦‚ **docker hub**ï¼‰\n\n## 3ã€å®¹å™¨çš„åŸºæœ¬æ“ä½œ\n\n### 1.åˆ›å»ºä¸€ä¸ªå®¹å™¨\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ `docker container run [image_REPOSITORY]` æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](9.png)\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸè¿è¡Œäº†ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ‰“å¼€ä¸€ä¸ªçª—å£æŸ¥çœ‹ä¸€ä¸‹æ­£åœ¨è¿è¡Œçš„ **container**ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](10.png)\n\n\n\n### 2.åœæ­¢å®¹å™¨\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ `docker container stop [IDs or NAMES]` æˆ–è€… `ctrl + c` æ¥åœæ­¢ä¸€ä¸ªå®¹å™¨\n\n**æ³¨æ„ï¼š**åœ¨ **windows** ä¸­ä½¿ç”¨ `ctrl + c`å¹¶ä¸èƒ½åœæ­¢å®¹å™¨ï¼Œå®é™…ä¸Šè¿˜æ˜¯åœ¨åå°è¿è¡Œçš„\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](11.png)\n\n### 3.é‡æ–°å¯åŠ¨åœæ­¢çš„å®¹å™¨\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ `docker container start [IDs or NAMES]` æ¥é‡æ–°å¯åŠ¨å®¹å™¨ \n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](15.png)\n\n### 4.åˆ é™¤å®¹å™¨\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ `docker container rm [IDs or NAMES]` æ¥åˆ é™¤ä¸€ä¸ªå®¹å™¨\n\né¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](12.png)\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå·²ç»åœæ­¢äº†çš„å®¹å™¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ é™¤æ‰è¿™ä¸ªå®¹å™¨ï¼Œå†æŸ¥çœ‹ä¸€é\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](13.png)\n\né€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¹å™¨å·²ç»è¢«åˆ é™¤äº†ã€‚\n\n## 4ã€å®¹å™¨çš„ä¸¤ç§æ¨¡å¼ï¼ˆattachedã€detachedï¼‰\n\n### 1.attached\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `docker container run -p 80:80 nginx` æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œ`-p 80:80` çš„æ„æ€æ˜¯å°†å®¹å™¨çš„å†…éƒ¨ç«¯å£æ˜ å°„åˆ°å¤–éƒ¨ç«¯å£ä¸Šã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](19.png)\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»å¯åŠ¨æˆåŠŸäº†ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—®ä¸€ä¸‹è™šæ‹Ÿæœºçš„ **80** ç«¯å£\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](20.png) \n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](21.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥æˆåŠŸè®¿é—®ï¼Œå¹¶ä¸”å·²ç»æ‰“å°äº†ç›¸å…³æ—¥å¿— \n\n<font color=\"red\">å…¶å®ï¼Œattached æ¨¡å¼å°±æ˜¯ï¼Œæˆ‘ä»¬çš„å‘½ä»¤ä¼šä¸å®¹å™¨å…±äº«ã€‚å°±åƒæˆ‘ä»¬åœ¨ linux æˆ–è€… mac çš„ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ª docker å®¹å™¨åï¼Œä¼šæ˜¾å¼çš„æ˜¾ç¤ºåœ¨çª—å£ä¸­ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ `ctrlÂ +Â c`Â åï¼Œå®¹å™¨ä¹Ÿä¼šåœæ­¢ï¼Œè¿™å°±æ˜¯ attached æ¨¡å¼</font>\n\n### 2.detached\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `docker container run -d -p 80:80 nginx` æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ã€‚å…¶ä¸­ `-d` æ˜¯æŒ‡ä½¿ç”¨ **detached** æ¨¡å¼å¯åŠ¨ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](22.png)\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°å®¹å™¨çš„ **id**ï¼Œå¹¶ä¸èƒ½çœ‹åˆ°ç›¸å…³ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å®¹å™¨å·²ç»æˆåŠŸè‡ªåŠ¨äº†ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—®ä¸€ä¸‹è™šæ‹Ÿæœºçš„ **80** ç«¯å£ï¼Œå°±å¯ä»¥çœ‹åˆ°ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯å¹¶æ²¡æœ‰æ‰“å°ã€‚\n\nå¦‚æœï¼Œæˆ‘ç°åœ¨æƒ³ **attach** åˆ°å®¹å™¨ä¸­è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥æ‰§è¡Œ **docker container attach [id or names]**ï¼Œæ¥ **attach** åˆ°æˆ‘ä»¬çš„å®¹å™¨ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](23.png)\n\né€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸ **attach** åˆ°æˆ‘ä»¬çš„å®¹å™¨ä¸­äº†\n\nå¦‚æœæˆ‘ä»¬ä¸æƒ³ **attach** åˆ°æˆ‘ä»¬çš„å®¹å™¨ä¸­ï¼Œå¹¶ä¸”è¿˜æƒ³çœ‹æ—¥å¿—æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\nè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ `docker container logs -f [ids or NAMES]` æ¥æŸ¥çœ‹æ—¥å¿—ã€‚**-f** æ˜¯åŠ¨æ€çš„è·Ÿè¸ªæˆ‘ä»¬çš„æ—¥å¿—\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](24.png)\n\n## 5ã€å®¹å™¨çš„äº¤äº’æ¨¡å¼\n\n1. æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª **ubuntu** å®¹å™¨\n\n   ```shell\n   # -it æ˜¯æŒ‡äº¤äº’å¼çš„æ¨¡å¼\n   # sh æ‰§è¡Œçš„å‘½ä»¤ï¼Œå°±æ˜¯è¿›å…¥åˆ°äº¤äº’å¼çš„ ubuntu çš„å‘½ä»¤è¡Œ\n   docker container run -it ubuntu sh\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](25.png)\n\n   è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»è¿›å…¥åˆ°äº† **ubuntu** çš„å‘½ä»¤è¡Œäº†ã€‚\n\n   å½“æˆ‘ä»¬æ‰§è¡Œ **exit** é€€å‡ºåï¼Œåœ¨æŸ¥çœ‹å®¹å™¨è¿è¡Œæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ° **ubuntu** è¿™ä¸ªå®¹å™¨å·²ç»é€€å‡ºäº†ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](26.png)\n\n2. äº¤äº’å¼çš„è¿›å…¥åˆ°å·²ç»å¯åŠ¨çš„å®¹å™¨ä¸­\n\n   ```shell\n   # exec æ‰§è¡Œ\n   # -it äº¤äº’æ¨¡å¼\n   # sh å‘½ä»¤è¡Œ\n   docker container exec -it 79 sh\n   ```\n\n   è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»è¿›æ¥äº†ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](27.png)\n\n   è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†æ¬¡æ‰§è¡Œ **exit**ï¼Œå¹¶æŸ¥çœ‹å®¹å™¨çš„å¯åŠ¨æƒ…å†µã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](28.png)\n\n   è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åªæ˜¯é€€å‡ºäº†äº¤äº’å¼çš„shellï¼Œå¹¶ä¸å½±å“è¿™ä¸ªå®¹å™¨ã€‚<font color=\"red\">å› ä¸ºæˆ‘ä»¬äº¤äº’å¼çš„åˆ›å»ºä¸€ä¸ªå®¹å™¨å’Œäº¤äº’å¼çš„è¿›å…¥æŸä¸ªå®¹å™¨æ˜¯ä¸ä¸€æ ·çš„</font>\n\n## 6ã€å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«ï¼ˆContainer vs VMï¼‰\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](29.png)\n\nè™šæ‹Ÿæœºæ˜¯åœ¨ **hypervisor** è™šæ‹ŸåŒ–å±‚ä¸Šåˆ›å»ºä¸€æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œè€Œå®¹å™¨æ˜¯åœ¨ **Container Engine** å®¹å™¨å¼•æ“ä¸Šçš„ç¨‹åºï¼Œå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚\n\n**å®¹å™¨ä¸æ˜¯Miniè™šæ‹Ÿæœºï¼š**\n\n- å®¹å™¨å…¶å®æ˜¯è¿›ç¨‹\n- å®¹å™¨ä¸­çš„è¿›ç¨‹è¢«é™åˆ¶äº†å¯¹ **CPU** å†…å­˜ç­‰èµ„æºçš„è®¿é—®\n- å½“è¿›ç¨‹ç»“æŸåï¼Œå®¹å™¨å°±é€€å‡ºäº†ã€‚\n\né€šè¿‡ `docker container top [id name]` æ¥æŸ¥çœ‹å®¹å™¨è¿è¡Œäº†é‚£äº›è¿›ç¨‹\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](30.png)\n\nä½¿ç”¨ `pstree -halps id` æŸ¥çœ‹è¿›ç¨‹çš„ä¾èµ–å…³ç³»ï¼Œä½¿ç”¨ `yum install psmisc` æˆ–è€… `apt-get install psmisc` å®‰è£…\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](31.png)\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](32.png)\n\n## 7ã€docker container run å®¹å™¨åˆ›å»ºçš„èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\n\n`docker container run -d -p 80:80 --name test nginx`\n\n1. åœ¨æœ¬åœ°æŸ¥æ‰¾æ˜¯å¦æœ‰ **nginx** è¿™ä¸ª **image** é•œåƒï¼Œä½†æ˜¯å‘ç°æ²¡æœ‰\n2. å»è¿œç¨‹çš„ **image registry** æŸ¥æ‰¾ **nginx** é•œåƒï¼ˆé»˜è®¤çš„ **registry** æ˜¯ **Docker Hub**ï¼‰\n3. ä¸‹è½½æœ€æ–°ç‰ˆçš„ **nginx** é•œåƒï¼ˆ**nginx:latest** é»˜è®¤ï¼‰\n4. åŸºäº **nginx** é•œåƒæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå¹¶å‡†å¤‡è¿è¡Œ\n5. **docker engine** åˆ†é…ä¸ªè¿™ä¸ªå®¹å™¨ä¸€ä¸ªè™šæ‹Ÿçš„ **IP** åœ°å€\n6. åœ¨å®¿ä¸»æœºä¸Šæ‰“å¼€ 80 ç«¯å£å¹¶æŠŠå®¹å™¨çš„ 80 ç«¯å£è½¬å‘åˆ°å®¿ä¸»æœºä¸Š\n7. å¯åŠ¨å®¹å™¨ï¼Œè¿è¡ŒæŒ‡å®šçš„å‘½ä»¤\n\n# å››ã€é•œåƒçš„åˆ›å»ºä½¿ç”¨ç®¡ç†å’Œå‘å¸ƒ\n\n## 1ã€é•œåƒçš„è·å–\n\n- `pull from registry(online)` ä» **registry** æ‹‰å–\n  - **public** å…¬æœ‰\n  - **private** ç§æœ‰\n- `build from Dockerfile(online)` ä» **Dockerfile** æ„å»º\n- `load from file(offline)` æ–‡ä»¶å¯¼å…¥ï¼ˆç¦»çº¿ï¼‰\n\n[Dockerhub å®˜ç½‘](https://hub.docker.com/)ã€[Red Hat quay](recovery.quay.io)\n\n## 2ã€é•œåƒçš„è·å–\n\n### 1.åœ¨ dockerhub æˆ– quay.io è·å–\n\n1. æˆ‘ä»¬å…ˆçœ‹åˆ°ä¸€ä¸‹ **image** éƒ½æœ‰å“ªäº›å‘½ä»¤\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](33.png)\n\n2. **pull** æ‹‰å–é•œåƒ\n\n   - åœ¨ **Docker hub** æ‰¾åˆ°è¦æ‹‰å–çš„é•œåƒï¼Œæ‰§è¡Œå‘½ä»¤æ‹‰å–å³å¯ã€‚\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](34.png)\n\n     è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯ï¼š`docker pull nginx`ï¼Œè¿™æ˜¯æ—©æœŸç‰ˆæœ¬çš„å‘½ä»¤ï¼Œå»ºè®®ä½¿ç”¨ï¼š`docker image pull nginx`\n\n   - æˆ‘ä»¬è¿˜å¯ä»¥æ‹‰å–åˆ«çš„ç‰ˆæœ¬çš„\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](35.png)\n\n     è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ï¼š`docker image pull nginx:1.20.1` å°±å¯ä»¥æ‹‰å–äº†ã€‚\n\n3. æŸ¥çœ‹æŸä¸ªé•œåƒçš„è¯¦ç»†ä¿¡æ¯\n\n   ä½¿ç”¨ `docker image inspect imageID` å³å¯\n\n4. åˆ é™¤\n\n   ä½¿ç”¨ `docker image rm imageID` å³å¯ã€‚\n\n   <font color=\"red\">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé•œåƒæœ‰æŸä¸ªå®¹å™¨åœ¨ä½¿ç”¨çš„è¯æ˜¯æ— æ³•åˆ é™¤çš„ã€‚æˆ‘å¿…é¡»åˆ é™¤æ‰ä½¿ç”¨çš„å®¹å™¨å†èƒ½åˆ é™¤</font>\n\n### 2.å¯¼å…¥å¯¼å‡ºæ–¹å¼\n\n1. å¯¼å‡º\n\n   æˆ‘ä»¬å¯ä»¥å†åˆ«çš„ç”µè„‘æˆ–è€…ç¯å¢ƒä¸­ä¿å­˜ä¸€ä¸ªé•œåƒçš„æ–‡ä»¶ã€‚\n\n   ```shell\n   # nginx:1.20.1 è¦ä¿å­˜çš„é•œåƒä»¥åŠç‰ˆæœ¬ï¼Œå¦‚æœä¸æ·»åŠ ç‰ˆæœ¬é»˜è®¤latestç‰ˆæœ¬\n   # -o æ˜¯æŒ‡ output è¾“å‡º\n   # nginx.image ä¿å­˜çš„æ–‡ä»¶åå­—\n   docker image save nginx:1.20.1 -o nginx\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](36.png)\n\n2. å¯¼å…¥\n\n   æˆ‘ä»¬å…ˆæŠŠ 1.20.1 ç‰ˆæœ¬çš„åˆ é™¤æ‰ï¼Œåœ¨è¿›è¡Œå¯¼å…¥æŸ¥çœ‹\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](37.png)\n\n   ```shell\n   # -i æ˜¯æŒ‡ input è¾“å…¥\n   docker image load -i nginx\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](38.png)\n\n### 3.Dockerfile æ–¹å¼\n\n#### 1ï¼‰ä»€ä¹ˆæ˜¯ Dockerfile?\n\n- æ˜¯ç”¨äºæ„å»º **docker** é•œåƒçš„æ–‡ä»¶\n- åŒ…å«äº†æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤\n- æœ‰ç‰¹å®šçš„è¯­æ³•è§„åˆ™\n\n#### 2ï¼‰ä¸¾ä¾‹ï¼šæ‰§è¡Œä¸€ä¸ª Python ç¨‹åº\n\nå‡å¦‚æˆ‘ä»¬è¦åœ¨ä¸€å° **ubuntu 21.04** ä¸Šè¿è¡Œä¸‹é¢è¿™ä¸ª **hello.py** çš„ **Python** ç¨‹åº\n\n**hello.py** çš„æ–‡ä»¶å†…å®¹ï¼š\n\n```python\nprint(\"hello docker\")\n```\n\nç¬¬ä¸€æ­¥ï¼Œå‡†å¤‡ **Python** çš„ç¯å¢ƒ\n\n```shell\napt-get update && /\nDEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends -y python3.9 python3-pip python3.9-dev\n```\n\nç¬¬äºŒæ­¥ï¼Œè¿è¡Œ **hello.py**\n\n```shell\n$ python3 hello.py\nè¾“å…¥ï¼šhello docker\n```\n\n#### 3ï¼‰ä¸€ä¸ª Dockerfile çš„åŸºæœ¬ç»“æ„\n\n1. **Dockerfile**\n\n   ```dockerfile\n   # å¼•å…¥ ubuntu:21.04 é•œåƒ\n   FROM ubuntu:21.04\n   # æ‰§è¡Œå‘½ä»¤å®‰è£… python çš„ç¯å¢ƒ\n   RUN apt-get update && \\\n   \tDEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends -y python3.9 python3-pip python3.9-dev\n   # å°†æœ¬åœ°çš„ hello.py æ–‡ä»¶æ·»åŠ åˆ° / æ ¹ç›®å½•ä¸‹\n   ADD hello.py /\n   # æ‰§è¡Œå‘½ä»¤\n   CMD [\"python3\",\"/hello.py\"]\n   ```\n\n   è¯¦ç»†å¯è§ [Dockerfile å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/engine/reference/builder/)\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](39.png)\n\n2. **é€šè¿‡ Dockerfile æ„å»ºé•œåƒ**\n\n   ç”±äºæˆ‘çš„ **centos** æ˜¯ä¸€å°è™šæ‹Ÿæœºï¼Œå¹¶ä¸”æ²¡æœ‰åšæ¡¥æ¥ï¼Œæ‰€ä»¥åœ¨ **centos** ä¸­æ‹‰ä¸‹æ¥çš„é•œåƒç½‘ç»œä¸é€šæ— æ³•è¿›è¡Œ **apt-get update**ï¼Œæ‰€ä»¥åœ¨æˆ‘çš„å¦ä¸€å° **kali** ç³»ç»Ÿçš„ç”µè„‘ä¸Šè¿›è¡Œçš„æµ‹è¯•ï¼Œ<font color=\"red\">å¹¶ä¸”åç»­æ‰€æœ‰æµ‹è¯•éƒ½åœ¨ **kali** ä¸Šè¿›è¡Œ</font>\n\n   - é¦–å…ˆæˆ‘ä»¬å…ˆå°† **hello.py** å’Œ **Dockerfile** å‡†å¤‡å¥½\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](40.png)\n\n   - é€šè¿‡ `docker image build` è¿›è¡Œæ„å»º\n\n     ```shell\n     # -f DockerFile çš„åå­—\n     # -t æ„å»ºåé•œåƒåç§°\n     # . å½“å‰ç›®å½•ä¸‹\n     docker image build -t hello .\n     \n     docker image build -f DockfileName -t Tag .\n     ```\n     \n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](41.png)\n     \n   - å¯ä»¥çœ‹åˆ°é•œåƒå·²ç»æ„å»ºæˆåŠŸäº†\n   \n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](42.png)\n   \n   - ä½¿ç”¨æ„å»ºçš„é•œåƒåˆ›å»ºå®¹å™¨\n   \n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](43.png)\n   \n     å¯ä»¥çœ‹åˆ°ï¼Œ**hello docker** å·²ç»æ‰“å°å‡ºæ¥äº†ï¼Œå¹¶ä¸”å®¹å™¨å·²ç»é€€å‡ºäº†ã€‚\n   \n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](44.png)\n   \n   - ä¸ºç”šä¹ˆç›´æ¥é€€å‡ºäº†ï¼Ÿ\n   \n     å› ä¸º **Dockerfile** ä¸­çš„ `CMD [\"python3\",\"/hello.py\"]` æ‰§è¡Œå®Œä¹‹åå°±åœäº†ï¼Œè¿™ä¸ªè¿›ç¨‹åœäº†ï¼Œå®¹å™¨è‡ªç„¶å°±åœäº†\n\n### 4ã€é€šè¿‡ **container** å®¹å™¨ç”Ÿæˆä¸€ä¸ªé•œåƒ\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `docker container commit contaienrId ImageName` å‘½ä»¤ï¼Œæ ¹æ® **container** ç”Ÿæˆä¸€ä¸ªé•œåƒ\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](51.png)\n\n## 3ã€é•œåƒçš„åˆ†äº«\n\n### 1.å¯ä»¥é€šè¿‡å¯¼å‡ºçš„æ–¹å¼è¿›è¡Œåˆ†äº«\n\n```shell\n# nginx:1.20.1 è¦ä¿å­˜çš„é•œåƒä»¥åŠç‰ˆæœ¬ï¼Œå¦‚æœä¸æ·»åŠ ç‰ˆæœ¬é»˜è®¤latestç‰ˆæœ¬\n# -o æ˜¯æŒ‡ output è¾“å‡º\n# nginx.image ä¿å­˜çš„æ–‡ä»¶åå­—\ndocker image save nginx:1.20.1 -o nginx\n```\n\n### 2.push åˆ° dockerhub ä¸­è¿›è¡Œåˆ†äº«\n\n1. é¦–å…ˆè¦åœ¨ **dockerhub** æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œæˆ‘ä»¬çš„é•œåƒæ ¼å¼éƒ½æ˜¯ **id/imageName**\n\n2. åœ¨ **push** ä¹‹å‰æˆ‘ä»¬çš„é•œåƒ **tag** è¦ç¬¦åˆæˆ‘ä»¬ **dockerhub** çš„è§„èŒƒ\n\n   - æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡æ–°æ„å»ºæ¥ä¿®æ”¹é•œåƒçš„ **tag**\n\n     ```shell\n     docker image build -t DockerhubID/imageName:version .\n     ```\n\n   - æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å·²ç»å­˜åœ¨çš„é•œåƒå¤åˆ¶ä¸€ä¸ªæ–°çš„é•œåƒ\n\n     ```shell\n     docker image tag hello sunyubk/hello:1.0\n     ```\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](45.png)\n\n   <font color=\"red\">æ³¨æ„ï¼šé€šè¿‡ä»¥ä¸Šä¸¤ç§æ–¹å¼ç”Ÿæˆçš„æ–°çš„é•œåƒçš„ id æ˜¯ç›¸åŒçš„ï¼Œæ— æ³•æ ¹æ® id è¿›è¡Œåˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ image:tag åˆ é™¤</font>\n\n3. push\n\n   - åœ¨ **push **ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦ç™»å½•åˆ° **dockerhub**ï¼Œ`docker login`\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](46.png)\n\n     è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»ç™»å½•æˆåŠŸäº†\n\n   - æˆ‘ä»¬å¯ä»¥é€šè¿‡ `docker image push sunyubk/hello:1.0` è¿›è¡Œ **push **äº†ã€‚\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](47.png)\n\n   - **push ** åæˆ‘ä»¬å°±å¯ä»¥åœ¨æˆ‘ä»¬çš„ **dockerhub** ä¸­çœ‹åˆ°æˆ‘ä»¬ **push** çš„é•œåƒäº†\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](48.png)\n\n4. æ‹‰å–æµ‹è¯•\n\n   - æˆ‘ä»¬å…ˆå°†æœ¬åœ°çš„ **sunyubk/hello:1.0** è¿™ä¸ªé•œåƒåˆ é™¤æ‰åœ¨è¿›è¡Œæ‹‰å–\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](49.png)\n\n   - æˆ‘ä»¬å°†é•œåƒæ‹‰å–ä¸‹æ¥ï¼Œå¹¶è¿è¡Œæµ‹è¯•\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](50.png)\n\n# äº”ã€Dockerfile\n\n## 1ã€åŸºç¡€é•œåƒçš„é€‰æ‹©\n\n- å®˜æ–¹é•œåƒä¼˜äºéå®˜æ–¹é•œåƒï¼Œå¦‚æœæ²¡æœ‰å®˜æ–¹é•œåƒï¼Œåˆ™å°½é‡é€‰æ‹© **Dockerfile** å¼€æºçš„\n- å›ºå®šç‰ˆæœ¬ **tag** è€Œä¸æ˜¯æ¯æ¬¡éƒ½æ˜¯ç”¨ **latest**\n- å°½é‡é€‰æ‹©ä½“ç§¯å°çš„é•œåƒ\n\n## 2ã€é€šè¿‡ RUN æ‰§è¡ŒæŒ‡ä»¤\n\n`RUN` ä¸»è¦ç”¨äºåœ¨ **image** é‡Œæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ¯”å¦‚å®‰è£…è½¯ä»¶ï¼Œä¸‹è½½æ–‡ä»¶ç­‰ã€‚\n\n```shell\n$ apt-get update\n$ apt-get install wget\n$ wget wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linxu_amd64.tar.gz\n$ tar -zxvf ipinfo_2.0.1_linxu_amd64.tar.gz\n$ mv ipinfo_2.0.1_linxu_amd64.tar.gz /usr/bin/ipinfo\n$ rm -rf ipinfo_2.0.1_linxu_amd64.tar.gz\n```\n\n**Dockerfile**\n\n```dockerfile\nFROM ubuntu:21.04\nRUN apt-get update\nRUN apt-get install wget\nRUN wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linxu_amd64.tar.gz\nRUN tar -zxvf ipinfo_2.0.1_linxu_amd64.tar.gz\nRUN ipinfo_2.0.1_linxu_amd64.tar.gz /usr/bin/ipinfo\nRUN rm -rf ipinfo_2.0.1_linxu_amd64.tar.gz\n```\n\n**é•œåƒçš„å¤§å°å’Œåˆ†å±‚**\n\næ¯ä¸ª `RUN` å‘½ä»¤çš„æ‰§è¡Œéƒ½ä¼šäº§ç”Ÿä¸€å±‚ **image layer** ï¼Œè¿™æ ·ä¼šå¯¼è‡´é•œåƒæ¯”è¾ƒè‡ƒè‚¿ã€‚\n\n**æ”¹è¿›ç‰ˆ Dockerfile**\n\n```dockerfile\nFROM ubuntu:21.04\nRUN apt-get update $$ \\\n\tapt-get install wget $$ \\\n\twget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linxu_amd64.tar.gz $$ \\\n\ttar -zxvf ipinfo_2.0.1_linxu_amd64.tar.gz $$ \\\n\tmv ipinfo_2.0.1_linxu_amd64.tar.gz /usr/bin/ipinfo $$ \\\n\trm -rf ipinfo_2.0.1_linxu_amd64.tar.gz\n```\n\nè¿™æ ·ç¼–å†™çš„ **Dockerfile** åªä¼šé€šè¿‡ä¸€ä¸ª `RUN` å‘½ä»¤æ‰§è¡Œï¼Œåªä¼šäº§ç”Ÿä¸€å±‚ã€‚\n\n## 3ã€æ–‡ä»¶å¤åˆ¶å’Œç›®å½•æ“ä½œ\n\n1. æ–‡ä»¶å¤åˆ¶\n\n   å¾€é•œåƒä¸­å¤åˆ¶æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ `copy` å’Œ `add`ã€‚\n\n   **å¤åˆ¶æ™®é€šæ–‡ä»¶**\n\n    `copy` å’Œ `add` éƒ½å¯ä»¥æŠŠ **local** çš„ä¸€ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œå¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»º\n\n   ```dockerfile\n   FROM python:3.9.5-alpine3.13\n   COPY hello.py /app/hello.py\n   ```\n\n   **å¤åˆ¶å‹ç¼©æ–‡ä»¶**\n\n   `add` æ¯” `copy` é«˜çº§ä¸€ç‚¹çš„åœ°æ–¹å°±æ˜¯ï¼Œå¦‚æœå¤åˆ¶ä¸€ä¸ª **gzip** ç­‰å‹ç¼©æ–‡ä»¶æ—¶ï¼Œ`add` ä¼šå¸®åŠ©æˆ‘ä»¬å»è‡ªåŠ¨è§£å‹ç¼©æ–‡ä»¶ã€‚\n\n   ```dockerfile\n   FROM python:3.9.5-alpine3.13\n   ADD hello.tar.gz /app/\n   ```\n\n   **å¦‚ä½•é€‰æ‹©**\n\n   åœ¨ `copy` å’Œ `add` æŒ‡ä»¤çš„é€‰æ‹©çš„æ—¶å€™ï¼Œå¯ä»¥éµå¾ªè¿™æ ·çš„åŸåˆ™ï¼Œæ‰€æœ‰æ–‡ä»¶å¤åˆ¶å‡ä½¿ç”¨ `copy`ï¼Œä»…åœ¨éœ€è¦è‡ªåŠ¨è§£å‹ç¼©çš„åœºåˆä½¿ç”¨ `add`ã€‚\n\n2. ç›®å½•æ“ä½œ\n\n   **ç›®å½•åˆ‡æ¢**\n\n   `WORKDIR` åˆ‡æ¢ç›®å½•ï¼Œå¦‚æœè¦åˆ‡æ¢çš„ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½•\n\n   ```dockerfile\n   FROM python:3.9.5-alpine3.13\n   WORKDIR /app\n   COPY hello.py /hello.py\n   ```\n\n## 4ã€æ„å»ºå‚æ•°å’Œç¯å¢ƒå˜é‡ï¼ˆARG vs ENVï¼‰\n\n`ARG` å’Œ `ENV` æ˜¯ç»å¸¸è¢«æ··æ·†çš„ä¸¤ä¸ª **Dockerfile** çš„è¯­æ³•ï¼Œéƒ½å¯ä»¥ç”¨æ¥è®¾ç½®ä¸€ä¸ª **å˜é‡**ã€‚ä½†å®é™…ä¸Šä¸¤è€…ä¼šæœ‰å¾ˆå¤šçš„ä¸åŒã€‚\n\n```dockerfile\nFROM ubuntu:21.04\nRUN apt-get update $$ \\\n\tapt-get install wget $$ \\\n\twget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linxu_amd64.tar.gz $$ \\\n\ttar -zxvf ipinfo_2.0.1_linxu_amd64.tar.gz $$ \\\n\tmv ipinfo_2.0.1_linxu_amd64.tar.gz /usr/bin/ipinfo $$ \\\n\trm -rf ipinfo_2.0.1_linxu_amd64.tar.gz\n```\n\n**ENV**\n\n```dockerfile\nFROM ubuntu:21.04\nENV VERSION=2.0.1\nRUN apt-get update $$ \\\n\tapt-get install wget $$ \\\n\twget https://github.com/ipinfo/cli/releases/download/ipinfo-${VERSION}/ipinfo_${VERSION}_linxu_amd64.tar.gz $$ \\\n\ttar -zxvf ipinfo_${VERSION}_linxu_amd64.tar.gz $$ \\\n\tmv ipinfo_${VERSION}_linxu_amd64.tar.gz /usr/bin/ipinfo $$ \\\n\trm -rf ipinfo_${VERSION}_linxu_amd64.tar.gz\n```\n\n**ARG**\n\n```dockerfile\nFROM ubuntu:21.04\nARG VERSION=2.0.1\nRUN apt-get update $$ \\\n\tapt-get install wget $$ \\\n\twget https://github.com/ipinfo/cli/releases/download/ipinfo-${VERSION}/ipinfo_${VERSION}_linxu_amd64.tar.gz $$ \\\n\ttar -zxvf ipinfo_${VERSION}_linxu_amd64.tar.gz $$ \\\n\tmv ipinfo_${VERSION}_linxu_amd64.tar.gz /usr/bin/ipinfo $$ \\\n\trm -rf ipinfo_${VERSION}_linxu_amd64.tar.gz\n```\n\n**åŒºåˆ«**\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](52.png)\n\n- **ARG** ä½¿ç”¨çš„èŒƒå›´æ˜¯ **Dockerfile** æ„å»ºçš„é˜¶æ®µï¼Œæ„å»ºååˆ™æ— æ³•ä½¿ç”¨äº†ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡ä¸ä¼šä¿å­˜åœ¨é•œåƒä¸­ã€‚\n- **ENV** ä½¿ç”¨çš„èŒƒå›´ä¸ä»…æ˜¯åœ¨ **Dockerfile** æ„å»ºçš„é˜¶æ®µï¼Œè€Œä¸”è¿™ä¸ªå˜é‡ä¼šä½œä¸º **ç¯å¢ƒå˜é‡** ä¿å­˜åœ¨é•œåƒä¸­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªé•œåƒå»åˆ›å»ºå®¹å™¨çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå˜é‡\n\n<font color=\"red\">ARG è¿˜å¯ä¸€åœ¨æ„å»ºçš„æ—¶å€™åŠ¨æ€çš„ä¿®æ”¹å€¼ï¼Œ ENV åˆ™ä¸å¯ä»¥</font>\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](53.png)\n\nä¾‹å¦‚ï¼š\n\n```dockerfile\ndocker image build -f ./Dockerfile-arg -t ipinfo-arg-2.0.0 --build-arg VERSION=2.0.0 .\n```\n\n## 5ã€CMD å®¹å™¨å¯åŠ¨å‘½ä»¤\n\n**CMD** å¯ä»¥ç”¨æ¥è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶é»˜è®¤ä¼šæ‰§è¡Œçš„å‘½ä»¤ã€‚\n\n- å®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤\n- å¦‚æœ **docker container run** å¯åŠ¨å®¹å™¨æ˜¯æŒ‡å®šäº†å…¶å®ƒå‘½ä»¤ï¼Œåˆ™ **CMD** å‘½ä»¤ä¼šè¢«å¿½ç•¥\n- å¦‚æœå®šä¹‰äº†å¤šä¸ª **CMD** ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šè¢«æ‰§è¡Œ\n\n## 6ã€ENTRYPOINT å®¹å™¨å¯åŠ¨å‘½ä»¤\n\n**ENTRYPOINT** ä¹Ÿå¯ä»¥è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½†æ˜¯å’Œ **CMD** æ˜¯æœ‰åŒºåˆ«çš„ã€‚\n\n- **CMD** è®¾ç½®çš„å‘½ä»¤ï¼Œå¯ä»¥å† `docker container run` æ—¶ä¼ å…¥å…¶ä»–å‘½ä»¤ï¼Œè¦†ç›–æ‰ **CMD** å‘½ä»¤ï¼Œä½†æ˜¯ **ENTRYPOINT** æ‰€è®¾ç½®çš„å‘½ä»¤æ˜¯ä¸€å®šä¼šè¢«æ‰§è¡Œçš„ã€‚\n- **ENTRYPOINT** å’Œ **CMD** å¯ä»¥è”åˆä½¿ç”¨ï¼Œ**ENTRYPOINT** è®¾ç½®æ‰§è¡Œçš„å‘½ä»¤ï¼Œ**CMD** ä¼ é€’å‚æ•°\n\n1. å‡†å¤‡ä¸‰ä¸ª **Dockerfile**ï¼Œå¹¶æ„å»ºæˆç›¸åº”çš„é•œåƒ\n\n   **Dockerfile-cmd**\n\n   ```dockerfile\n   FROM ubuntu:21.04\n   CMD [\"echo\",\"hello docker\"]\n   ```\n\n   **Dockerfile-entrypoint**\n\n   ```dockerfile\n   FROM ubuntu:21.04\n   ENTRYPOINT [\"echo\",\"hello docker\"]\n   ```\n\n   **Dockerfile-both**\n\n   ```dockerfile\n   FROM ubuntu:21.04\n   ENTRYPOINT [\"echo\"]\n   CMD []\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](54.png)\n\n2. æ ¹æ®é•œåƒåˆ›å»ºå®¹å™¨\n\n   ```shell\n   # -rm è¿è¡Œååˆ é™¤å®¹å™¨\n   docker container run --rm -it imagename\n   ```\n\n   **demo-cmd**\n\n   åœ¨ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™æŒ‡å®šå‘½ä»¤ï¼Œåˆ™ **CMD** ä¸­çš„å‘½ä»¤ä¸ä¼šè¿è¡Œ\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](55.png)\n\n   **demo-entrypoint**\n\n   åœ¨ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™æŒ‡å®šæŒ‡ä»¤ï¼ŒæŒ‡ä»¤ä¼šä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼ŒåŸæœ¬ **Dockerfile-entrypoint** ä¸­çš„ **ENTRYPOINT** è‚¯å®šä¼šæ‰§è¡Œã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](56.png)\n\n   **demo-bot**\n\n   åœ¨ä¸‹å›¾ ä¸­å¯ä»¥çœ‹åˆ°ï¼š\n\n   ç¬¬ä¸€éå‘½ä»¤ä»€ä¹ˆéƒ½æ²¡æœ‰æ‰“å°ï¼Œè¿™æ˜¯å› ä¸º **Dockerfile-both** ä¸­çš„ **ENTRYPOINT** æ‰§è¡Œäº† `echo` ,ä½†æ˜¯å¹¶æ²¡æœ‰è®¾ç½®è¦æ‰“å°çš„å€¼ã€‚\n\n   ç¬¬äºŒéå‘½ä»¤æ‰“å°äº†åˆ›å»ºå®¹å™¨æ˜¯æŒ‡å®šçš„å‘½ä»¤ï¼Œè¿™æ˜¯å› ä¸ºå°†æŒ‡å®šçš„å‘½ä»¤ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»äº†ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](56.png)\n\n## 7ã€Shell æ ¼å¼å’Œ Exec æ ¼å¼\n\n**CMD** å’Œ **ENTRYPOINT** éƒ½æ”¯æŒ **Shell** æ ¼å¼å’Œ **Exec** æ ¼å¼\n\n**Shell** æ ¼å¼\n\n```shell\nCMD echo \"hello docker\"\nENTRYPOINT echo \"hello docker\"\n```\n\n**Exec** æ ¼å¼\n\n```shell\nCMD [\"echo\",\"hello docker\"]\nENTRYPOINT [\"echo\",\"hello docker\"]\n```\n\n**æ³¨æ„ Shell è„šæœ¬é—®é¢˜**\n\n```dockerfile\nFROM ubuntu:21.04\nENV NAME=docker\nCMD echo \"hello $NAME\"\n```\n\nå‡å¦‚æˆ‘ä»¬è¦æŠŠä¸Šé¢çš„ **CMD** æ”¹æˆ **Exec** æ ¼å¼ï¼Œä¸‹é¢è¿™æ ·æ”¹æ˜¯ä¸è¡Œçš„ã€‚\n\n```dockerfile\nFROM ubuntu:21.04\nENV NAME=docker\nCMD CMD [\"echo\",\"hello $NAME\"]\n```\n\nå®ƒä¼šæ‰“å°å‡º `hello $NAME`ï¼Œè€Œä¸æ˜¯ `hello docker`ã€‚è¿™é‡Œå°±éœ€è¦ä»¥ **shell** è„šæœ¬çš„æ–¹å¼å»æ‰§è¡Œ\n\n```dockerfile\nFROM ubuntu:21.04\nENV NAME=docker\nCMD CMD [\"sh\",\"-c\",\"echo hello $N\"]\n```\n\n# å…­ã€æ•°æ®æŒä¹…åŒ–\n\nä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æŒä¹…åŒ–ï¼šå› ä¸ºå½“æˆ‘ä»¬å°†å®¹å™¨ï¼ˆ**cotainer**ï¼‰åˆ é™¤ä¹‹åï¼Œé‚£ä¹ˆæˆ‘ä»¬å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ï¼ˆæ•°æ®ä¸éšç€ Container çš„ç»“æŸè€Œç»“æŸï¼‰\n\n## 1ã€Data volume\n\n**Data volume** æ˜¯ **Docker** ä¸€ä¸ª<font color=\"red\">å·</font> çš„æ¦‚å¿µï¼Œå°±æ˜¯ **Docker** ç®¡ç†å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œé»˜è®¤ä½äº `/var/lib/docker/volumes` ç›®å½•ä¸­ã€‚\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ **mysql** çš„é•œåƒæ¥æ¼”ç¤ºï¼š\n\n1. é¦–å…ˆæˆ‘ä»¬å…ˆå‡†å¤‡ **mysql:5.7** çš„é•œåƒ\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](58.png)\n\n2. åˆ›å»ºå®¹å™¨\n\n   å…³äº **MySQL** é•œåƒçš„ä½¿ç”¨å¯ä»¥å‚è€ƒï¼š[dockerhubä¸­mysql](https://hub.docker.com/_/mysql)\n\n   ```shell\n   -e è®¾ç½®mysql rootç”¨æˆ·çš„å¯†ç \n   -v ä½¿ç”¨volumeæŒä¹…åŒ–æ•°æ® volume åç§°ï¼šå®¹å™¨å†…ç›®å½•ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªéšæœºçš„æ–‡ä»¶\n   docker container run -d --name mysql_5.7 -e MYSQL_ROOT_PASSWORD=root -v mysql_data:/var/lib/mysql mysql:5.7\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](59.png)\n\n3. è¿›å…¥å®¹å™¨è¿›è¡Œæµ‹è¯•\n\n   - æˆ‘ä»¬äº¤äº’å¼çš„è¿›å…¥åˆ°å®¹å™¨çš„ä¸­ï¼Œå¹¶è¿æ¥è¿›å…¥mysqlï¼Œå¹¶ä¸”æŸ¥çœ‹æ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®åº“æ˜¯åˆå§‹åŒ–çš„çŠ¶æ€ã€‚\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](60.png)\n\n   - æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶é€€å‡ºåˆ°å®¹å™¨\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](61.png)\n\n   - æˆ‘ä»¬è¿›å…¥å®¹å™¨çš„ `/var/lib/mysql` ç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®åº“åœ¨è¿™é‡Œç”Ÿæˆäº†æ–‡ä»¶å¤¹\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](62.png)\n\n4. é€€å‡ºå®¹å™¨ï¼ŒæŸ¥çœ‹æˆ‘ä»¬æœ¬åœ° **volume**æ–‡ä»¶\n\n   - æŸ¥çœ‹ **volume** åˆ—è¡¨\n\n     ```shell\n     docker volume ls\n     ```\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](63.png)\n\n   - æŸ¥çœ‹å¯¹åº”çš„æ–‡ä»¶ä¿¡æ¯\n\n     ```shell\n     docker volume inspect mysql_data\n     ```\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](64.png)\n\n     è¿™é‡Œçœ‹åˆ°çš„ç›®å½•å°±æ˜¯ä¸å®¹å™¨ä¸­ **mysql** ç›®å½•ç»‘å®šçš„ç›®å½•\n\n   - æˆ‘ä»¬æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](65.png)\n\n     å¯ä»¥çœ‹åˆ°ï¼Œ`test` å·²ç»åœ¨ç›®å½•ä¸‹äº†ã€‚\n\n   **æµ‹è¯•ï¼š**\n\n   1. æˆ‘ä»¬åœ¨å®¹å™¨ä¸­åˆ›å»ºæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼Œä¼šä¸ä¼šåŒæ­¥åˆ°å¯¹åº”çš„volumeä¸­ï¼Ÿ\n\n      - æˆ‘ä»¬å…ˆè¿›å…¥å®¹å™¨ä¸­\n\n      - åœ¨æŒä¹…åŒ–çš„ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹\n\n        ![å›¾ç‰‡åŠ è½½å¤±è´¥](66.png)\n\n      - æˆ‘ä»¬åœ¨ volume ä¸­äº§çœ‹\n\n        ![å›¾ç‰‡åŠ è½½å¤±è´¥](67.png)\n\n        å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶å¤¹åœ¨ volume ä¸­å·²ç»å‡ºç°äº†\n\n   2. å¦‚æœæˆ‘ä»¬å°† volume ä¸­çš„æ–‡ä»¶åˆ é™¤ï¼Œå®¹å™¨ä¸­ä¼šåŒæ­¥ä¹ˆï¼Ÿ\n\n      - æˆ‘ä»¬åˆ é™¤ volume ç›®å½•ä¸­åˆ›å»ºçš„æ–‡ä»¶å¤¹\n\n      - æˆ‘ä»¬å›åˆ°å®¹å™¨ä¸­çš„ç›®å½•æŸ¥çœ‹\n\n        ![å›¾ç‰‡åŠ è½½å¤±è´¥](67.png)\n\n        å¯ä»¥çœ‹åˆ°ï¼Œæ–‡ä»¶å¤¹ä¹Ÿä¸è§äº†\n\n   é€šè¿‡è¿™ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ**volume** å¸®æˆ‘ä»¬åšäº†ä¸€ä¸ªç±»ä¼¼è½¯è¿æ¥çš„åŠŸèƒ½ã€‚åœ¨å®¹å™¨é‡Œé¢çš„æ”¹åŠ¨ï¼Œå¯ä»¥å†å®¿ä¸»æœºä¸­æ„ŸçŸ¥ï¼Œè€Œåœ¨å®¿ä¸»æœºé‡Œé¢çš„æ”¹åŠ¨ï¼Œåœ¨å®¹å™¨ä¸­ä¹Ÿå¯ä»¥æ„ŸçŸ¥ã€‚\n\n   **æ³¨æ„ï¼š**\n\n   - å¦‚æœ **volume** æ˜¯ç©ºçš„ï¼Œè€Œ **container** ä¸­æœ‰å†…å®¹ï¼Œé‚£ä¹ˆ **docker** ä¼šå°† **container** ä¸­çš„å†…å®¹æ‹·è´åˆ° **volume** ä¸­\n   - å¦‚æœ **volume** ä¸­å·²ç»æœ‰å†…å®¹ï¼Œåˆ™ä¼šå°† **container** ä¸­çš„ç›®å½•è¦†ç›–æ‰ã€‚\n\n# å‘½ä»¤è¡Œå°æŠ€å·§\n\n## 1ã€æ‰¹é‡æ“ä½œ\n\n1. æˆ‘ä»¬å¯ä»¥é€šè¿‡ `docker container ls -aq` è·å–åˆ°æ‰€æœ‰ **container** çš„id\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](14.png)\n\n2. æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°çš„æ–¹å¼å°†è¿™äº› **id**ï¼Œè¿›è¡Œä¸€ä¸ªä¼ é€’\n\n   - æ‰¹é‡å¯åŠ¨\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](16.png)\n\n   - æ‰¹é‡åœæ­¢\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](17.png)\n\n   - æ‰¹é‡åˆ é™¤\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](18.png)\n\n## 2ã€ç³»ç»Ÿæ¸…ç†\n\n1. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `docker container prune -f`ï¼Œæ¥æ¸…ç†æ‰å·²ç»åœæ­¢çš„å®¹å™¨\n2. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `docker image prune -a`ï¼Œæ¥æ¸…ç†æ‰æ²¡æœ‰ä½¿ç”¨çš„é•œåƒy\n","tags":["Docker"],"categories":["æŠ€æœ¯å­¦ä¹ ","Docker"]},{"title":"Rediså­¦ä¹ ","url":"/2021/08/06/Rediså­¦ä¹ /","content":"\n# ä¸€ã€ç¯å¢ƒå‡†å¤‡\n\n- linuxç³»ç»Ÿï¼Œæœ¬äººä½¿ç”¨çš„æ˜¯centos8ï¼Œæœ€å°åŒ–å®‰è£…\n- [Redisä¸‹è½½](https://download.redis.io/releases/redis-6.2.5.tar.gz?_ga=2.264706890.49166100.1628230335-321395705.1628230335)\n\n<!-- more -->\n\n# äºŒã€å®‰è£…\n\n1. é¦–å…ˆé€šè¿‡ **tar -zxvg xxxxx** å°† **Redis** è§£å‹ï¼Œç›®å½•éšæ„ï¼Œæœ¬äººæ˜¯åœ¨ **/usr/local/** ä¸‹åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å®‰è£…ä½¿ç”¨\n\n2. è§£å‹è¿‡åæ‰§è¡Œ **make** å‘½ä»¤ç¼–è¯‘ï¼Œæ‰§è¡Œçš„æ—¶å€™ä¼šæ£€æµ‹ä½ çš„ç³»ç»Ÿæ˜¯å¦ç¼ºå°‘ä¾èµ–ä¹‹ç±»çš„ï¼Œå¦‚æœæ²¡é—®é¢˜ä¼šè¿›è¡Œç¼–è¯‘\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](1.png)\n\n3. ç¼–è¯‘æˆåŠŸåï¼Œæ‰§è¡Œ **make test** å‘½ä»¤æ£€æµ‹ä¸€ä¸‹æ˜¯å¦æœ‰ä»€ä¹ˆé”™è¯¯\n\n   - å°ç¼–è¿™é‡Œå°±å‡ºç°äº†é”™è¯¯\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](2.png)\n\n     è¿™ä¸ªé”™è¯¯çš„æ„æ€æ˜¯ï¼šå¦‚æœæƒ³è¦æ‰§è¡Œ **make test** å‘½ä»¤éœ€è¦ä¸€ä¸ª **tcl 8.5** çš„åº“ï¼Œå¦‚æœæƒ³è¦ **test** å°±è¦å®‰è£…è¿™ä¸ªåº“\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](3.png)\n\n4. æ‰§è¡Œ **make PREFIX /usr/local/redis install** å®‰è£…ï¼Œ **PREFIX /usr/local/redis ** ä¸ºæŒ‡å®šå®‰è£…ç›®å½•\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](4.png)\n\n   å®‰è£…å¥½ä¹‹ååˆ™ä¼šåœ¨ **/usr/local/redis** ä¸‹ç”Ÿæˆ **bin** æ–‡ä»¶å¤¹ï¼Œå†…å«æ–‡ä»¶å¦‚ä¸‹\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](5.png)\n\n   ä»–ä»¬åˆ†åˆ«æ˜¯ï¼š\n\n   ```shell\n   redis-benchmark   #redis æ€§èƒ½æµ‹è¯•å·¥å…·\n   redis-check-aof   #æ£€æŸ¥aofæ—¥å¿—çš„å·¥å…·\n   redis-check-rdb   #æ£€æŸ¥rdbæ—¥å¿—çš„å·¥å…·\n   redis-cli         #redis è¿æ¥çš„å®¢æˆ·ç«¯\n   redis-sentinel    #å“¨å…µæ¨¡å¼\n   redis-server\t  #redis æœåŠ¡è¿›ç¨‹\n   ```\n\n\n# ä¸‰ã€é…ç½®\n\n1. ä»æºä»£ç ç›®å½•å¤åˆ¶ **redis.conf** æ–‡ä»¶åˆ° **bin** åŒçº§\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](6.png)\n\n2. æ³¨é‡Šæ‰ **bind** é…ç½®ï¼Œå¦‚æœä¸æ³¨é‡Šçš„è¯ï¼Œé»˜è®¤åªæœ‰ **127.0.0.1** ä¹Ÿå°±æ˜¯æœ¬æœºå¯ä»¥è¿æ¥\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](13.png)\n\n3. ä¿æŠ¤æ¨¡å¼è®¾ç½®ï¼Œå…³é—­ä¿æŠ¤æ¨¡å¼ï¼Œå¦‚æœå¼€å¯çš„è¯ï¼Œredisåªèƒ½æœ¬æœºè®¿é—®\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](14.png)\n\n4. **backlog** è¿æ¥é˜Ÿåˆ—\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](15.png)\n\n5. é…ç½® **redis** åå°å¯åŠ¨\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](16.png)\n\n6. æ—¥å¿—æ–‡ä»¶é…ç½®ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå³åœ¨é‚£ä¸ªç›®å½•å¯åŠ¨ï¼Œæ—¥å¿—æ–‡ä»¶å°±åœ¨é‚£ä¸ªç›®å½•ä¸‹ç”Ÿæˆ\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](17.png)\n\n7. æ•°æ®åº“ä¸ªæ•°\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](18.png)\n\n# å››ã€å¯åŠ¨ä¸è¿æ¥\n\n1. æ˜¾ç¤ºå¯åŠ¨ **redis-server** æœåŠ¡\n\n   ```shell\n   # å¯åŠ¨ bin ç›®å½•ä¸‹çš„ redis-serverï¼Œå¹¶æŒ‡å®šä½¿ç”¨æˆ‘ä»¬åˆšæ‰æ‹·è´è¿‡æ¥çš„ redis.conf é…ç½®æ–‡ä»¶\n   ./bin/redis-server ./redis.conf\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](7.png)\n\n2. éšå¼å¯åŠ¨ **redis-server** æœåŠ¡\n\n   ä¿®æ”¹ **redis.conf** é…ç½®æ–‡ä»¶\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](9.png)\n\n3. è¿æ¥ **redis-cli** å®¢æˆ·ç«¯ï¼Œå¹¶æµ‹è¯•\n\n   ```shell\n   # å¯åŠ¨å®¢æˆ·ç«¯\n   ./bin.redis-cli\n   \n   # æ–°å¢key-velue, å­˜å‚¨å­—ç¬¦ä¸² åŒå¼•å· å¯æœ‰å¯æ— \n   set word \"hello world\"\n   \n   # æ ¹æ®keyæŸ¥è¯¢\n   get word\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](8.png)\n\n4. å…³é—­\n\n   - æ˜¾ç¤ºå¯åŠ¨çš„ **redis-server** ç›´æ¥æŒ‰ **ctrl + c** å³å¯\n\n   - éšå¼å¯åŠ¨çš„ **redis-server** éœ€è¦æŸ¥è¯¢åˆ°è¿›ç¨‹åï¼Œæ ¹æ®è¿›ç¨‹IDæ€æ­»è¿›ç¨‹å³å¯\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](10.png)\n\n   - å…³é—­ **redis-cli** è¾“å…¥ **exit** å³å¯\n\n# äº”ã€æ“ä½œå‘½ä»¤\n\nåœ¨æ“ä½œä¹‹å‰æˆ‘ä»¬å…ˆè¦çŸ¥é“ï¼š\n\n1. **redis** ä¸­éƒ½æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼š**stringã€listã€setã€zset(order set)ã€hash**\n2. **redis** ä¸­å…±æœ‰16ä¸ªæ•°æ®åº“ï¼ˆç©ºé—´ï¼‰ï¼Œä½¿ç”¨**select 0** åˆ‡æ¢ï¼Œé»˜è®¤ä½¿ç”¨ 0å·åº“\n\n## 1ã€åŸºç¡€æ“ä½œ\n\n### 1ï¼‰æ–°å¢\n\n1. å­—ç¬¦ä¸²ï¼ˆstringï¼‰\n\n   ```shell\n   # set key value\n   set site www.baidu.com\n   ```\n   \n2. è¿½åŠ \n\n   ```shell\n   # å‘æŒ‡å®šçš„ key è¿½åŠ å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶è¿”å›valueé•¿åº¦ï¼Œå¦‚æœå­˜åœ¨åˆ™å‘valueåè¿½åŠ ï¼Œå¹¶è¿”å›è¿½åŠ åçš„valueé•¿åº¦\n   append key value\n   ```\n\n   \n\n### 2ï¼‰åˆ é™¤\n\n1. å­—ç¬¦ä¸²ï¼ˆstringï¼‰\n\n   ```shell\n   # å•ä¸ª del key\n   del site\n   \n   #æ‰¹é‡åˆ é™¤\n   del sit age\n   ```\n\n### 3ï¼‰ä¿®æ”¹\n\n1. å­—ç¬¦ä¸²ï¼ˆstringï¼‰\n\n   ```shell\n   # ä¿®æ”¹å€¼ set key value\n   set site www.baidu.com\n   \n   #ä¿®æ”¹ key åç§°ï¼Œå¦‚æœä¿®æ”¹åçš„key name å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–ä¿®æ”¹åçš„key name çš„å€¼\n   rename age agee\n   \n   #ä¿®æ”¹ key åç§°ï¼Œæ£€æŸ¥ä¿®æ”¹åçš„key nameæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›1ï¼Œè¡¨ç¤ºæˆåŠŸï¼Œå¦åˆ™è¿”å›0ï¼Œä¿®æ”¹ä¸æˆåŠŸ\n   # nx: not exists æ˜¯å¦å­˜åœ¨\n   renamenx age site \n   ```\n\n### 4ï¼‰æŸ¥è¯¢\n\n1. å­—ç¬¦ä¸²ï¼ˆstringï¼‰\n\n   ```shell\n   # get key\n   get site\n   \n   # æŸ¥è¯¢å¹¶ä¿®æ”¹\n   getset site test\n   ```\n\n### 5ï¼‰å„ç§æŸ¥è¯¢\n\n1. **\\*** çš„ä½¿ç”¨\n\n   ```shell\n   # æŸ¥è¯¢æ‰€æœ‰key\n   keys *\n   \n   # æ¨¡ç³ŠåŒ¹é…\n   keys si*\n   ```\n\n2. **[]** çš„ä½¿ç”¨\n\n   ```shell\n   # æ¯”è¾ƒç²¾ç¡®çš„åŒ¹é…ï¼ŒåŒ¹é…ä¸­æ‹¬å·ä¸­çš„å­—ç¬¦\n   keys sit[ey]\n   ```\n\n3. **ï¼Ÿ**çš„ä½¿ç”¨\n\n   ```shell\n   # ? åŒ¹é…å•ä¸ªå­—ç¬¦\n   keys si?e\n   ```\n\n4. éšæœºè¿”å›ä¸€ä¸ªkey\n\n   ```shell\n   randomkey\n   ```\n\n5. æŸ¥çœ‹ **key** çš„ç±»å‹ï¼š\n\n   ```shell\n   # type key\n   type site\n   ```\n\n6. æŸ¥çœ‹æŸä¸ª **key** æ˜¯å¦å­˜åœ¨ï¼š\n\n   ```shell\n   # å­˜åœ¨è¿”å› 1ï¼Œä¸å­˜åœ¨è¿”å› 0\n   exists site\n   ```\n\n7. è·å– **value** çš„é•¿åº¦\n\n   ```shell\n   strlen key\n   ```\n\n### 6ï¼‰key ç§»åŠ¨\n\n```shell\n# å°† key ç§»åŠ¨è‡³1å·åº“\nmove site 1\n```\n\n### 7 ï¼‰key é€’å¢/å‡\n\n```shell\n# è®¾ç½®æ•´å‹ keyï¼Œæ¯æ¬¡é€’å¢ 1\nincr key\n\n# è®¾ç½®æ•´å‹ keyï¼Œæ¯æ¬¡é€’å‡ 1\ndecr key\n\n# è®¾ç½®æ•´å‹ keyï¼Œé€’å¢10ï¼Œå³æ­¥é•¿\nincrby key 10\n\n# æµ®ç‚¹æ•°ç±»å‹ é€’å¢ï¼Œæ²¡æœ‰ç›¸åº”çš„é€’å‡\nincrbyfloat key 1.1\n\n#è®¾ç½®æ•´å‹ keyï¼Œé€’å‡10ï¼Œå³æ­¥é•¿\ndecrby key 10\n```\n\n\n\n### 8ï¼‰key çš„ç”Ÿå‘½å‘¨æœŸ\n\n```shell\n# æŸ¥è¯¢keyçš„æœ‰æ•ˆæœŸ\n# å·²è¿‡æœŸ/ä¸è¿‡æœŸçš„key è¿”å›-1ï¼ŒRedis2.8åä¸å­˜åœ¨çš„key è¿”å›-2\n# è¿”å› ç§’\nttl site\n# è¿”å› æ¯«ç§’\npttl site\n\n# è®¾ç½®keyçš„ç”Ÿå‘½å‘¨æœŸ\n# ç§’\nexpire site 10\n# æ¯«ç§’\npexpire site 10000\n\n# è®¾ç½®keyæ°¸ä¹…æœ‰æ•ˆ\npersist key\n```\n\n### 9ï¼‰åˆ‡æ¢æ•°æ®åº“ï¼Œé»˜è®¤æœ‰16ä¸ª\n\n```shell\nselect 0\n```\n\n### 10ï¼‰æ¸…ç©ºæ•°æ®åº“\n\n```shell\nflushdb\n```\n\n## 2ã€å„ç§æ•°æ®ç±»å‹çš„æ“ä½œ\n\n### 2-1ã€stringï¼ˆå­—ç¬¦ä¸²ï¼‰ç±»å‹\n\n#### 1ï¼‰æ–°å¢\n\n```shell\n# ex:è®¾ç½®ç”Ÿå‘½å‘¨æœŸç§’æ•°\n# px:è®¾ç½®ç”Ÿå‘½å‘¨æœŸæ¯«ç§’æ•°\n# ç”Ÿå‘½å‘¨æœŸè®¾ç½®ex/pxåŒæ—¶å†™çš„æ—¶å€™ä»¥åé¢çš„æœ‰æ•ˆæœŸä¸ºå‡†\n# nx:è¡¨ç¤º key ä¸å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œæ“ä½œ\n# xx:è¡¨ç¤º key å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œæ“ä½œ\nset key value [ex ç§’æ•°][px æ¯«ç§’æ•°] [nx]/[xx]\n\n# 20 ç§’è¿‡æœŸï¼Œvalueä¸º10\nset age 20 10\n\n# ä¸€æ¬¡æ€§æ–°å¢å¤šä¸ªé”®å€¼\nmset key value key value\n```\n\n#### 2ï¼‰æŸ¥è¯¢\n\n```\nget key\n\n# è·å–å¤šä¸ªkey\nmget key1 key2 key3\n```\n\n#### 3ï¼‰åˆ é™¤\n\n````shell\n# å•ä¸ª del key\ndel site\n\n#æ‰¹é‡åˆ é™¤\ndel sit age\n````\n\n#### 4ï¼‰åç§»é‡\n\n```shell\n# åç§» ä»ä¸‹æ ‡ä½ç½®å‘åæ›¿æ¢\nsetrange key index value\n\n# start,stopå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œåˆ™æ˜¯ä»valueæœ«å°¾å¼€å§‹ï¼Œ\ngetrange key start stop\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](12.png)\n\n### 2-2ã€listï¼ˆåˆ—è¡¨ï¼‰ç±»å‹\n\n#### 1ï¼‰æ–°å¢\n\n```shell\n# ä»å·¦ä¾§æ¨å…¥\nlpush list a b c d\n\n# ä»å³ä¾§æ¨å…¥\nrpush list a b c d\n\n# æ’å…¥å€¼ï¼Œåœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°æŸä¸ªå€¼ï¼Œå¹¶åœ¨å…¶å‰æˆ–åæ’å…¥å€¼ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™ä¼šè¿”å› -1\n# å¦‚æœæ‰¾åˆ°äº†å¤šä¸ªå€¼ï¼Œåˆ™ä¼šåœ¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å€¼å‰åæ’å…¥å€¼ã€‚\nlinsert key after|before search value\neg:\n# åœ¨keyä¸ºnumçš„åˆ—è¡¨ä¸­æ‰¾åˆ°3ï¼Œå¹¶åœ¨3çš„å‰é¢æ’å…¥2\nlinsert num before 3 2\n```\n\n#### 2ï¼‰æŸ¥è¯¢\n\n````shell\n# èŒƒå›´å–å€¼\nlrange list 0 1\nlrange list 0 -1\n\n# æ ¹æ®ä¸‹æ ‡è·å–å…ƒç´ \nlindex list index\n\n# è·å–åˆ—è¡¨é•¿åº¦\nllen key\n````\n\n#### 3ï¼‰ åˆ é™¤ï¼ˆå¼¹å‡ºï¼‰\n\n```shell\n# åˆ é™¤æ•´ä¸ªkey\ndel key\n\n# å¼¹å‡ºå…ƒç´ \nlpop list\nrpop list\n\n# åˆ é™¤å…ƒç´ \n# count åˆ é™¤å‡ ä¸ªï¼Œæ­£æ•°ä»£è¡¨ä»å·¦å‘å³åˆ é™¤ï¼Œè´Ÿæ•°ä»£è¡¨ä»å³å‘å·¦åˆ é™¤\n# value æ ¹æ®å€¼åˆ é™¤\nlrem key count value\neg: \nlrem list 1 value\nlrem list -1 value \n\n\n# ç­‰å¾…å¼¹å‡º\n# å¦‚æœkeyä¸­æ²¡æœ‰å…ƒç´ ï¼Œåˆ™ç­‰å¾…æœ‰å€¼äº†ä¹‹åå¼¹å‡º\n# timeout ä¸º0 åˆ™ä¸€ç›´ç­‰å¾…\n# é€‚ç”¨åœºæ™¯ï¼šé•¿è½®è¯¢ï¼Œåœ¨çº¿èŠå¤©\nbrpop/blpop key timeout\n```\n\n#### 4ï¼‰å‰ªåˆ‡\n\n```shell\n# å‰ªåˆ‡åkeyçš„å€¼å°±å˜ä¸ºå‰ªåˆ‡çš„å€¼\nltrim key start stop\n```\n\n\n\n#### 5ï¼‰å¼¹å‡ºå¹¶æ’å…¥\n\n```shell\n# åœ¨ç¬¬ä¸€ä¸ªåˆ—è¡¨çš„å³ä¾§å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶æ’å…¥åˆ°ç¬¬äºŒä¸ªåˆ—è¡¨çš„å·¦ä¾§ï¼ŒæˆåŠŸä¼šè¿”å›å¼¹å‡ºæ’å…¥çš„å€¼\n# åŸå­æ€§æ“ä½œ\n\n# é€‚ç”¨åœºæ™¯:\n# ä¸¤ä¸ªåˆ—è¡¨: task[a,b,c,d] bak[]\n# æ‰§è¡Œä»»åŠ¡æ—¶å¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤:task[a,b,c] bak[d],æ‰§è¡Œå‘½ä»¤åä¼šè¿”å›å¼¹å‡ºå¹¶æ’å…¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯d\n# è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±çŸ¥é“è¯¥æ‰§è¡Œä»»åŠ¡ï¼šd\n# å¦‚æœæ‰§è¡ŒæˆåŠŸåˆ™åœ¨bakä¸­ï¼Œpopæ‰d\n# å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œæˆ–è€…æ²¡æœ‰æ‰§è¡Œï¼Œé‚£ä¹ˆbakä¸­çš„dè¿˜åœ¨ã€‚ä¸‹æ¬¡å†æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™å»bakä¸­æ‹¿å°±å¥½äº†ã€‚\nrpoplpush key1 key2\n```\n\n### 2-3ã€setï¼ˆé›†åˆï¼‰ç±»å‹ï¼Œæ— åº\n\n#### 1ï¼‰æ–°å¢\n\n```shell\nsadd key value1 value2 ...\n```\n\n#### 2ï¼‰æŸ¥è¯¢\n\n```shell\n# éšæœºæŸ¥è¯¢å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæˆ–æŒ‡å®šcountä¸ªå…ƒç´ \nsrandmember key count\n\n# æŸ¥è¯¢é›†åˆæ‰€æœ‰å…ƒç´ \nsmembers key\n\n# åˆ¤æ–­valueæ˜¯å¦åŒ…å«åœ¨é›†åˆä¸­ï¼Œæ˜¯è¿”å›1ï¼Œå¦åˆ™è¿”å›0\nsismember key value \n\n# æŸ¥è¯¢é›†åˆå…±æœ‰å¤šå°‘ä¸ªå…ƒç´ \nscard key\n```\n\n#### 3ï¼‰åˆ é™¤ï¼ˆå¼¹å‡ºï¼‰\n\n```shell\n# åˆ é™¤å…ƒç´ (æ ¹æ®å€¼åˆ é™¤)\nsrem key value1 value2\n\n# å¼¹å‡º\n# éšæœºåˆ é™¤ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›popå‡ºçš„å€¼ï¼Œcountå¯ä»¥æŒ‡å®šéšæœºåˆ é™¤å¤šå°‘ä¸ª\nspop key count\n```\n\n#### 4ï¼‰æ›´å¤š\n\n```shell\n# åˆ é™¤æŒ‡å®šé›†åˆé‡å…ƒç´ ï¼Œå¹¶å°†åˆ é™¤çš„å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªé›†åˆ\nsmove sourcr target value\n\n# äº¤é›†\nsinter key1 key2 key3\n# æŸ¥è¯¢å‡ºäº¤é›†å¹¶å­˜å‚¨åœ¨ä¸€ä¸ªkey(targer)ä¸­\nsinterstore target key1 key2 key3\n\n# å¹¶é›†\nsunion key1 key2 key3\n\n\n# å·®é›†,key1 ä¸ key2 key3 çš„å·®é›†,è¿”å›key1ä¸­å­˜åœ¨ï¼Œå…¶ä»–keyä¸­ä¸å­˜åœ¨çš„\nsdiff key1 key2 key3\n```\n\n### 2-4ã€Hashï¼ˆå“ˆå¸Œï¼‰ç±»å‹\n\n#### 1ï¼‰æ–°å¢\n\n```shell\n# å•ä¸ªï¼Œå¦‚æœfieldå·²ç»å­˜åœ¨åˆ™ä¼šè¦†ç›–åŸæœ‰çš„value\nhset key field value\negï¼š\nhset user id 1\nhset user name zhangsan\n\n# å¦‚æœkeyä¸­fieldä¸å­˜åœ¨ï¼Œæ·»åŠ æˆåŠŸï¼Œå¦åˆ™æ·»åŠ å¤±è´¥\nhsetnx key field value\n\n# æ‰¹é‡ä¸ºkeyè®¾ç½®hashå€¼\nhmset key field1 value1 field2 value2\n```\n\n#### 2ï¼‰æŸ¥è¯¢\n\n```shell\n# æ ¹æ®keyçš„å±æ€§æŸ¥è¯¢value\nhget key field\n\n# æŸ¥è¯¢keyä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªfield\nhexists key field\n\n# æŸ¥è¯¢keyä¸­æ‰€æœ‰çš„field\nhkeys key\n\n# æŸ¥è¯¢keyä¸­æ‰€æœ‰value\nhvals key\n```\n\n#### 3ï¼‰åˆ é™¤\n\n```shell\ndel key\n```\n\n#### 4ï¼‰æ›´å¤š\n\n```shell\n# ä¸ºkeyä¸­fieldå¯¹åº”çš„valueå¢åŠ é‡æ“ä½œï¼Œé’ˆå¯¹æ•°å­—çš„value\nhincrby key field increment\negï¼š\nhset user id 1\nhincrby user id 12\nresultï¼š13\n```\n\n\n\n### 2-5ã€zset(order set) æœ‰åºé›†åˆ\n\n#### 1ï¼‰æ–°å¢\n\n``` shell\n# æ ¹æ®orderæ’åº\nzadd key order1 value1 order2 value2\n```\n\n#### 2ï¼‰æŸ¥è¯¢\n\n```shell\n# æŠŠé›†åˆæ’åºåï¼Œè¿”å›èŒƒå›´å†…æ•°æ®[startï¼Œstop]\n# æ³¨æ„è¿™é‡Œæ˜¯å…ˆè¿›è¡Œâ€œæ’åºâ€ï¼Œåœ¨æ‹¿ start - stop(ä¸‹æ ‡/æ’å)çš„å€¼\n# é»˜è®¤å‡åº\nzrange key start stop \n# é™åº\nzrevrange key start stop\n\n# è¿™é‡Œä¹Ÿæ˜¯å’Œé›†åˆå‡åºæ’åºåå–å€¼ï¼Œè¿™é‡Œçš„min,maxæŒ‡çš„æ˜¯å®é™…æ’åºçš„å€¼\n# limit åˆ†é¡µ\n# offset åç§»é‡ï¼Œä»é‚£ä¸ªå¼€å§‹ç®—\n# N æŸ¥å¤šå°‘ä¸ª\n# withscores å®é™…åˆ†æ•°\nzrangebyscorce key min max withscores limit offset N\neg:\nzadd test 1 a 3 c 2 b 4 d 6 f 9 i 8 h\nzrangebyscore test 4 8 \n# resultï¼šd f h\nzrangebyscore test 4 8 withscores\n# resultï¼šd 4 f 6 h 8\nzrange test 4 8\n# resultï¼šf h i\nzrangebyscore test 1 8 limit 1 2\n# resultï¼šb c\n\n\n# å…ˆå¯¹é›†åˆç”Ÿåºæ’åºï¼Œå†æŸ¥è¯¢value åœ¨keyä¸­æ‹ç¬¬å‡ ä¸ªï¼Œä»0å¼€å§‹ã€‚\nzrank key value\n# é™åº\nzrevrank key value\n```\n\n#### 3ï¼‰åˆ é™¤\n\n```shell\n# æ ¹æ®å…ƒç´ åˆ é™¤\nzrem key value\n\n# æŒ‰æ’ååˆ é™¤ï¼ˆä¸‹æ ‡ï¼‰\nzremrangebyrank test 0 1\neg:\nzadd test 1 a 3 c 2 b 4 d 6 f 9 i 8 h\n# åˆ é™¤çš„å°±æ˜¯ï¼š a b\n\n# æŒ‰åˆ†æ•°ï¼ˆæ’åºå®é™…çš„å€¼ï¼‰åˆ é™¤\nzremrangebyscore test 2 8 \neg:\nzadd test 1 a 3 c 2 b 4 d 6 f 9 i 8 h\n# åˆ é™¤çš„å°±æ˜¯: b c d f h\n```\n\n#### 4ï¼‰ æ›´å¤š\n\n```shell\n# ç»Ÿè®¡é›†åˆå†…ä¸€å…±æœ‰å¤šå°‘ä¸ª\nzcard key\n\n# ç»Ÿè®¡é›†åˆå†…æŒ‡å®šèŒƒå›´å†…çš„\nzcount ket start stop\n```\n\n# å…­ã€å‘å¸ƒå’Œè®¢é˜…\n\n## 1ã€ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…\n\n1. **Redis** å‘å¸ƒè®¢é˜…ï¼ˆ**pub/sub**ï¼‰æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…ï¼ˆ**pub**ï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆ**sub**ï¼‰è®¢é˜…æ¶ˆæ¯\n2. **Redis** å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](19.png)\n\n## 2ã€å‘å¸ƒå’Œè®¢é˜…å‘½ä»¤è¡Œç¤ºä¾‹\n\n```shell\n# åˆ†åˆ«æ‰“å¼€ä¸‰ä¸ªå››ä¸ªçª—ä½“\n# å‰ä¸‰ä¸ªçª—å£ç”¨äºè®¢é˜…æ¶ˆæ¯ï¼Œæœ€åä¸€ä¸ªç”¨äºå‘å¸ƒæ¶ˆæ¯\n# å‰ä¸‰ä¸ªçª—å£åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤\nsubscribe a1\nsubscribe a2\nsubscribe a1 a2\n\n# æœ€åä¸€ä¸ªçª—å£æ‰§è¡Œä»¥ä¸‹å‘½ä»¤\npublish a1 hello\npublish a2 world\n\n# æœ€åæŸ¥çœ‹å‰ä¸‰ä¸ªçª—ä½“åˆ†åˆ«æ¥æ”¶åˆ°äº†é‚£ä¸ªæ¶ˆæ¯\n```\n\nè®¢é˜…æ¶ˆæ¯ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](20.png)\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](21.png)\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](22.png)\n\nå‘å¸ƒæ¶ˆæ¯ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](23.png)\n\n# ä¸ƒã€æ–°æ•°æ®ç±»å‹\n\n## 1ã€Bitmapsï¼ˆä½æ“ä½œï¼‰\n\n```shell\n# è®¾ç½® key åç§»é‡çš„ä½ç½® æ˜¯1/0\nsetbit key offset value\n\n# è·å– key åç§»é‡çš„ä½ç½®çš„ å€¼\ngetbit key offset\n\n------------------------------------------------------------------\n\n# è·å– key å¼€å§‹-ç»“æŸ æœ‰å¤šå°‘ä¸ª1\n# è¿™é‡Œçš„ startï¼ŒtopæŒ‡çš„æ˜¯å­—èŠ‚ç»„\n# å³ 01000000 8ä¸ªbit ä¸ºä¸€ä¸ªå­—èŠ‚ç»„\n# \nbitcount key start top\negï¼š\nsetbit a 1000 0\nsetbit a 0 1\nsetbit a 2 1\n# aä¸­çš„äºŒè¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯ ä½ æ˜¯ï¼š 10100000\n# æŸ¥è¯¢æ‰€æœ‰ï¼Œå³è¿”å›aä¸­bitä¸º1çš„ä¸ªæ•°\nbitcount a \n\nsetbit a 8 1\n# aä¸­çš„äºŒè¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯ ä½ æ˜¯ï¼š10100000 10000000\n\n# è¿™é‡Œ startï¼š0 æŒ‡çš„å°±æ˜¯ï¼š10100000\n# è¿™é‡Œ endï¼š1 æŒ‡çš„å°±æ˜¯ï¼š 10000000\n# è¿™ä¸ªè¿”å› 2\nbitcount a 0 0 \n# è¿™ä¸ªè¿”å› 3\nbitcount a 0 1\n\n\n------------------------------------------------------------------\n\n# å¤šä¸ªkey æŒ‰ä½æ“ä½œ \n# operation å¯ä»¥æ˜¯: AND OR NOT XOR\nbitop operation destkey key1 [key2...]\neg:\nsetbit lower 2 1\nset char Q\n# char å’Œ lower åšoræ‰æ“ä½œï¼Œæ¯”è¾ƒå charçš„ç¬¬äºŒä½å˜æˆäº†1 ï¼Œç»“æœæ”¾åœ¨cahrä¸Š\n# ç¬¬ä¸€ä¸ª char è¡¨ç¤ºæ”¾åœ¨é‚£ä¸ªkeyä¸Š\nbitop and lower char char lower\n```\n\n## 2ã€HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰\n\nä»€ä¹ˆæ˜¯åŸºæ•°ï¼šå‡å¦‚ç°åœ¨æœ‰è¿™ä¹ˆä¸€ç»„æ•°æ®{1,3,5,7,5,7,8}ï¼Œ é‚£ä¹ˆä»–çš„åŸºæ•°å°±æ˜¯{1,3,5,7,8}\n\n### 1ï¼‰æ–°å¢\n\n```shell\npfadd key elements\neg:\npfadd program java php java\nresult: java php\n```\n\n### 2ï¼‰æŸ¥è¯¢\n\n```shell\n# ç»Ÿè®¡åŸºæ•°ä¸ªæ•°\npfcount program \nresult: 2\n```\n\n### 3ï¼‰æ›´å¤š\n\n```shell\n# åˆå¹¶ï¼Œå°†å¤šä¸ª key çš„å…ƒç´ åˆå¹¶åˆ°ä¸€ä¸ªç›®æ ‡ key ä¸­\npfmerge target keys\neg:\npfadd k1 a b\npfmerge k2 program k1\nresult: 4\n```\n\n## 3ã€Geospatialï¼ˆåœ°ç†ä¿¡æ¯çš„ç¼©å†™ï¼‰\n\næ³¨ï¼šè¯¥ç±»å‹å°±æ˜¯å…ƒç´ çš„ 2 ç»´åæ ‡ã€‚åœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚**redis** åŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦ **Hash** ç­‰æ“ä½œ.\n\n### 1ï¼‰æ–°å¢\n\n```shell\n#  ç»åº¦ çº¬åº¦ åç§°\ngeoadd key longitude latitude member\neg:\ngeoadd china:city 121.47 31.23 shanghai 106.50 29.53 chongqing\n\n# ä¸¤ææ— æ³•ç›´æ¥æ·»åŠ ï¼Œä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚æ•°æ®ï¼Œé€šè¿‡ java ç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ã€‚\n# æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ã€‚æœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ã€‚\n```\n\n### 2ï¼‰æŸ¥è¯¢\n\n```shell\n# è·å¾—æŒ‡å®šåœ°åŒºçš„åæ ‡å€¼\ngeopos key member\neg:\ngeopos china:city shanghai\nresult:\n1) 121.47000163793563843  # ç»åº¦\n2) 31.22999903975783553   # çº¬åº¦\n\n\n# è·å–ä¸¤ä½ä½ç½®çš„ç›´çº¿è·ç¦»\n# m ç±³ é»˜è®¤å€¼\n# km åƒç±³\n# mi è‹±é‡Œ\n# ft è‹±å°º\ngeodist key member1 member2 [m|km|ft|mi]\neg:\ngeodist china:city shanghai chongqing\n\n# æŸ¥è¯¢ç»™å®šç»çº¬åº¦ä¸ºä¸­å¿ƒï¼ŒåŠå¾„å†…çš„å…ƒç´ \ngeoradius key  longitude latitude radius [m|km|ft|mi]\neg:\n# æŸ¥è¯¢ key ä¸­ ç»çº¬åº¦ä¸ºä¸­å¿ƒ 1000 å…¬é‡Œå†…çš„å…ƒç´ \ngeoradius china:city 110 30 1000 km\n```\n\n# å…«ã€Jedis æ“ä½œ\n\n## 1ã€Jedis è¿æ¥æµ‹è¯•\n\n1. åˆ›å»ºä¸€ä¸ª **Maven** å·¥ç¨‹\n\n2. **pom** æ–‡ä»¶ä¸­å¢åŠ ä¾èµ–\n\n   ```xml\n   <dependency>\n       <groupId>redis.clients</groupId>\n       <artifactId>jedis</artifactId>\n       <version>3.6.3</version>\n   </dependency>\n   ```\n\n3. åˆ›å»ºä¸€ä¸ªç±»å¹¶æµ‹è¯•\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](24.png)\n\n4. å¯åŠ¨ **main** æ–¹æ³•\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](28.png)\n\n<font color=\"red\">**æ³¨æ„ï¼š**</font>è¿™é‡Œå¯èƒ½ä¼šå‘ç”ŸæŠ¥é”™ï¼Œå¯èƒ½æ˜¯ç”±äºè™šæ‹Ÿæœºé˜²ç«å¢™ä¸ºå…³é—­å¯¼è‡´çš„\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](25.png)\n\nå…³é—­é˜²ç«å¢™ï¼š\n\n1. æ‰§è¡Œ **systemctl status firewalld** æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](26.png)\n\n2. æ‰§è¡Œ**systemctl stop firewalld** å…³é—­é˜²ç«å¢™ï¼Œåœ¨æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](27.png)\n\n3. ç¦ç”¨é˜²ç«å¢™ï¼š**systemctl disable firewalld**\n\n## 2ã€æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹\n\n<font color=\"red\">**æ³¨ï¼š**</font>å› ä¸ºå’Œå‘½ä»¤è¡Œæ“ä½œç›¸åŒï¼Œæ‰€ä»¥å°±ä¸æ‰€æœ‰å‘½ä»¤éƒ½è¿›è¡Œæµ‹è¯•äº†\n\n### 1ï¼‰String ç±»å‹\n\n```java\n    /**\n     * å­—ç¬¦ä¸²ç±»å‹æµ‹è¯•\n     */\n    @Test\n    public void test1() {\n        Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n        // å•ä¸ª key-value è®¾ç½®\n        jedis.set(\"name\", \"zhangsan\");\n        String name = jedis.get(\"name\");\n        System.out.println(name);\n\n        // å¤šä¸ª key-value è®¾ç½®\n        jedis.mset(\"age\", \"12\", \"sex\", \"man\");\n        List<String> keys = jedis.mget(\"name\", \"age\", \"sex\");\n        System.out.println(keys);\n\n        // è·å–æ‰€æœ‰ key\n        Set<String> set = jedis.keys(\"*\");\n        for (String str : set) {\n            System.out.println(\"keyï¼š\" + str);\n            String value = jedis.get(str);\n            System.out.println(\"valueï¼š\" + value);\n        }\n\n        // åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨\n        System.out.println(jedis.exists(\"name\"));\n        // è®¾ç½® key è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œ expire æ–¹æ³•è¿‡æœŸäº†ï¼Œå¯ä»¥ä½¿ç”¨ JedisCommands å®ç°\n        jedis.expire(\"test_key\", 30);\n        // æŸ¥çœ‹ key çš„è¿‡æœŸæ—¶é—´\n        System.out.println(jedis.ttl(\"test_key\"));\n        \n        jedis.close();\n    }\n```\n\n### 2ï¼‰List ç±»å‹\n\n```java\n    /**\n     * List ç±»å‹æµ‹è¯•\n     */\n    @Test\n    public void test_list() {\n        Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n        jedis.flushDB();\n        jedis.lpush(\"list\", \"a\", \"b\");\n        jedis.rpush(\"list\", \"c\");\n\n        String val1 = jedis.lindex(\"list\", 1);\n        System.out.println(val1);\n\n        List<String> list = jedis.lrange(\"list\", 0, -1);\n        for (String str : list) {\n            System.out.println(str);\n        }\n\n        jedis.close();\n    }\n```\n\n### 3ï¼‰Set ç±»å‹\n\n```java\n    /**\n     * set ç±»å‹æµ‹è¯•\n     */\n    @Test\n    public void test_set() {\n        Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n        jedis.flushDB();\n        jedis.sadd(\"set\", \"set1\", \"set2\", \"set3\");\n\n        // éšæœºæŸ¥è¯¢å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæˆ–æŒ‡å®šcountä¸ªå…ƒç´ \n        List<String> values = jedis.srandmember(\"set\", 2);\n        for (String str : values) {\n            System.out.println(str);\n        }\n\n        // æŸ¥è¯¢é›†åˆæ‰€æœ‰å…ƒç´ \n        Set<String> all = jedis.smembers(\"set\");\n        for (String str : all) {\n            System.out.println(str);\n        }\n\n        // æŸ¥è¯¢é›†åˆå…±æœ‰å¤šå°‘ä¸ªå…ƒç´ \n        Long count = jedis.scard(\"set\");\n        System.out.println(count);\n        \n        jedis.close();\n    }\n```\n\n### 4ï¼‰Hash ç±»å‹\n\n```java\n    /**\n     * Hash ç±»å‹æµ‹è¯•\n     */\n    @Test\n    public void test_hash() {\n        Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n        jedis.flushDB();\n        Map<String, String> map = new HashMap<>();\n        map.put(\"name\", \"zhangsan\");\n        map.put(\"age\", \"18\");\n        map.put(\"sex\", \"man\");\n        jedis.hset(\"user\", map);\n\n        // å¦‚æœ key ä¸­ field ä¸å­˜åœ¨ï¼Œæ·»åŠ æˆåŠŸï¼Œå¦åˆ™æ·»åŠ å¤±è´¥\n        jedis.hsetnx(\"user\", \"city\", \"beijing\");\n\n        // æ ¹æ® key çš„å±æ€§æŸ¥è¯¢ value\n        String name = jedis.hget(\"user\", \"name\");\n        System.out.println(name);\n\n        // æŸ¥è¯¢ key ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ª field\n        Boolean hexists = jedis.hexists(\"user\", \"address\");\n        System.out.println(hexists);\n\n        // æŸ¥è¯¢ key ä¸­æ‰€æœ‰çš„ field\n        Set<String> user = jedis.hkeys(\"user\");\n        for (String str : user) {\n            System.out.println(str);\n        }\n\n        // æŸ¥è¯¢ key ä¸­æ‰€æœ‰ value\n        List<String> value = jedis.hvals(\"user\");\n        for (String str : value) {\n            System.out.println(str);\n        }\n\n        jedis.close();\n    }\n```\n\n### 5ï¼‰ZSet ç±»å‹\n\n```java\n    /**\n     * zset ç±»å‹\n     */\n    @Test\n    public void test_zset() {\n        Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n        jedis.flushDB();\n\n        Map<String, Double> map = new HashMap<>();\n        map.put(\"age\", (double)2);\n        jedis.zadd(\"user\", (double) 1, \"name\");\n        jedis.zadd(\"user\", map);\n\n        // å‡åºæ’åºåæŸ¥è¯¢\n        Set<String> user = jedis.zrange(\"user\", 0, -1);\n        for (String str : user) {\n            System.out.println(str);\n        }\n\n        // é™åºæ’åºåæŸ¥è¯¢\n        Set<String> user1 = jedis.zrevrange(\"user\", 0, -1);\n        for (String str : user1) {\n            System.out.println(str);\n        }\n        \n        jedis.close();\n    }\n```\n\n## 3ã€æ¨¡æ‹Ÿå‘é€éªŒè¯ç \n\nè¦æ±‚ï¼š\n\n1. è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ 6 ä½æ•°å­—ç ï¼Œä¸¤åˆ†é’Ÿæœ‰æ•ˆã€‚\n2. è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥ã€‚\n3. æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥ 3 æ¬¡ã€‚\n\n### 1ï¼‰åˆ›å»ºä¸€ä¸ªç”ŸæˆéªŒè¯ç çš„æ–¹æ³•\n\n```java\n    public String getCode() {\n        Random random = new Random();\n        StringBuilder code = new StringBuilder();\n        for (int i = 0; i < 6; i++) {\n            code.append(random.nextInt(10));\n        }\n        return code.toString();\n    }\n```\n\n### 2ï¼‰åˆ›å»ºç”ŸæˆéªŒè¯ç çš„æ–¹æ³•\n\n```java\n    @Override\n    public Boolean createCodeByPhoneNum(String phoneNum) {\n\n        boolean result = true;\n\n        Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n\n        // éªŒè¯ç å‘é€æ¬¡æ•°\n        String sendCountKey = \"sendCode\" + phoneNum + \":count\";\n        // éªŒè¯ç  key\n        String codeKey = \"code\" + phoneNum + \":code\";\n        // éªŒè¯ç \n        String code = getCode();\n        // æ˜¯å¦å¯ä»¥å­˜å…¥éªŒè¯ç \n        boolean saveCode = true;\n\n        // 1ã€è·å–æ‰‹æœºå·å¯¹åº”å‘é€çš„æ¬¡æ•°\n        String count = jedis.get(sendCountKey);\n        if (count == null) {\n            // æ²¡æœ‰å‘é€è¿‡ï¼Œè®¾ç½®å‘é€æ¬¡æ•°ä¸º1\n            jedis.setex(sendCountKey, 24 * 60 * 60, \"1\");\n        } else if (Integer.parseInt(count) < 3) {\n            // å‘é€æ¬¡æ•° +1\n            jedis.incr(sendCountKey);\n        } else if (Integer.parseInt(count) > 2) {\n            // å·²ç»å‘é€ä¸‰æ¬¡äº†\n            saveCode = false;\n            result = false;\n            //jedis.close();\n        }\n\n        // 2ã€ä¿å­˜éªŒè¯ç \n        if (saveCode) {\n            jedis.setex(codeKey, 60 * 2, code);\n        }\n\n        jedis.close();\n        return result;\n    }\n```\n\n### 3ï¼‰åˆ›å»ºæ ¡éªŒéªŒè¯ç çš„æ–¹æ³•\n\n```java\n    @Override\n    public Boolean verifyCodeByPhoneNum(String phoneNum, String code) {\n\n        Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n\n        // éªŒè¯ç  key\n        String codeKey = \"code\" + phoneNum + \":code\";\n\n        // è·å–éªŒè¯ç \n        String redisCode = jedis.get(codeKey);\n\n        jedis.close();\n        if (redisCode == null) {\n            return false;\n        } else if (redisCode.equals(code)) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n```\n\n\n\n# ä¹ã€SpringBoot æ•´åˆ Redis\n\n## 1ã€åœ¨ pom æ–‡ä»¶ä¸­å¼•å…¥ç›¸å…³ä¾èµ–\n\n```xml\n        <!--redis-->\n        <dependency>\n            <groupId>redis.clients</groupId>\n            <artifactId>jedis</artifactId>\n            <version>3.6.3</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n            <version>2.5.3</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.commons</groupId>\n            <artifactId>commons-pool2</artifactId>\n            <version>2.8.0</version>\n        </dependency>\n```\n\n## 2ã€application.yml é…ç½® redis ç›¸å…³é…ç½®\n\n```yaml\nspring:\n  redis:\n#    Redis æœåŠ¡å™¨åœ°å€\n    host: 192.168.111.144\n#    ç«¯å£\n    port: 6379\n#    æ•°æ®åº“ç´¢å¼•\n    database: 0\n#    è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n#    timeout: 1800000\n    jedis:\n      pool:\n#        è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆè´Ÿæ•°è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰\n        max-active:\n#        æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆè´Ÿæ•°è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰\n        max-wait: -1\n#        è¿æ¥æ± ä¸­æœ€å¤§ç©ºé—²è¿æ¥\n        max-idle: 5\n#        è¿æ¥æ± å€¼æœ€å°ç©ºé—²è¿æ¥\n        min-idle: 0\n```\n\n## 3ã€é…ç½® redis é…ç½®ç±»\n\n```java\n@EnableCaching\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException {\n        // æˆ‘ä»¬ä¸ºäº†è‡ªå·±å¼€å‘æ–¹ä¾¿ï¼Œä¸€èˆ¬ç›´æ¥ä½¿ç”¨ <String, Object>\n        // ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯ Object, Object çš„ç±»å‹ï¼Œæˆ‘ä»¬åä½¿ç”¨éœ€è¦å¼ºåˆ¶è½¬æ¢ <String, Object>\n        RedisTemplate<String, Object> template = new RedisTemplate<>();\n        template.setConnectionFactory(redisConnectionFactory);\n        setRedisTemplate(template);\n        template.afterPropertiesSet();\n        return template;\n    }\n\n\n    private void setRedisTemplate(RedisTemplate<String, Object> template) {\n        // Jsonåºåˆ—åŒ–é…ç½®\n        Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer<>(Object.class);\n\n        ObjectMapper objectMapper = new ObjectMapper();\n        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);\n        // è§£å†³jackson2æ— æ³•ååºåˆ—åŒ–LocalDateTimeçš„é—®é¢˜\n        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);\n        objectMapper.registerModule(new JavaTimeModule());\n\n        // è¯¥æ–¹æ³•è¿‡æ—¶\n        // om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);\n        // ä¸Šé¢ enableDefaultTyping æ–¹æ³•è¿‡æ—¶ï¼Œä½¿ç”¨ activateDefaultTyping\n        objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);\n        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);\n\n        // String çš„åºåˆ—åŒ–\n        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();\n        // keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼\n        template.setKeySerializer(stringRedisSerializer);\n        // hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼\n        template.setHashKeySerializer(stringRedisSerializer);\n        // valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson\n        template.setValueSerializer(jackson2JsonRedisSerializer);\n        // hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson\n        template.setHashValueSerializer(jackson2JsonRedisSerializer);\n        // è®¾ç½®å€¼ï¼ˆvalueï¼‰çš„åºåˆ—åŒ–é‡‡ç”¨FastJsonRedisSerializerã€‚\n        // è®¾ç½®é”®ï¼ˆkeyï¼‰çš„åºåˆ—åŒ–é‡‡ç”¨StringRedisSerializerã€‚\n        template.afterPropertiesSet();\n    }\n\n}\n```\n\n## 4ã€redis å·¥å…·ç±»\n\nä½¿ç”¨çš„æ—¶å€™æ³¨å…¥å³å¯\n\n```java\npackage com.sy.jedis_redisdemo.utils;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.stereotype.Component;\nimport org.springframework.util.CollectionUtils;\n\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * @ClassName RedisUtil\n * @Description TODO\n * @Author sy\n * @Date 2021/8/15 22:20\n * @Version 1.0\n **/\n@Component\npublic class RedisUtil {\n\n\n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n\n\n    // =============================common============================\n\n\n    /**\n     * sy\n     * ç›‘è§† key\n     * @param key  é”®\n     */\n    public boolean watch(String key) {\n        try {\n            if (key != null && key != \"\") {\n                redisTemplate.watch(key);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n    /**\n     * sy\n     * ç›‘è§† key\n     * @param keys  é”®\n     */\n    public boolean watch(Collection<String> keys) {\n        try {\n            if (keys != null && keys.size()>0) {\n                redisTemplate.watch(keys);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n    /**\n     * sy\n     * è§£é™¤ç›‘è§† key\n     */\n    public boolean unwatch() {\n        try {\n            redisTemplate.unwatch();\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´\n     *\n     * @param key  é”®\n     * @param time æ—¶é—´(ç§’)\n     */\n    public boolean expire(String key, long time) {\n        try {\n            if (time > 0) {\n                redisTemplate.expire(key, time, TimeUnit.SECONDS);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´\n     *\n     * @param key é”® ä¸èƒ½ä¸ºnull\n     * @return æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ\n     */\n    public long getExpire(String key) {\n        return redisTemplate.getExpire(key, TimeUnit.SECONDS);\n    }\n\n\n    /**\n     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨\n     *\n     * @param key é”®\n     * @return true å­˜åœ¨ falseä¸å­˜åœ¨\n     */\n    public boolean hasKey(String key) {\n        try {\n            return redisTemplate.hasKey(key);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * åˆ é™¤ç¼“å­˜\n     *\n     * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª\n     */\n    @SuppressWarnings(\"unchecked\")\n    public void del(String... key) {\n        if (key != null && key.length > 0) {\n            if (key.length == 1) {\n                redisTemplate.delete(key[0]);\n            } else {\n                redisTemplate.delete((Collection<String>) CollectionUtils.arrayToList(key));\n            }\n        }\n    }\n\n\n    // ============================String=============================\n\n\n    /**\n     * æ™®é€šç¼“å­˜è·å–\n     *\n     * @param key é”®\n     * @return å€¼\n     */\n    public Object get(String key) {\n        return key == null ? null : redisTemplate.opsForValue().get(key);\n    }\n\n\n    /**\n     * æ™®é€šç¼“å­˜æ”¾å…¥\n     *\n     * @param key   é”®\n     * @param value å€¼\n     * @return trueæˆåŠŸ falseå¤±è´¥\n     */\n\n\n    public boolean set(String key, Object value) {\n        try {\n            redisTemplate.opsForValue().set(key, value);\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´\n     *\n     * @param key   é”®\n     * @param value å€¼\n     * @param time  æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ\n     * @return trueæˆåŠŸ false å¤±è´¥\n     */\n\n\n    public boolean set(String key, Object value, long time) {\n        try {\n            if (time > 0) {\n                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);\n            } else {\n                set(key, value);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * é€’å¢\n     *\n     * @param key   é”®\n     * @param delta è¦å¢åŠ å‡ (å¤§äº0)\n     */\n    public long incr(String key, long delta) {\n        if (delta < 0) {\n            throw new RuntimeException(\"é€’å¢å› å­å¿…é¡»å¤§äº0\");\n        }\n        return redisTemplate.opsForValue().increment(key, delta);\n    }\n\n\n    /**\n     * é€’å‡\n     *\n     * @param key   é”®\n     * @param delta è¦å‡å°‘å‡ (å°äº0)\n     */\n    public long decr(String key, long delta) {\n        if (delta < 0) {\n            throw new RuntimeException(\"é€’å‡å› å­å¿…é¡»å¤§äº0\");\n        }\n        return redisTemplate.opsForValue().increment(key, -delta);\n    }\n\n\n    // ================================Map=================================\n\n\n    /**\n     * HashGet\n     *\n     * @param key  é”® ä¸èƒ½ä¸ºnull\n     * @param item é¡¹ ä¸èƒ½ä¸ºnull\n     */\n    public Object hget(String key, String item) {\n        return redisTemplate.opsForHash().get(key, item);\n    }\n\n\n    /**\n     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼\n     *\n     * @param key é”®\n     * @return å¯¹åº”çš„å¤šä¸ªé”®å€¼\n     */\n    public Map<Object, Object> hmget(String key) {\n        return redisTemplate.opsForHash().entries(key);\n    }\n\n\n    /**\n     * HashSet\n     *\n     * @param key é”®\n     * @param map å¯¹åº”å¤šä¸ªé”®å€¼\n     */\n    public boolean hmset(String key, Map<String, Object> map) {\n        try {\n            redisTemplate.opsForHash().putAll(key, map);\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * HashSet å¹¶è®¾ç½®æ—¶é—´\n     *\n     * @param key  é”®\n     * @param map  å¯¹åº”å¤šä¸ªé”®å€¼\n     * @param time æ—¶é—´(ç§’)\n     * @return trueæˆåŠŸ falseå¤±è´¥\n     */\n    public boolean hmset(String key, Map<String, Object> map, long time) {\n        try {\n            redisTemplate.opsForHash().putAll(key, map);\n            if (time > 0) {\n                expire(key, time);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º\n     *\n     * @param key   é”®\n     * @param item  é¡¹\n     * @param value å€¼\n     * @return true æˆåŠŸ falseå¤±è´¥\n     */\n    public boolean hset(String key, String item, Object value) {\n        try {\n            redisTemplate.opsForHash().put(key, item, value);\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º\n     *\n     * @param key   é”®\n     * @param item  é¡¹\n     * @param value å€¼\n     * @param time  æ—¶é—´(ç§’) æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´\n     * @return true æˆåŠŸ falseå¤±è´¥\n     */\n    public boolean hset(String key, String item, Object value, long time) {\n        try {\n            redisTemplate.opsForHash().put(key, item, value);\n            if (time > 0) {\n                expire(key, time);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * åˆ é™¤hashè¡¨ä¸­çš„å€¼\n     *\n     * @param key  é”® ä¸èƒ½ä¸ºnull\n     * @param item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull\n     */\n    public void hdel(String key, Object... item) {\n        redisTemplate.opsForHash().delete(key, item);\n    }\n\n\n    /**\n     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼\n     *\n     * @param key  é”® ä¸èƒ½ä¸ºnull\n     * @param item é¡¹ ä¸èƒ½ä¸ºnull\n     * @return true å­˜åœ¨ falseä¸å­˜åœ¨\n     */\n    public boolean hHasKey(String key, String item) {\n        return redisTemplate.opsForHash().hasKey(key, item);\n    }\n\n\n    /**\n     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å›\n     *\n     * @param key  é”®\n     * @param item é¡¹\n     * @param by   è¦å¢åŠ å‡ (å¤§äº0)\n     */\n    public double hincr(String key, String item, double by) {\n        return redisTemplate.opsForHash().increment(key, item, by);\n    }\n\n\n    /**\n     * hashé€’å‡\n     *\n     * @param key  é”®\n     * @param item é¡¹\n     * @param by   è¦å‡å°‘è®°(å°äº0)\n     */\n    public double hdecr(String key, String item, double by) {\n        return redisTemplate.opsForHash().increment(key, item, -by);\n    }\n\n\n    // ============================set=============================\n\n\n    /**\n     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼\n     *\n     * @param key é”®\n     */\n    public Set<Object> sGet(String key) {\n        try {\n            return redisTemplate.opsForSet().members(key);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n\n\n    /**\n     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨\n     *\n     * @param key   é”®\n     * @param value å€¼\n     * @return true å­˜åœ¨ falseä¸å­˜åœ¨\n     */\n    public boolean sHasKey(String key, Object value) {\n        try {\n            return redisTemplate.opsForSet().isMember(key, value);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜\n     *\n     * @param key    é”®\n     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª\n     * @return æˆåŠŸä¸ªæ•°\n     */\n    public long sSet(String key, Object... values) {\n        try {\n            return redisTemplate.opsForSet().add(key, values);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return 0;\n        }\n    }\n\n\n    /**\n     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜\n     *\n     * @param key    é”®\n     * @param time   æ—¶é—´(ç§’)\n     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª\n     * @return æˆåŠŸä¸ªæ•°\n     */\n    public long sSetAndTime(String key, long time, Object... values) {\n        try {\n            Long count = redisTemplate.opsForSet().add(key, values);\n            if (time > 0) {\n                expire(key, time);\n            }\n            return count;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return 0;\n        }\n    }\n\n\n    /**\n     * è·å–setç¼“å­˜çš„é•¿åº¦\n     *\n     * @param key é”®\n     */\n    public long sGetSetSize(String key) {\n        try {\n            return redisTemplate.opsForSet().size(key);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return 0;\n        }\n    }\n\n\n    /**\n     * ç§»é™¤å€¼ä¸ºvalueçš„\n     *\n     * @param key    é”®\n     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª\n     * @return ç§»é™¤çš„ä¸ªæ•°\n     */\n\n\n    public long setRemove(String key, Object... values) {\n        try {\n            Long count = redisTemplate.opsForSet().remove(key, values);\n            return count;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return 0;\n        }\n    }\n\n\n    // ===============================list=================================\n\n\n    /**\n     * è·å–listç¼“å­˜çš„å†…å®¹\n     *\n     * @param key   é”®\n     * @param start å¼€å§‹\n     * @param end   ç»“æŸ 0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼\n     */\n    public List<Object> lGet(String key, long start, long end) {\n        try {\n            return redisTemplate.opsForList().range(key, start, end);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n\n\n    /**\n     * è·å–listç¼“å­˜çš„é•¿åº¦\n     *\n     * @param key é”®\n     */\n    public long lGetListSize(String key) {\n        try {\n            return redisTemplate.opsForList().size(key);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return 0;\n        }\n    }\n\n\n    /**\n     * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼\n     *\n     * @param key   é”®\n     * @param index ç´¢å¼• index>=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index<0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨\n     */\n    public Object lGetIndex(String key, long index) {\n        try {\n            return redisTemplate.opsForList().index(key, index);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n\n\n    /**\n     * å°†listæ”¾å…¥ç¼“å­˜\n     *\n     * @param key   é”®\n     * @param value å€¼\n     */\n    public boolean lSet(String key, Object value) {\n        try {\n            redisTemplate.opsForList().rightPush(key, value);\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * å°†listæ”¾å…¥ç¼“å­˜\n     *\n     * @param key   é”®\n     * @param value å€¼\n     * @param time  æ—¶é—´(ç§’)\n     */\n    public boolean lSet(String key, Object value, long time) {\n        try {\n            redisTemplate.opsForList().rightPush(key, value);\n            if (time > 0) {\n                expire(key, time);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * å°†listæ”¾å…¥ç¼“å­˜\n     *\n     * @param key   é”®\n     * @param value å€¼\n     * @return\n     */\n    public boolean lSet(String key, List<Object> value) {\n        try {\n            redisTemplate.opsForList().rightPushAll(key, value);\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * å°†listæ”¾å…¥ç¼“å­˜\n     *\n     * @param key   é”®\n     * @param value å€¼\n     * @param time  æ—¶é—´(ç§’)\n     * @return\n     */\n    public boolean lSet(String key, List<Object> value, long time) {\n        try {\n            redisTemplate.opsForList().rightPushAll(key, value);\n            if (time > 0) {\n                expire(key, time);\n            }\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®\n     *\n     * @param key   é”®\n     * @param index ç´¢å¼•\n     * @param value å€¼\n     * @return\n     */\n    public boolean lUpdateIndex(String key, long index, Object value) {\n        try {\n            redisTemplate.opsForList().set(key, index, value);\n            return true;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n    }\n\n\n    /**\n     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue\n     *\n     * @param key   é”®\n     * @param count ç§»é™¤å¤šå°‘ä¸ª\n     * @param value å€¼\n     * @return ç§»é™¤çš„ä¸ªæ•°\n     */\n    public long lRemove(String key, long count, Object value) {\n        try {\n            Long remove = redisTemplate.opsForList().remove(key, count, value);\n            return remove;\n        } catch (Exception e) {\n            e.printStackTrace();\n            return 0;\n        }\n    }\n\n\n}\n\n```\n\n## 5ã€ç¼–å†™ controller æµ‹è¯•\n\n```java\n\tprivate final RedisUtil redisUtil;\n    /**\n     * sy\n     * éªŒè¯redisæ•´åˆ\n     * @return ResultBody\n     */\n    @ApiOperation(value = \"éªŒè¯redisæ•´åˆ\")\n    @GetMapping(value = \"/verifyRedis\")\n    public ResultBody verifyRedis() {\n\n        redisUtil.set(\"test\", \"ceshi\");\n        String value = (String) redisUtil.get(\"test\");\n\n        System.out.println(value);\n\n        return ResultBody.success();\n    }\n```\n\n# åã€Redis äº‹åŠ¡å’Œé”æœºåˆ¶\n\n**Redis** äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºçš„æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚\n\n**Redis** äº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯<font color=\"red\">ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚</font>\n\n## 1ã€åŸºæœ¬æ“ä½œ\n\n### 1ï¼‰ã€Multiã€Execã€Discard\n\n**Multiï¼š**å¼€å§‹äº‹åŠ¡ï¼Œè¿›è¡Œç»„é˜Ÿé˜¶æ®µ\n\n**Execï¼š**æ‰§è¡Œé˜¶æ®µï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œ\n\n**Discardï¼š**æ”¾å¼ƒæ‰§è¡Œ\n\nä»è¾“å…¥ **Multi** å‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥ **Exec** åï¼Œ**Redis** éƒ½ä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚\n\nç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡ **Discard** æ¥æ”¾å¼ƒç»„é˜Ÿ\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](29.png)\n\n**ç¤ºä¾‹ï¼š**\n\n```shell\n# å¼€å¯äº‹åŠ¡\nmulti\nset key1 value1\nset key2 value2\n# æ‰§è¡Œ\nexec\nkeys *\n\n# å¼€å¯äº‹åŠ¡\nmulti\nset a1 v1\nset a2 v2\n# æ”¾å¼ƒäº‹åŠ¡\ndiscard\nkeys *\n```\n\n### 2ï¼‰äº‹åŠ¡çš„é”™è¯¯å¤„ç†\n\näº‹åŠ¡å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯æœ‰ä¸¤ç§ï¼š\n\n1. ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆ\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](30.png)\n\n   **ç¤ºä¾‹ï¼š**\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](31.png)\n\n   \n\n2. æ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤å‡ºç°äº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šæ‰§è¡Œï¼Œè€Œå…¶ä»–å‘½ä»¤æ­£å¸¸æ‰§è¡Œã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](32.png)\n\n## 2ã€äº‹åŠ¡å†²çªçš„é—®é¢˜\n\n**åœºæ™¯ï¼š**æœ‰å¾ˆå¤šäººæœ‰ä½ çš„è´¦æˆ·ï¼ŒåŒäº‹å»å‚åŠ åŒåä¸€æŠ¢è´­\n\n## 3ã€ä¾‹å­\n\n- ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡8000\n- ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡5000\n- ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡1000\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](33.png)\n\n### 1ï¼‰è§£å†³æ–¹æ¡ˆ\n\n#### 1. æ‚²è§‚é”\n\n**ä»€ä¹ˆæ˜¯æ‚²è§‚é”ï¼š**é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿åˆ°æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³å»æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š **blockï¼ˆé˜»å¡ï¼‰**,çŸ¥é“ä»–ç”¨å®Œæ•°æ®ï¼Œå°†é”é‡Šæ”¾åï¼Œè¢«äººæ‰å¯ä»¥æ‹¿åˆ°æ•°æ®ã€‚<font color=\"red\">ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸­å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶</font>ï¼Œæ¯”å¦‚<font color=\"red\">è¡Œé”</font>ï¼Œ<font color=\"red\">è¡¨é”</font>ç­‰ï¼Œ<font color=\"red\">è¯»é”</font>ï¼Œ<font color=\"red\">å†™é”</font>ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”<font color=\"red\">é”</font>ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](34.png)\n\n#### 2.ä¹è§‚é”\n\n**ä»€ä¹ˆæ˜¯ä¹è§‚é”ï¼š**é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚<font color=\"red\">ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚Redis å°±æ˜¯åˆ©ç”¨è¿™ç§ check-and-set æœºåˆ¶å®ç°äº‹åŠ¡çš„</font>ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](35.png)\n\n#### 3.watch key [key...] å‘½ä»¤\n\nåœ¨æ‰§è¡Œ **Multi** ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ **watch key [keys...]** å‘½ä»¤ï¼Œå¯ä»¥ç›‘è§†ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰**key**ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ªï¼ˆè¿™äº›ï¼‰**key** è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†ä¼šè¢«æ‰“æ–­\n\n**æµ‹è¯•ä¾‹å­ï¼š**\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](41.png)\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](42.png)\n\n## 4ã€Redis äº‹åŠ¡ä¸‰ç‰¹æ€§\n\n1. å•ç‹¬çš„éš”ç¦»æ“ä½œï¼š\n\n   äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºçš„æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤è¯·æ±‚æ‰“æ–­ã€‚\n\n2. æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼š\n\n   é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œã€‚\n\n3. ä¸ä¿è¯åŸå­æ€§ï¼š\n\n   äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»šã€‚\n\n## 5ã€ç§’æ€æ¡ˆä¾‹\n\n### 1ï¼‰åŸºæœ¬å®ç°\n\n**é¡µé¢ï¼š**\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](36.png)\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\">\n<!--<script th:src=\"@{/webjars/jquery/3.5.1/jquery.min.js}\"></script>-->\n<script src=\"webjars/jquery/3.5.1/jquery.min.js\"></script>\n\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n</head>\n<body>\n<h1>iPhone 13 pro!!! 1å…ƒç§’æ€ï¼ï¼ï¼</h1>\n<form id=\"msform\" action=\"http://localhost:8079/redis/ms/doseckill\">\n    <input type=\"hidden\" id=\"prodid\" name=\"prodid\" value=\"0101\">\n    ç”¨æˆ·idï¼š<input type=\"text\" id=\"userId\" name=\"userid\">\n    <input type=\"button\" id=\"miaosha_btn\" name=\"seckill_btn\" value=\"ç§’æ€ç‚¹æˆ‘\"/>\n</form>\n\n</body>\n<script>\n    $(function () {\n        var form = $(\"#msform\");\n\n        var parems = {};\n\n        $(\"#miaosha_btn\").click(function () {\n            parems.userId = $(\"#userId\").val();\n            parems.prodid = $(\"#prodid\").val();\n            $.ajax({\n                type: \"post\",\n                url: \"http://localhost:8079/redis/ms/doseckill\",\n                data: JSON.stringify(parems),\n                dataType: \"json\",\n                contentType: \"application/json;charset=utf-8\",\n                success: function (data) {\n                    // if (data === \"false\") {\n                    //     alert(\"æŠ¢å…‰äº†\");\n                    //     $(\"#miaosha_btn\").attr(\"disabled\", true);\n                    // }\n                    if (data.code === \"00000\") {\n                        alert(data.message);\n                        $(\"#miaosha_btn\").attr(\"disabled\", true);\n                    } else if (data.code === \"50000\") {\n                        alert(data.message);\n                    }\n                }\n            })\n        })\n\n    })\n</script>\n</html>\n```\n\n**å®ä½“ç±»ï¼š**\n\n```java\npackage com.sy.jedis_redisdemo.restful.beans;\n\nimport lombok.Data;\n\n/**\n * @ClassName User\n * @Description TODO\n * @Author sy\n * @Date 2021/8/16 19:39\n * @Version 1.0\n **/\n@Data\npublic class User {\n\n    public String userId;\n\n    public String prodid;\n}\n\n```\n\n**Controllerï¼š**\n\n```java\npackage com.sy.jedis_redisdemo.restful.controller;\n\nimport com.sy.api.context.ResultBody;\nimport com.sy.jedis_redisdemo.restful.beans.User;\nimport com.sy.jedis_redisdemo.restful.service.MsService;\nimport io.swagger.annotations.Api;\nimport io.swagger.annotations.ApiOperation;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\n/**\n * @ClassName MsController\n * @Description TODO\n * @Author sy\n * @Date 2021/8/16 18:14\n * @Version 1.0\n **/\n@Api(value = \"ç§’æ€\", tags = \"ç§’æ€\")\n@RestController\n@RequestMapping(\"/ms\")\npublic class MsController {\n\n    @Autowired\n    private MsService msService;\n\n    @ApiOperation(value = \"ç§’æ€\")\n    @PostMapping(value = \"/doseckill\")\n    public ResultBody doseckill(@RequestBody User user) {\n        return msService.doseckill(user);\n    }\n}\n```\n\n**Serviceï¼š**\n\n```java\npackage com.sy.jedis_redisdemo.restful.service;\n\nimport com.sy.api.context.ResultBody;\nimport com.sy.jedis_redisdemo.restful.beans.User;\n\n/**\n * @ClassName MsService\n * @Description TODO\n * @Author sy\n * @Date 2021/8/16 19:43\n * @Version 1.0\n **/\npublic interface MsService {\n\n    ResultBody doseckill(User user);\n}\n```\n\n**ServiceImplï¼š**\n\n```java\npackage com.sy.jedis_redisdemo.restful.service.impl;\n\nimport com.baomidou.mybatisplus.extension.api.R;\nimport com.sy.api.context.ResultBody;\nimport com.sy.jedis_redisdemo.restful.beans.User;\nimport com.sy.jedis_redisdemo.restful.service.MsService;\nimport com.sy.jedis_redisdemo.utils.RedisUtil;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport redis.clients.jedis.Jedis;\nimport sun.net.RegisteredDomain;\n\n/**\n * @ClassName MsServiceImpl\n * @Description TODO\n * @Author sy\n * @Date 2021/8/16 19:43\n * @Version 1.0\n **/\n@Service\npublic class MsServiceImpl implements MsService {\n\n    @Autowired\n    private RedisUtil redisUtil;\n\n    @Override\n    public ResultBody doseckill(User user) {\n        //1ã€userId å’Œ prodid éç©ºåˆ¤æ–­\n        if (StringUtils.isEmpty(user.userId) || StringUtils.isEmpty(user.prodid)) {\n            return ResultBody.error(\"ç”¨æˆ·æˆ–å•†å“idä¸èƒ½ä¸ºç©º\");\n        }\n\n        //2ã€è¿æ¥ redis\n        //Jedis jedis = new Jedis(\"192.168.111.144\", 6379);\n        //RedisUtil redisUtil = new RedisUtil();\n\n        //3ã€æ‹¼æ¥key\n        //3.1 åº“å­˜key\n        String kcKey = \"sk:\" + user.prodid + \":kc\";\n        //3.2 ç§’æ€æˆåŠŸç”¨æˆ·key\n        String userKey = \"sk:\" + user.prodid + \":user\";\n\n        //4ã€è·å–åº“å­˜ï¼Œå¦‚æœåº“å­˜ä¸ºnullï¼Œç§’æ€è¿˜æœªå¼€å§‹\n        Object kc = redisUtil.get(kcKey);\n        if (kc == null) {\n            return ResultBody.error(\"ç§’æ€æœªå¼€å§‹ï¼Œè¯·ç­‰å¾…ï¼\");\n        }\n        //5ã€åˆ¤æ–­ç”¨æˆ·æ˜¯å¦é‡å¤ç§’æ€æ“ä½œ\n        if (redisUtil.sHasKey(userKey, user.userId)) {\n            return ResultBody.error(\"å·²ç»ç§’æ€æˆåŠŸï¼Œä¸èƒ½é‡å¤ç§’æ€ï¼\");\n        }\n\n        //6ã€åˆ¤æ–­åº“å­˜æ•°é‡ï¼Œå¦‚æœæ•°é‡å°äº1ï¼Œç§’æ€ç»“æŸ\n        if ((int)kc <= 0) {\n            return ResultBody.error(\"ç§’æ€å·²ç»ç»“æŸï¼\");\n        }\n\n        //7ã€ç§’æ€è¿‡ç¨‹\n        //7.1 åº“å­˜ -1\n        redisUtil.decr(kcKey, 1);\n        //7.1 æŠŠç§’æ€æˆåŠŸç”¨æˆ·æ·»åŠ åˆ°æ¸…å•ä¸­\n        redisUtil.sSet(userKey, user.userId);\n        return ResultBody.success(\"ç§’æ€æˆåŠŸï¼\");\n    }\n}\n\n```\n\n### 2ï¼‰abå·¥å…·æ¨¡æ‹Ÿå¹¶å‘\n\n#### 2-1ï¼‰å®‰è£… **httpd-tools**\n\næ‰§è¡Œ **yum install httpd-tools** å®‰è£…\n\n#### 2-2ï¼‰å‘½ä»¤åŠå¸¸ç”¨å‚æ•°\n\n**å¸¸ç”¨å‚æ•°ï¼š**ab --list å¯æŸ¥çœ‹æ‰€æœ‰å‚æ•°\n\n```shell\n\t# è¯·æ±‚æ¬¡æ•°\n    -n requests     Number of requests to perform\n    # å¹¶å‘æ¬¡æ•°\n    -c concurrency  Number of multiple requests to make at a time\n    # æäº¤å‚æ•°,å‚æ•°è¦å†™åˆ°æ–‡ä»¶ä¸­ï¼Œé’ˆå¯¹post,ä½¿ç”¨æ—¶è¦è®¾ç½® -T\n    -p postfile     File containing data to POST. Remember also to set -T\n    -u putfile      File containing data to PUT. Remember also to set -T\n    # è®¾ç½® content-typeï¼Œå’Œä½ è¯·æ±‚çš„ content-type ä¸€æ ·\n    -T content-type Content-type header to use for POST/PUT data, eg.\n                    'application/x-www-form-urlencoded'\n                    Default is 'text/plain'  \n```\n\n**å‘½ä»¤ï¼š**\n\n```shell\n# 1000 æ¬¡è¯·æ±‚ï¼Œå…¶ä¸­å¹¶å‘è¯·æ±‚æœ‰100ä¸ªï¼Œå‚æ•°æ–‡ä»¶æ˜¯ postfiel\nab -n 1000 -c 100 -p postfile -T 'application/json;charset=utf-8' http://192.168.111.2:8079/redis/ms/doseckill\n```\n\n#### 2-3ï¼‰æµ‹è¯•\n\n1. **åˆ›å»º postfile å‚æ•°æ–‡ä»¶å†…å®¹ï¼ˆç”¨äº ab å·¥å…·æµ‹è¯•å¹¶å‘å‘é€çš„å‚æ•°ï¼‰ï¼š**\n\n   ```json\n   {\"prodid\" : \"0101\"}\n   ```\n\n2. **ä¿®æ”¹ controllerï¼š**å› ä¸ºåŒä¸€ä¸ª **userId** ä¸èƒ½é‡å¤ç§’æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œéšæœºä¸€ä¸ªã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](37.png)\n\n3. **æ‰§è¡Œå‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š**\n\n   ```shell\n   ab -n 1000 -c 100 -p postfile -T 'application/json;charset=utf-8' http://192.168.111.2:8079/redis/ms/doseckill\n   ```\n\n4. **æŸ¥çœ‹æ‰§è¡Œç»“æœï¼š**\n\n   æ‰§è¡Œå‘½ä»¤çš„ç»“æœï¼š\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](38.png)\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](39.png)\n\n   **redis** ä¸­æ•°æ®æƒ…å†µï¼š\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](40.png)\n\n5. å‡ºç°çš„é—®é¢˜ï¼š\n\n   - åœ¨ä¸Šé¢æµ‹è¯•ç»“æœä¸­å¯ä»¥çœ‹åˆ°åº“å­˜æ•°é‡å˜ä¸ºäº† -35 ï¼Œè¿™é‡Œå‡ºç°çš„å°±æ˜¯ **è¶…å–** çš„é—®é¢˜\n   - è¿˜å¯èƒ½ä¼šå‡ºç° **è¿æ¥è¶…æ—¶çš„é—®é¢˜**\n\n### 3ï¼‰è¶…å–å’Œè¿æ¥è¶…æ—¶é—®é¢˜è§£å†³\n\n#### 3-1ï¼‰è¿æ¥è¶…æ—¶é—®é¢˜\n\nè¿™ä¸ªé—®é¢˜åœ¨ **[SpringBoot æ•´åˆ Redis](https://sunyubk.github.io/2021/08/06/Redis%E5%AD%A6%E4%B9%A0/#%E4%B9%9D%E3%80%81SpringBoot-%E6%95%B4%E5%90%88-Redis)** </a>ä¸­ï¼Œé€šè¿‡ **ymlï¼ŒredisConfigï¼ŒRedisUtils** å·²ç»è§£å†³äº†\n\n#### 3-2ï¼‰è¶…å–é—®é¢˜\n\n##### 1.setnx è§£å†³\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](44.png)\n\n##### 2.Redisson è§£å†³\n\n1. æ·»åŠ ä¾èµ–\n\n   ```xml\n           <!--redisson-->\n           <dependency>\n               <groupId>org.redisson</groupId>\n               <artifactId>redisson-spring-boot-starter</artifactId>\n               <version>3.13.6</version>\n           </dependency>\n   ```\n\n2. ä¿®æ”¹ **serviceImpl**\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](45.png)\n   \n   è¿™é‡Œä¸ç”¨è€ƒè™‘ é”è¯¯åˆ çš„é—®é¢˜ï¼Œå› ä¸ºRedissonå†…éƒ¨å·²ç»æ‹¼æ¥äº†ï¼Œè§ä¸‹å›¾ï¼š\n   \n   è¿™é‡Œçš„ **id** æ˜¯ **ConnectionManager** çš„ä¸€ä¸ªå±æ€§ï¼Œç»§ç»­è¿½æºç ä½ ä¼šå‘ç°ä»–ä¹Ÿæ˜¯ä¸€ä¸ª **UUID** ç±»å‹çš„ã€‚\n   \n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](91.png)\n\n# åä¸€ã€Redis æŒä¹…åŒ–\n\n## 1ã€RDB\n\n### 1ï¼‰ä»€ä¹ˆæ˜¯ RDB\n\n**RDB** å°±æ˜¯åœ¨æŒ‡å®šçš„<font color=\"red\">æ—¶é—´é—´éš”</font>å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†<font color=\"red\">å¿«ç…§</font>å†™å…¥ç£ç›˜ã€‚\n\nç›´ç™½çš„è¯´å°±æ˜¯ï¼šåœ¨æŸä¸€æ—¶åˆ»è®°å½•ä¸‹æ•°æ®å¿«ç…§ï¼Œåœ¨æ—¶é—´é—´éš”å†…å°†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ï¼Œæ¢å¤çš„æ—¶å€™ä¹Ÿæ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜ä¸­\n\n### 2ï¼‰å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„\n\n**Redis** ä¼šå•ç‹¬åˆ›å»ºä¸€ä¸ª **(Fork)** ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œç­‰æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ª<font color=\"red\">ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶</font>ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹ä¸è¿›è¡Œä»»ä½• **IO** æ“ä½œï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦å¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ï¼Œè€Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ **RDB** æ–¹å¼è¦æ¯” **AOF** æ–¹å¼æ›´åŠ é«˜æ•ˆã€‚\n\n**RDB** çš„ç¼ºç‚¹å°±æ˜¯ï¼šæœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚\n\n### 3ï¼‰å¤‡ä»½æ–‡ä»¶ä½ç½®ä¸å¤‡ä»½è§„åˆ™\n\nä½ç½®ï¼šé»˜è®¤åœ¨é‚£ä¸ªç›®å½•ä¸‹å¯åŠ¨ **redis** æœåŠ¡ï¼Œæ–‡ä»¶å°±ç”Ÿæˆåœ¨å“ªé‡Œã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](46.png)\n\nè§„åˆ™ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](47.png)\n\n### 4ï¼‰å‘½ä»¤ save VS bgsave\n\n**Redis** é»˜è®¤æƒ…å†µä¸‹æ˜¯è‡ªåŠ¨è¿›è¡Œå¤‡ä»½çš„ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤è¿›è¡Œæ‰‹åŠ¨å¤‡ä»½ã€‚\n\n**saveï¼š**save æ—¶åªç®¡ä¿å­˜ï¼Œå…¶ä»–ä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚ä¸å»ºè®®\n\n<font color=\"red\">**bgsaveï¼š** Redis ä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</font>\n\n## 2ã€AOF\n\n### 1ï¼‰ä»€ä¹ˆæ˜¯ AOF\n\n<font color=\"red\">ä»¥Â **æ—¥å¿—**Â çš„å½¢å¼ç±»è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆå¢é‡ä¿å­˜ï¼‰</font>ï¼Œå°† **Redis** æ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼ˆ<font color=\"red\">è¯»æ“ä½œä¸è®°å½•</font>ï¼‰ï¼Œ<font color=\"red\">åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶</font>ï¼Œ**Redis** å¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ã€‚ç®€å•çš„æ¥è¯´å°±æ˜¯æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†æ‰€æœ‰æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡æ¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚\n\n### 2ï¼‰AOF æŒä¹…åŒ–æµç¨‹\n\n1. å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢« **append** è¿½åŠ åˆ° **AOF** ç¼“å†²åŒºå†…ï¼›\n2. **AOF** ç¼“å†²åŒºæ ¹æ® **AOF** æŒä¹…åŒ–ç­–ç•¥ **[alwaysï¼Œeverysecï¼Œno]**ï¼Œå°†æ“ä½œ **sync** åŒæ­¥åˆ°ç£ç›˜çš„ **AOF** æ–‡ä»¶ä¸­ï¼›\n3. **AOF** æ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹ **AOF** æ–‡ä»¶ **rewrite** é‡å†™ï¼Œå‹ç¼© **AOF** æ–‡ä»¶çš„å®¹é‡ï¼›\n4. **Redis** æœåŠ¡é‡å¯æ˜¯ï¼Œä¼šé‡æ–° **load** åŠ è½½ **AOF** æ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„ï¼›\n\n### 3ï¼‰AOF é»˜è®¤ä¸å¼€å¯\n\nå¯ä»¥å† **redis.conf** ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸ºï¼š**appendonly.aof**\n\n**AOF** æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ä¸ **RDB** çš„è·¯å¾„ä¸€è‡´\n\n### 4ï¼‰AOF å’Œ RDB åŒæ—¶å¼€å¯ï¼ŒRedis å¬è°çš„ï¼Ÿ\n\n**AOF** å’Œ **RDB** åŒæ—¶å¼€å¯ï¼Œç³»ç»Ÿé»˜è®¤å– **AOF** çš„æ•°æ®ï¼ˆæ•°æ®ä¸ä¼šå­˜åœ¨ä¸¢å¤±æƒ…å†µï¼‰\n\n### 5ï¼‰AOF æ–‡ä»¶æŸåxiuf\n\n- å¦‚æœé‡åˆ° **AOF** æ–‡ä»¶æŸåï¼Œå¯ä»¥é€šè¿‡ï¼š/bin/<font color=\"red\">redis-check-for-aof--fix appendonly.aof</font> è¿›è¡Œæ¢å¤\n- å¤‡ä»½è¢«å†™åçš„ **AOF** æ–‡ä»¶\n- æ¢å¤ï¼šé‡å¯ **Redis**ï¼Œç„¶åä¼šè‡ªåŠ¨åŠ è½½ **AOF** æ–‡ä»¶\n\n### 6ï¼‰AOF åŒæ­¥é¢‘ç‡è®¾ç½®\n\n1. **appendfsync always**\n\n   å§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡ **Redis** çš„å†™æ“ä½œéƒ½ä¼šlikeè®°å…¥æ—¥å¿—ï¼›æ€§èƒ½æ¯”è¾ƒå·®ï¼Œä½†æ˜¯æ•°æ®çš„å®Œæ•´æ€§æ¯”è¾ƒå¥½ã€‚\n\n2. **appendfsync everysec**\n\n   æ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±\n\n3. **appendfsync no**\n\n   **Redis** ä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿã€‚\n\n### 7ï¼‰Rewrite å‹ç¼©\n\nå½“ **AOF** æ–‡ä»¶ >= è®¾ç½®å®šæ–‡ä»¶å¤§å°åï¼Œä¼šå¯¹ **AOF** æ–‡ä»¶è¿›è¡Œ<font color=\"red\">å‹ç¼©é‡å†™</font>\n\nä¾‹ï¼š\n\n```shel\n# æˆ‘ä»¬å®é™…æ‰§è¡Œçš„æŒ‡ä»¤\nset k1 v1\nset k2 v2\n\nå‹ç¼©åçš„\nset k1 v1 k2 v2\n```\n\n<font color=\"red\">å…¶å® AOF çš„å‹ç¼©é‡å†™ï¼Œå°±æ˜¯æŠŠä¸€äº›å‘½ä»¤é‡å†™ä¸ºä¸€æ¡å‘½ä»¤ï¼Œä¸å»å…³æ³¨è¿‡ç¨‹ï¼Œåªå…³æ³¨æœ€åçš„ç»“æœã€‚</font>\n\n# åäºŒã€Redis ä¸»ä»å¤åˆ¶\n\n## 1ã€ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶\n\nä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„ <font color=\"red\">master/slaver æœºåˆ¶</font>ï¼Œ  <font color=\"red\">**Master**Â ä»¥å†™ä¸ºä¸»ï¼Œ**Slaver**Â ä»¥è¯»ä¸ºä¸»</font>ã€‚\n\n## 2ã€èƒ½å¹²å˜›\n\n- è¯»å†™åˆ†ç¦»ï¼Œæ€§èƒ½æ‰©å±•ã€‚\n\n- å®¹ç¾å¿«é€Ÿæ¢å¤\n\n  å¦‚æœæŸä¸€å°ä»æœºå‡ºç°é—®é¢˜ï¼Œå¯ä»¥åˆ‡æ¢å¦ä¸€å°ä»æœºã€‚å¦‚æœæ˜¯ä¸»æœºå‡ºç°é—®é¢˜ï¼Œåˆ™å¯ä»¥é€šè¿‡é›†ç¾¤æ¥è§£å†³ã€‚\n\n  ![å›¾ç‰‡åŠ è½½å¤±è´¥](48.png)\n\n## 3ã€ä¸»ä»é…ç½®\n\nè¿™é‡Œæ˜¯åœ¨ä¸€å°è™šæ‹Ÿæœºä¸­ï¼Œé€šè¿‡ä¸åŒç«¯å£æ¥æ¨¡æ‹Ÿå¤šå°æœåŠ¡å™¨\n\n1. æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œåå­—è‡ªå·±å®šä¹‰å°±å¥½äº†ã€‚\n\n2. å°†æˆ‘ä»¬åŸæœ¬çš„ **redis.conf** å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„ç›®å½•ä¸­ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](49.png)\n\n3. åˆ›å»ºä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«ä»¥ç«¯å£è¿›è¡ŒåŒºåˆ«ï¼Œå†…å®¹é…ç½®ä¹Ÿè¦è¿›è¡Œç›¸åº”çš„ä¿®æ”¹\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](50.png)\n\n   ```shell\n   # å¼•å…¥åŸºæœ¬çš„é…ç½®æ–‡ä»¶\n   include /usr/local/myredis/redis.conf\n   # é‡æ–°é…ç½®çš„å†…å®¹ï¼Œå¯ä»¥è¦†ç›–åŸºæœ¬é…ç½®ä¸­é…ç½®çš„\n   pidfile /var/run/redis_6379.pid\n   port 6379\n   dbfilename dump6379.rdb\n   ```\n\n4. å¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»èµ·æ¥äº†è¿™ä¸‰ä¸ª **Redis**\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](51.png)\n\n5. è¿æ¥ä¸‰å° **Redis** å¹¶æŸ¥çœ‹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰å° **Redis** éƒ½æ˜¯ **master(ä¸»)**\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](52.png)\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](53.png)\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](54.png)\n\n6. é…ç½®ä¸»ä»å…³ç³»ï¼š**é…ä»ï¼ˆåº“ï¼‰ä¸é…ä¸»ï¼ˆåº“ï¼‰**\n\n   ```shell\n   # åœ¨ä»æœºä¸­ä½¿ç”¨å‘½ä»¤é…ç½®ï¼Œipï¼šä¸»æœºipï¼Œportï¼šä¸»æœºç«¯å£\n   slaveof ip port\n   \n   # å–æ¶ˆä»æœåŠ¡å™¨é…ç½®ï¼Œä¼šé‡æ–°å˜æˆä¸»æœåŠ¡å™¨\n   slaveof no one\n   ```\n\n7. æŸ¥çœ‹ä¿¡æ¯å·²ç»å¯ä»¥çœ‹åˆ°ï¼Œè§’è‰²ï¼ˆroleï¼‰å·²ç»ä¸ºä»æœºï¼ˆslaveï¼‰\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](55.png)\n\n8. æµ‹è¯•\n\n   - åœ¨ä¸»æœºä¸­æ–°å¢ä¸€ä¸ª **key**\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](56.png)\n\n   - åœ¨ä»æœºä¸­æŸ¥çœ‹\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](57.png)\n\n   <font color=\"red\">æ³¨æ„ï¼šå†™æ“ä½œåªèƒ½åœ¨ä¸»æœºä¸­è¿›è¡Œï¼Œä»æœºä¸­åªèƒ½è¿›è¡Œè¯»æ“ä½œ</font>\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](58.png)\n\n## 4ã€ä¸»ä»å¤åˆ¶çš„åŸç†\n\n1. å½“ä»æœåŠ¡å™¨ï¼ˆ**slave**ï¼‰è¿æ¥ä¸Šä¸»æœåŠ¡å™¨ï¼ˆ**master**ï¼‰ä¹‹åï¼Œä»æœåŠ¡å™¨ï¼ˆ**slave**ï¼‰ä¼šå‘ä¸»æœåŠ¡å™¨ï¼ˆ**master**ï¼‰å‘é€è¿›è¡Œæ•°æ®åŒæ­¥çš„æ¶ˆæ¯\n2. **master** æ¥åˆ° **slave** å‘é€è¿‡æ¥çš„åŒæ­¥æ¶ˆæ¯åï¼ŒæŠŠ **master** çš„æ•°æ®ä¼šæŒä¹…åŒ–åˆ° **RDB** æ–‡ä»¶ï¼ŒæŠŠ **RDB** æ–‡ä»¶å‘é€ç»™ **slave**ï¼Œ**slave** æ‹¿åˆ° **RDB** æ–‡ä»¶è¿›è¡Œè¯»å–\n3. **master** æ¯æ¬¡è¿›è¡Œå†™æ“ä½œåï¼Œä¼šå’Œ **slave** è¿›è¡ŒåŒæ­¥æ•°æ®ã€‚\n\n<font color=\"red\">æ³¨æ„ï¼š</font>\n\nä¸Šé¢ç¬¬ 2 æ­¥æ˜¯ **slave** ä¸»åŠ¨åŒæ­¥æ•°æ®ï¼ˆå…¨é‡å¤åˆ¶ï¼‰ï¼Œç¬¬ 3 æ­¥æ˜¯ **master** ä¸»åŠ¨åŒæ­¥æ•°æ®ï¼ˆå¢é‡å¤åˆ¶ï¼‰\n\n- **å…¨é‡å¤åˆ¶ï¼š**ä»æœåŠ¡å™¨ï¼ˆ**slave**ï¼‰ä¸»åŠ¨å‘é€æ¶ˆæ¯åŒæ­¥æ•°æ®\n- **å¢é‡å¤åˆ¶ï¼š**ä¸»æœåŠ¡å™¨ï¼ˆ**master**ï¼‰å°†å†™æ“ä½œå‘½ä»¤ä¼ ç»™ä»æœåŠ¡å™¨ï¼ˆ**slave**ï¼‰è¿›è¡Œæ•°æ®åŒæ­¥\n\n## 5ã€ä¸€ä¸»äºŒä»†\n\n**ç‰¹ç‚¹ï¼š**\n\n1. å½“æŸä¸€å°ä»æœåŠ¡å™¨æŒ‚æ‰ä¹‹åå†é‡å¯ï¼Œä»–é‡æ–°å˜æˆä¸€ä¸ªä¸»æœºï¼Œå¹¶ä¸ä¼šæ¢å¤æˆåŸæ¥çš„ä»æœåŠ¡å™¨\n2. å½“æŸä¸€å°å†²æœåŠ¡å™¨æŒ‚æ‰ä¹‹åï¼Œä¸»æœåŠ¡æ•°æ®å‘ç”Ÿäº†å˜åŠ¨ï¼Œä»æœåŠ¡å™¨é‡å¯ä¹‹åï¼Œé‡æ–°è®¾ç½®æˆä¸»æœåŠ¡çš„ä»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»–ä¼šå°†ä¸»æœåŠ¡å™¨çš„æ•°æ®å¤åˆ¶è¿‡æ¥\n3. å½“ä¸»æœåŠ¡æŒ‚æ‰ä¹‹åï¼Œä»æœåŠ¡å™¨è¿˜æ˜¯ä»æœåŠ¡å™¨ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°ä¸»æœåŠ¡å™¨å·²ç»æŒ‚æ‰äº†ï¼ˆdownï¼‰ï¼Œå¹¶ä¸ä¼šä¸Šä½å˜æˆä¸»æœåŠ¡å™¨ã€‚å½“ä¸»æœåŠ¡å™¨é‡æ–°å¯åŠ¨ä¹‹åï¼Œä¾æ—§æ˜¯ä¸»æœåŠ¡å™¨ï¼Œä¸¤å°ä»æœåŠ¡å™¨è¿˜æ˜¯ä»–å°å¼Ÿï¼Œå¹¶ä¸”å¯ä»¥å†ä¿¡æ¯ä¸­çœ‹åˆ°å¤§å“¥çš„çŠ¶æ€æ˜¯å¯åŠ¨çš„ï¼ˆupï¼‰\n\n**æµ‹è¯•ï¼š**\n\n1. **shutdown** æ‰ 6381ï¼ŒæŸ¥çœ‹ä¸»æœåŠ¡å™¨ï¼ˆ6379ï¼‰ çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»æœåŠ¡å™¨ä¿¡æ¯ä¸­åªæœ‰ä¸€å°ä»æœåŠ¡å™¨äº†\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](59.png)\n\n2. æˆ‘ä»¬åœ¨ ä¸»æœåŠ¡å™¨ï¼ˆ6379ï¼‰ä¸­éšæ„æ·»åŠ å‡ æ¡æ•°æ®ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](62.png)\n\n3. é‡æ–°å¯åŠ¨ 6381ï¼Œå¹¶æŸ¥çœ‹ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–é‡æ–°å˜æˆäº†ä¸»æœåŠ¡å™¨\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](60.png)\n\n4. æˆ‘ä»¬å°† 6381 é‡æ–°è®¾ç½®æˆä»æœåŠ¡å™¨ï¼Œå¹¶åˆ†åˆ«æŸ¥çœ‹ä»–å’Œä¸»æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ä»–å·²ç»å˜æˆäº†ä»æœåŠ¡å™¨ï¼Œè€Œä¸”ä¸»æœåŠ¡å™¨çš„ä¿¡æ¯ä¸­æ˜¾ç¤ºæœ‰ä¸¤å°ä»æœåŠ¡å™¨ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](61.png)\n\n5. æŸ¥çœ‹ä»æœåŠ¡å™¨ä¸­çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°å’Œä¸»æœåŠ¡å™¨æ˜¯ä¸€æ ·çš„\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](63.png)\n\n## 6ã€è–ªç«ç›¸ä¼ \n\n**è–ªç«ç›¸ä¼ ** æˆ‘ä»¬å¯ä»¥ç†è§£ä¸º **ç»„ç»‡æ¶æ„æ ‘** æˆ–è€…æˆ‘ä»¬å®é™…å·¥ä½œä¸­**é¡¹ç›®ç»ç†ã€ç»„é•¿ã€ç»„å‘˜**è¿™ç§ç»“æ„ã€‚\n\nå°±æ˜¯è¯´ï¼š\n\n- 6379 ä¸ºä¸»æœåŠ¡å™¨\n- 6380 æ˜¯ 6379 çš„ä»æœåŠ¡å™¨\n- 6381 æ˜¯ 6380 çš„æœåŠ¡å™¨\n\nè¿™æ ·ï¼Œ6379 æ•°æ®ä¼šåŒæ­¥ç»™ 6380 ï¼Œ6380 å†åŒæ­¥ç»™ 6381ã€‚\n\n**ç¼ºç‚¹ï¼š**\n\nå½“ 6380 æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆ 6379 çš„æ•°æ®ä¹Ÿæ— æ³•åŒæ­¥ç»™ 6381äº†ã€‚\n\nè¿™é‡Œå¯ä»¥è‡ªå·±è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘è¿™é‡Œå°±ä¸å®é™…è¿›è¡Œæ“ä½œäº†ã€‚\n\n## 7ã€åå®¢ä¸ºä¸»\n\nå…¶å®è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ **slaveof no one** å‘½ä»¤ï¼Œå¯å·²å°†ä»æœºå˜ä¸ºä¸»æœºã€‚\n\n**ç¼ºç‚¹ï¼š** éœ€è¦æ‰‹åŠ¨å®Œæˆã€‚\n\n## 8ã€å“¨å…µæ¨¡å¼\n\n### 1ï¼‰ä»€ä¹ˆæ˜¯å“¨å…µæ¨¡å¼\n\n<font color=\"red\">åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆ</font>ï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†ï¼Œæ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“ã€‚\n\nå…¶å®å°±åƒæ˜¯ **zookeeper** é›†ç¾¤çš„é€‰ä¸¾ã€‚<font color=\"#FFFFFF\">å†œå¥´ç¿»èº«æŠŠæ­Œå”±ï¼Œå™¢è€¶ï¼</font>\n\n### 2ï¼‰å¦‚ä½•ä½¿ç”¨\n\n1. è®¾ç½®ä¸ºä¸€ä¸»äºŒä»†/å¤šä»†æ¨¡å¼\n\n2. åˆ›å»º **sentinel.conf** æ–‡ä»¶ï¼Œç›®å½•è‡ªå®šä¹‰ï¼Œæˆ‘ä»¬è¿™é‡Œå°±æ”¾åœ¨å’Œ **redis6379.conf** åŒçº§çš„ç›®å½•ä¸‹äº†\n\n3. é…ç½®å“¨å…µï¼Œç¼–å†™ **sentinel.conf** é…ç½®æ–‡ä»¶å†…å®¹\n\n   ```shell\n   # sentinel å“¨å…µ\n   # monitor ç›‘æ§\n   # mymaster ä¸ºç›‘æ§å¯¹è±¡èµ·çš„æœåŠ¡å™¨åç§°ï¼Œå…¶å®å°±æ˜¯ä¸º master ä¸»æœºèµ·ä¸ªåˆ«å\n   # 192.168.111.144 6379 ä¸»æœº ip å’Œç«¯å£\n   # 1 è‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡ï¼Œé€šä¿—çš„è¯´å°±æ˜¯ï¼šéœ€è¦æœ‰å¤šå°‘ä¸ªä»æœºåŒæ„æ‰èƒ½åˆ‡æ¢ä¸ºä¸»æœºï¼Œè¿™é‡Œä¸ªäººå»ºè®®è®¾ç½®ä¸ºä»æœºæ•°é‡çš„ä¸€åŠä»¥ä¸Šã€‚ç±»ä¼¼äº zookeeper çš„é€‰ä¸¾\n   sentinel monitor mymaster 192.168.111.144 6379 1\n   ```\n\n4. å¯åŠ¨å“¨å…µï¼Œä½¿ç”¨ **redis-sentinel** å¯åŠ¨\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](64.png)\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](65.png)\n\n   æ³¨æ„ï¼Œå“¨å…µæœåŠ¡çš„é»˜è®¤ç«¯å£ä¸ºï¼š26379\n\n5. æµ‹è¯•ï¼Œå…³æ‰ 6379ï¼ŒæŸ¥çœ‹å“¨å…µçª—å£å˜åŒ–\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](66.png)\n\n   è¿™é‡Œé€šè¿‡æ§åˆ¶å°ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ° 6381 è¢«é€‰ä¸ºäº†ä¸»æœåŠ¡å™¨ï¼Œ6380 å˜æˆäº† 6381 çš„ä»æœºã€‚\n\n   è¿˜æœ‰ä¸€ä¸ªä¿¡æ¯å°±æ˜¯ï¼Œ6379 è¿˜åœ¨ã€‚é‚£ä¹ˆå½“ 6379 é‡æ–°å¯åŠ¨åä¼šå˜æˆä»€ä¹ˆæ ·å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å°† 6379 é‡å¯ï¼Œå¹¶æŸ¥çœ‹ä¿¡æ¯ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](67.png)\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](68.png)\n\n   é€šè¿‡ä¸Šé¢çš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ6379 å˜æˆäº† 6381 çš„ä»æœºã€‚\n\n6. å¤åˆ¶å»¶æ—¶\n\n   å“¨å…µæ¨¡å¼çš„ç¼ºç‚¹ï¼Œç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯åœ¨ **Master** ä¸Šè¿›è¡Œçš„ï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ° **Slave** ä¸Šï¼Œæ‰€ä»¥ä» **Master** åŒæ­¥åˆ° **Slave** ä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼Œ**Slave** æœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚\n\n### 3ï¼‰æ•…éšœæ¢å¤\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](69.png)\n\n- ä¼˜å…ˆçº§åœ¨ **redis.conf** ä¸­é»˜è®¤ï¼š**replica-priority 100** ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜\n\n  ![å›¾ç‰‡åŠ è½½å¤±è´¥](70.png)\n\n- åç§»é‡æ˜¯æŒ‡è·å¾—åŸä¸»æœºæ•°æ®æœ€å…¨çš„\n\n- æ¯ä¸ª **Redis** å®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª 40 ä½çš„ **runid**ã€‚\n\n### 4ï¼‰springboot ä¸»ä»å¤åˆ¶\n\nåªéœ€è¦åœ¨ **yml** é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç›¸åº”é…ç½®å³å¯ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](71.png)\n\næœåŠ¡å¯åŠ¨å‡ºç°äº†æŠ¥é”™ï¼š\n\n```java\n// å“¨å…µå“¨å…µå‘½ä»¤è¿”å›å°‘äº2ä¸ªèŠ‚ç‚¹!åœ¨Redisé…ç½®ä¸­è‡³å°‘åº”è¯¥å®šä¹‰ä¸¤ä¸ªå“¨å…µã€‚è®¾ç½®checkSentinelsList = falseä»¥é¿å…æ­¤æ£€æŸ¥ã€‚\nSENTINEL SENTINELS command returns less than 2 nodes! At least two sentinels should be defined in Redis configuration. Set checkSentinelsList = false to avoid this check.\n```\n\nç»è¿‡ä¸€ç•ªæœç´¢å¹¶æ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘åˆå¢åŠ äº†ä¸¤ä¸ªå“¨å…µ@~@\n\n1. ä¿®æ”¹åŸæœ‰çš„ **sentinel.conf** é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡å‘½åä¸º **sentinel6379.conf**\n\n   ```shell\n   sentinel monitor mymaster 192.168.111.144 6379 1\n   protected-mode no\n   port 26379\n   ```\n\n2. æ–°å¢ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š**sentinel6380.conf**ï¼Œ**sentinel6381.conf**ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹ **port** ï¼Œåˆ†åˆ«æ˜¯ï¼š26380ï¼Œ26381\n\nå¯åŠ¨æœåŠ¡/æµ‹è¯•ç±»æµ‹è¯•ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](72.png)\n\næ‰§è¡Œåå¯ä»¥åˆ° **Redis** ä¸­çœ‹ä¸€ä¸‹æ•°æ®æ˜¯ä¸æ˜¯å·²ç»å­˜è¿›å»äº†ã€‚\n\nå‚è€ƒï¼š[springboot+redisçš„sentinelå®ç°å“¨å…µæ¨¡å¼(è¶…è¯¦ç»†)](https://zhuanlan.zhihu.com/p/152462924)\n\n# åä¸‰ã€Redis é›†ç¾¤\n\n## 1ã€é—®é¢˜\n\n1. å®¹é‡ä¸å¤Ÿï¼Œ**redis** å¦‚ä½•è¿›è¡Œæ‰©å®¹ï¼Ÿ\n2. å¹¶å‘å†™æ“ä½œï¼Œ**redis** å¦‚ä½•åˆ†æ‘Šï¼Ÿ\n\nå¦å¤–ï¼Œä¸»ä»æ¨¡å¼ï¼Œè–ªç«ç›¸ä¼ æ¨¡å¼ï¼Œä¸»æœºå®•æœºï¼Œå¯¼è‡´ **ip** åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œåº”ç”¨ç¨‹åºä¸­é…ç½®éœ€è¦ä¿®æ”¹å¯¹åº”çš„ä¸»æœºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ã€‚\n\nä¹‹å‰é€šè¿‡ä»£ç†ä¸»æœºæ¥è§£å†³ï¼Œä½†æ˜¯ **redis3.0** ä¸­æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚å°±æ˜¯ <font color=\"red\">æ— ä¸­å¿ƒåŒ–é›†ç¾¤</font> é…ç½®ã€‚\n\n## 2ã€ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ\n\n- **Redis** é›†ç¾¤å®ç°äº†å¯¹ **Redis** çš„æ°´å¹³æ‰©å®¹ï¼Œå³å¯åŠ¨ **N** ä¸ª **Redis** èŠ‚ç‚¹ï¼Œå°†è¿™ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™ **N** ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„ **1/N**ã€‚\n- **Redis** é›†ç¾¤é€šè¿‡åˆ†åŒº**ï¼ˆpartitionï¼‰**æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§**ï¼ˆavailabilityï¼‰**ï¼šå³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œé›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚\n\n## 3ã€Redis é›†ç¾¤çš„æ­å»º\n\nè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯åœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­ä»¥ä¸åŒçš„ç«¯å£çš„æ–¹å¼æ¥æ¨¡æ‹Ÿæ­å»ºï¼Œä¾æ—§æ˜¯ **ä¸»ä»å¤åˆ¶** ä¸­ç”¨åˆ°çš„ç›®å½•å°±å¯ä»¥ã€‚\n\nåˆ›å»ºå…­ä¸ªå®ä¾‹åˆ†åˆ«æ˜¯ï¼š**6379ã€6380ã€6381ã€6389ã€6390ã€6391**ï¼ˆä¸‰ä¸»ä¸‰ä»ï¼‰ã€‚\n\n1. åˆ é™¤æ‰ä¹‹å‰æµ‹è¯•äº§ç”Ÿçš„ **dumpã€aof** æ–‡ä»¶ã€‚\n\n2. æˆ‘ä»¬åœ¨ **redis_6379.conf** çš„åŸºç¡€ä¸Šé…ç½®åŸºæœ¬ä¿¡æ¯\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](73.png)\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](74.png)\n\n3. åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ é›†ç¾¤ç›¸å…³é…ç½®\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](75.png)\n\n   ```shell\n   include /usr/local/myredis/redis.conf\n   pidfile \"/var/run/redis_6379.pid\"\n   port 6379\n   dbfilename \"dump6379.rdb\"\n   logfile \"/usr/local/myredis/redis_err_6379.log\"\n   daemonize yes\n   dir \"/usr/local/myredis\"\n   # å¼€å¯é›†ç¾¤\n   cluster-enabled yes\n   # æŒ‡å®šé›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶\n   cluster-config-file nodes_6379.conf\n   # è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶åé›†ç¾¤è‡ªåŠ¨è¿›å…¥ä¸»ä»åˆ‡æ¢\n   cluster-node-timeout 15000\n   ```\n\n4. åˆ é™¤6380 6381 ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¹¶å°†æˆ‘ä»¬åˆšæ‰ä¿®æ”¹å¥½çš„é…ç½®æ–‡ä»¶åœ¨å¤åˆ¶å‡º5ä»½ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](76.png)\n\n5. ä¿®æ”¹å¤åˆ¶å‡ºæ¥çš„é‚£å‡ ä»½æ–‡ä»¶ï¼Œä¿®æ”¹ç›¸åº”çš„ç«¯å£\n\n   ```shell\n   # å¯ä»¥ä½¿ç”¨æ›¿æ¢è¿›è¡Œæ“ä½œ\n   vim redis6380.conf\n   :%s/6379/6380\n   ```\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](77.png)\n\n6. å¯åŠ¨ 6 ä¸ª **Redis** æœåŠ¡ï¼Œå¹¶æŸ¥çœ‹èŠ‚ç‚¹é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ç”Ÿæˆäº†\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](78.png)\n\n7. å°† 6 ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤\n\n   - è¿›å…¥åˆ° **Redis** å®‰è£…ç›®å½•çš„ **src** ä¸­ï¼Œæˆ–è€…æ˜¯è§£å‹çš„ç›®å½•ä¸­çš„ **src** ä¸­ã€‚\n\n   - ä½¿ç”¨å‘½ä»¤è¿›è¡Œåˆä½“\n\n     ```shell\n     # æ³¨æ„ä¸‹é¢çš„å‘½ä»¤åªèƒ½åœ¨å®‰è£…ç›®å½•çš„ src ä¸‹æ‰å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨ ipï¼Œä¸è¦ä½¿ç”¨ 127.0.0.1\n     # --cluster create é›†ç¾¤åˆ›å»º\n     # --cluster-replicas 1 é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ï¼Œä¸€ä¸»ä¸€ä»ï¼Œæ­£å¥½ä¸‰ç»„ã€‚å‰ 3 ä¸ºä¸»æœºï¼Œå 3 ä¸ºä»æœº\n     redis-cli --cluster create --cluster-replicas 1 192.168.111.144:6379 192.168.111.144:6380 192.168.111.144:6381 192.168.111.144:6389 192.168.111.144:6390 192.168.111.144:6391\n     ```\n\n   - æ‰§è¡Œå‘½ä»¤\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](79.png)\n\n     æ‰§è¡Œå‘½ä»¤åä¼šå±•ç¤ºåˆ†é…çš„ä¸€äº›ä¿¡æ¯ï¼Œå¹¶ä¼šè¯¢é—®æˆ‘ä»¬æ˜¯å¦æ¥å—è¿™ç§åˆ†é…æ–¹å¼ï¼Œæˆ‘ä»¬è¾“å…¥ **yes**\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](80.png)\n\n8. è¿æ¥\n\n   ~~~shell\n   # -c é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥ï¼Œè®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº\n   # è¿æ¥ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥ï¼Œä¾‹å¦‚6379/6380/6381ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å†™ä¸»æœº\n   redis-cli -c -p 6379\n   ~~~\n\n9. æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ï¼š**cluster nodes**\n\n   æˆ‘ä»¬å¯ä»¥åœ¨ä¿¡æ¯ä¸­çœ‹åˆ°å“ªä¸€å°æ˜¯ä¸»æœºï¼Œå“ªä¸€å°æ˜¯ä»æœºï¼Œå’Œå¯¹åº”çš„ä¸»ä»ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](81.png)\n\n## 4ã€Redis cluster å¦‚ä½•åˆ†é…è¿™å…­ä¸ªèŠ‚ç‚¹ï¼Ÿ\n\n- ä¸€ä¸ªé›†ç¾¤è‡³å°‘è¦æœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹\n- é€‰é¡¹ **--cluster-replicas 1** è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹ã€‚\n- åˆ†é…åŸåˆ™å°½é‡ä¿è¯æ¯ä¸ªä¸»æ•°æ®åº“è¿è¡Œåœ¨ä¸åŒçš„ **IP** åœ°å€ï¼Œæ¯ä¸ªä»åº“å’Œä¸»åº“ä¸åœ¨ä¸€ä¸ª **IP** åœ°å€ä¸Šã€‚\n\n## 5ã€ä»€ä¹ˆæ˜¯ slots(æ’æ§½)?\n\né€šä¿—çš„æ¥è¯´å°±åƒæ˜¯ æ´ ï¼Œæ¯ä¸ªæ´éƒ½å¯ä»¥æ”¾å…¥ä¸œè¥¿ã€‚\n\n- ä¸€ä¸ª **Redis** é›†ç¾¤åŒ…å« 16384 ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œæ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®éƒ½å±äºè¿™ 16384 ä¸ªæ’æ§½ä¸­çš„å…¶ä¸­ä¸€ä¸ªã€‚\n\n- æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½æœ‰ä»–è´Ÿè´£çš„ä¸€å®šèŒƒå›´çš„æ’æ§½ï¼Œå¯ä»¥å†èŠ‚ç‚¹ä¿¡æ¯ä¸­çœ‹åˆ°ã€‚\n\n  ![å›¾ç‰‡åŠ è½½å¤±è´¥](82.png)\n\n- é›†ç¾¤ä¼šä½¿ç”¨ **CRC16(key)%16384** æ¥è®¡ç®— **key** å±äºå“ªä¸ªæ’æ§½ï¼Œå…¶ä¸­çš„ **CRC16(key)** è¯­å¥ç”¨äºè®¡ç®—é”® **key** çš„ **CRC16** æ ¡éªŒå’Œã€‚\n\n## 6ã€é›†ç¾¤æ•°æ®çš„æ–°å¢ä¸æŸ¥è¯¢\n\n1. æ–°å¢ï¼ˆå•ä¸ªkey/valueã€å¤šä¸ªkey/valueï¼‰\n\n   - ä¸‹å›¾å¯è§ï¼Œæ ¹æ®keyè®¡ç®—é™¤äº†æ’æ§½ï¼Œå¹¶å­˜å‚¨åˆ°äº†ç›¸åº”çš„ä¸»æœºä¸­ï¼Œå¹¶åˆ‡æ¢åˆ°äº†ç›¸åº”çš„ä¸»æœº\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](83.png)\n\n   - å¤šä¸ª key/value æ–°å¢\n\n     ```shell\n     # é”™è¯¯æ–¹å¼,å¤šä¸ª key ä¸èƒ½åŒæ—¶æ’å…¥ä¸€ä¸ªæ’æ§½\n     mset name lucy age 20 addr china\n     #err:CROSSSLOT Keys in request don't hash to the same slot\n     \n     #æ­£ç¡®æ–¹å¼ï¼Œä½¿ç”¨ {ç»„å} çš„æ–¹å¼æ–°å¢æ•°æ®\n     #è¿™æ ·å°±ä¼šæ ¹æ®{}ä¸­çš„ç»„åå»è®¡ç®—æ’æ§½\n     mset name{user} lucy age{user} 20 addr{user} china\n     ```\n\n2. æŸ¥è¯¢é›†ç¾¤ä¸­çš„å€¼\n\n   ```shell\n   # è·å– key åœ¨é›†ç¾¤ä¸­çš„æ’æ§½ä½ç½®ï¼šcluster keyslot key\n   cluster keyslot k1\n   result: 12706\n   \n   # è·å–æ’æ§½ä½ç½®ä¸­æœ‰å‡ ä¸ªå€¼ï¼Œåªèƒ½æ’æ§½æ‰€åœ¨çš„ä¸»æœºä¸­ç”¨ï¼Œå¦åˆ™è¿”å› 0\n   cluster countkeysinslot 12706\n   \n   # è·å–æŒ‡å®šæ’æ§½ä¸­countä¸ª keyï¼Œcluster get keysinslot slot count\n   # è·å– 12706 è¿™ä¸ªæ’æ§½ä¸­çš„ keyï¼Œè·å– 10 ä¸ª\n   cluster getkeysinslot 12706 10\n   ```\n\n## 7ã€æ•…éšœæ¢å¤\n\n1. å¦‚æœä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œä»èŠ‚ç‚¹èƒ½å¦è‡ªåŠ¨æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Ÿæ³¨æ„ï¼š<font color=\"red\">15 ç§’è¶…æ—¶</font>\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](84.png)\n\n   ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œ6379 ä¸‹çº¿ä¹‹åï¼Œ6380 åœ¨ 15 ç§’ä¹‹åæå‡ä¸ºä¸»èŠ‚ç‚¹äº†ã€‚\n\n2. ä¸‹çº¿çš„ä¸»èŠ‚ç‚¹æ¢å¤ä¹‹åï¼Œä¸»ä»å…³ç³»å¦‚ä½•ï¼Ÿ\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](85.png)\n\n   ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œä¸‹çº¿çš„ä¸»èŠ‚ç‚¹æ¢å¤åå˜æˆäº†ä»æœºã€‚\n\n3. å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰äº†ï¼ˆé›†ç¾¤ä¸­çš„æŸä¸€ç»„ä¸»ä»æŒ‚æ‰ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†ç¾¤æ˜¯å¦è¿˜èƒ½ç»§ç»­ä½¿ç”¨ï¼Ÿ\n\n   æ ¹æ® **redis.conf** ä¸­ **cluster-require-full-coverage** é…ç½®è€Œå˜åŒ–çš„ï¼š\n\n   - å¦‚æœ **cluster-require-full-coverage** ä¸º **yes** ï¼Œé‚£ä¹ˆï¼Œæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æ‰ã€‚\n   - å¦‚æœ **cluster-require-full-coverage** ä¸º **no** ï¼Œé‚£ä¹ˆå°±åªæœ‰è¯¥ä¸»ä»ä¸èƒ½ç”¨ï¼Œä¹Ÿæ— æ³•å­˜å‚¨ã€‚\n\n## 8ã€springboot é›†ç¾¤çš„é…ç½®\n\n1. ä¿®æ”¹ **yml** é…ç½®æ–‡ä»¶\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](86.png)\n\n2. æµ‹è¯•ç±»æµ‹è¯•\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](87.png)\n\nè¿™æ ·ç®€å•çš„é…ç½®å°±å¥½äº†ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰æŠ¥é”™ä¸€åˆ‡é¡ºåˆ©ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ²¡ç”¨è¿‡ï¼Œæ‰€ä»¥è¿™äº›åº”è¯¥æ˜¯å¾ˆåŸºç¡€çš„é…ç½®ã€‚\n\n## 9ã€Redis é›†ç¾¤çš„å¥½å¤„ä¸ä¸è¶³\n\n1. å¥½å¤„ï¼š\n   - å®ç°æ‰©å®¹\n   - åˆ†æ‘Šå‹åŠ›\n   - æ— ä¸­å¿ƒé…ç½®ï¼Œç›¸å¯¹ç®€å•\n2. ä¸è¶³\n   - å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„\n   - å¤šé”®çš„ **Redis** äº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚**lua** è„šæœ¬ä¸è¢«æ”¯æŒã€‚\n   - ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°çš„è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦ **è¿ç§»** è‡³ **redis cluster**ï¼Œéœ€è¦æ•´ä½“è¿ç§»ï¼Œè€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚éš¾åº¦å¤§\n\n# åå››ã€Redis åº”ç”¨é—®é¢˜è§£å†³\n\n## 1ã€ç¼“å­˜ç©¿é€\n\n1. ä»€ä¹ˆæ˜¯ **ç¼“å­˜ç©¿é€**\n\n   **ç¼“å­˜ç©¿é€ï¼š** å°±æ˜¯å¤§é‡çš„è¯·æ±‚ <font color=\"red\">è®¿é—®ç¼“å­˜ï¼Œè·å–ä¸å­˜åœ¨çš„æ•°æ®</font>ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»è¯·æ±‚æ•°æ®åº“ï¼ˆ<font color=\"red\">æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨</font>ï¼‰ï¼Œå¯¼è‡´æ•°æ®åº“ç˜«ç—ªæˆ–é”™è¯¯ã€å®•æ‰ç­‰ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](88.png)\n\n2. å‡ºç°åœºæ™¯\n\n   ä¸€èˆ¬å‡ºç°åœ¨ä¸€ä¸‹ä¸¤ç§åœºæ™¯ä¸­ï¼š\n\n   - **redis** ä¸­æŸ¥è¯¢ä¸åˆ°æ•°æ®\n   - å‡ºç°å¾ˆå¤šéæ­£å¸¸ **url** è®¿é—®\n\n3. è§£å†³æ–¹æ¡ˆ\n\n   - <font color=\"red\">å¯¹ç©ºå€¼ç¼“å­˜</font>\n\n     å¦‚æœæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ•°æ®æ˜¯ä¸æ˜¯å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœï¼ˆnullï¼‰è¿›è¡Œç¼“å­˜ï¼Œè®¾ç½®ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸ä¼šè¶…è¿‡äº”åˆ†é’Ÿã€‚\n\n   - <font color=\"red\">è®¾ç½®å¯ä»¥è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰</font>\n\n     ä½¿ç”¨ **bitmaps** ç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå• **id** ä½œä¸º **bitmaps** çš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œ **bitmaps** é‡Œé¢çš„ **id** è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè®¿é—®çš„ **id** ä¸åœ¨ **bitmaps** ä¸­ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚\n\n   - <font color=\"red\">é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨</font>\n\n     è¿™ä¸ªåº•å±‚å…¶å®å°±æ˜¯ä¸€ä¸ª **bitmaps** ï¼Œåªä¸è¿‡åšäº†ç›¸åº”çš„å°è£…ç­‰ã€‚\n\n     å…¶å®å°±æ˜¯æ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚\n\n     ä¼˜ç‚¹ï¼šç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¶…ä¸€èˆ¬çš„ç®—æ³•\n\n     ç¼ºç‚¹ï¼šæœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾\n\n   - <font color=\"red\">è¿›è¡Œå®æ—¶ç›‘æ§</font>\n\n     å½“å‘ç° **Redis** çš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ç½®é»‘åå•é™åˆ¶æœåŠ¡ã€‚\n\n## 2ã€ç¼“å­˜å‡»ç©¿\n\n1. ä»€ä¹ˆæ˜¯ **ç¼“å­˜å‡»ç©¿**\n\n   **ç¼“å­˜å‡»ç©¿ï¼š** key å¯¹åº”çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œä½†æ˜¯åœ¨ **redis** ä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯ **DB** åŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯ **DB** å‹å®\n\n   <font color=\"red\">æ³¨æ„ï¼šè¿™é‡ŒæŒ‡çš„æ˜¯æŸä¸ª **key** è¿‡æœŸäº†ï¼Œå¤§é‡è®¿é—®ä½¿ç”¨è¿™ä¸ª **key**ã€‚å¹¶ä¸æ˜¯å‡ºç°å¤§é‡çš„ **key** è¿‡æœŸ</font>\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](89.png)\n\n2. è§£å†³æ–¹æ¡ˆ\n\n   - <font color=\"red\">é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®</font>\n\n     åœ¨ **redis** é«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ° **Redis** ä¸­ï¼Œå¹¶åŠ å¤§è¿™äº›çƒ­é—¨æ•°æ® **key** çš„æ—¶é•¿\n\n   - <font color=\"red\">å®æ—¶è°ƒæ•´</font>\n\n     ç°åœºç›‘æ§é‚£äº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´ **key** çš„è¿‡æœŸæ—¶é•¿ \n\n   - <font color=\"red\">ä½¿ç”¨é”</font>\n\n     ![å›¾ç‰‡åŠ è½½å¤±è´¥](90.png)\n\n## 3ã€ç¼“å­˜é›ªå´©\n\n1. ä»€ä¹ˆæ˜¯ **ç¼“å­˜é›ªå´©**\n\n   **ç¼“å­˜é›ªå´©ï¼š** åœ¨æå°‘æ—¶é—´æ®µå†…ï¼ŒæŸ¥è¯¢å¤§é‡ **key** çš„é›†ä¸­è¿‡æœŸæƒ…å†µã€‚\n\n2. è§£å†³æ–¹æ¡ˆ\n\n   - <font color=\"red\">æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„</font>\n\n     **nginx** ç¼“å­˜ + **Redis** ç¼“å­˜  + å…¶ä»–ç¼“å­˜ï¼ˆ**ehcache** ç­‰ï¼‰\n\n   - <font color=\"red\">ä½¿ç”¨é”æˆ–é˜Ÿåˆ—</font>\n\n     ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚åˆé«˜å¹¶å‘æƒ…å†µã€‚\n\n   - <font color=\"red\">è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜</font>\n\n     è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™… **key** çš„ç¼“å­˜\n\n   - <font color=\"red\">å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€</font>\n\n     æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å†åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚ 1-5 åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚\n\n## 4ã€åˆ†å¸ƒå¼é”\n\n###  1ï¼‰ä»€ä¹ˆæ˜¯ **åˆ†å¸ƒå¼é”**\n\nä¸ªäººç†è§£ **åˆ†å¸ƒå¼é”** å°±æ˜¯åº”ç”¨åœ¨é›†ç¾¤ã€åˆ†å¸ƒå¼æœåŠ¡ä¸­ã€‚å› ä¸ºåŸå•ä½“å•æœºéƒ¨ç½²çš„ç³»ç»Ÿæ¼”åŒ–æˆåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ä¸”åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™æ ·åŸæ¥çš„å•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘é”ç­–ç•¥å°±å¤±æ•ˆäº†ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ç§è·¨ **JVM** çš„äº’æ–¥æœºåˆ¶ï¼ˆé”ï¼‰æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®\n\n### 2ï¼‰å®ç°æ–¹å¼\n\n- åŸºäºæ•°æ®åº“å®ç°\n\n- åŸºäºç¼“å­˜ï¼ˆ**Redis** ç­‰ï¼‰\n\n  æ€§èƒ½å¥½\n\n- åŸºäº **zookeeper**\n\n  å¯é æ€§é«˜\n\n### 3ï¼‰ä½¿ç”¨ rediså®ç°åˆ†å¸ƒå¼é”\n\nå…¶å®å°±æ˜¯ **setnx key value** æ¥è®¾ç½®ä¸€ä¸ª **key** ä½œä¸ºé”ï¼Œé‡Šæ”¾é”å°±æ˜¯åˆ é™¤æ‰è¿™ä¸ª **key**ã€‚\n\n- é—®é¢˜ä¸€ï¼šå‡å¦‚ç°åœ¨å‡ºç°äº†åˆ«çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼šåŠ é”ä¹‹åç¨‹åºæŠ¥é”™æˆ–ç”±äºåˆ«çš„åŸå› æ²¡æœ‰é‡Šæ”¾è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\n  è§£å†³æ–¹å¼å°±æ˜¯è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´\n\n  ```shell\n  set key_lock 1\n  exprie key_lock 10\n  ```\n\n- é—®é¢˜äºŒï¼šå¦‚æœåœ¨è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ—¶å€™æœåŠ¡å™¨çªç„¶æ­»æ‰äº†æˆ–è€…ç”±äºä¸€äº›å…¶ä»–åŸå› è®¾ç½®å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ\n\n  è§£å†³æ–¹å¼å°±æ˜¯åŠ é”çš„åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´\n\n  ```shell\n  # è¿™ä¸ªå‘½ä»¤åœ¨ä¸Šé¢è¯´è¿‡ï¼Œä»–çš„æ„æ€å°±æ˜¯ï¼šæ–°å¢ä¸€ä¸ª key å¹¶è®¾ç½®ä»–çš„æ—¶é—´ï¼Œåªæœ‰åœ¨è¿™ä¸ª key ä¸å­˜åœ¨çš„æ—¶å€™æ‰èƒ½è®¾ç½®æˆåŠŸ\n  set kye_lock 1 EX 10 NX\n  ```\n\n- é—®é¢˜ä¸‰ï¼šè¯¯åˆ é—®é¢˜\n\n  è¿™ä¸ªå¯ä»¥é€šè¿‡æ·»åŠ  **UUID** ç­‰æ–¹å¼è§£å†³ï¼Œåœ¨ä¸Šé¢çš„ [ç§’å‘æ¡ˆä¾‹çš„è¶…å–é—®é¢˜ä¸­](https://sunyubk.github.io/2021/08/06/Redis%E5%AD%A6%E4%B9%A0/#3%EF%BC%89%E8%B6%85%E5%8D%96%E5%92%8C%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3) ä¸­å·²ç»è§£å†³è¿‡äº†ã€‚\n\n# æ¡ˆä¾‹\n\n## æ¡ˆä¾‹ä¸€ã€\n\nåœºæ™¯ï¼š\n\n1. ä¸€äº¿ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·æœ‰é¢‘ç¹ç™»å½•çš„ï¼Œä¹Ÿæœ‰ä¸ç»å¸¸ç™»å½•çš„\n2. å¦‚ä½•è®°å½•ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯\n3. å¦‚ä½•æŸ¥è¯¢æ´»è·ƒç”¨æˆ·ï¼Œ[å¦‚ï¼š è¿ç»­ç™»å½•çš„]\n\n```shell\n# ä»¥ä½å›¾çš„æ–¹å¼æ¥è§£å†³\n# ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ä»¥ 0/1æ¥è¡¨ç¤º\n# åˆå§‹å€¼ ä¸€äº¿ä¸ªç”¨æˆ·éƒ½æ²¡æœ‰ç™»é™†è¿‡ï¼Œè®¾ç½®ç¬¬3,5,7ä½ç”¨æˆ·åœ¨å‘¨ä¸€ç™»å½•è¿‡\nsetbit mon 100000000 0\nsetbit mon 3 1\nsetbit mon 5 1\nsetbit mon 7 1\n\n# è®¾ç½®ç¬¬3,4,8ä½ç”¨æˆ·åœ¨å‘¨äºŒç™»å½•è¿‡\nsetbit tue 100000000 0\nsetbit tue 3 1\nsetbit tue 4 1\nsetbit tue 8 1\n\n# è®¾ç½®ç¬¬3,6,9ä½ç”¨æˆ·åœ¨å‘¨ä¸‰ç™»å½•è¿‡\nsetbit wed 100000000 0\nsetbit wed 3 1\nsetbit wed 6 1\nsetbit wed 9 1\n\n# æŒ‰ä½ä¸è¿ç®—\n# res ä¸ºæ¯”è¾ƒåè¿”å›çš„ç»“æœé›†\n# ä¾‹å­ï¼š0100\n#      0101 \n#      0110\n# and è¿”å›ç»“æœé›†æ˜¯0100ï¼Œä½å›¾çš„åŒä¸€ä¸ªä½ç½®éƒ½ä¸€æ ·ï¼Œåˆ™è¿”å›çš„æ˜¯1ï¼Œå¦åˆ™è¿”å›0\n# or  è¿”å›ç»“æœé›†æ˜¯0111ï¼Œä½å›¾çš„åŒä¸€ä¸ªä½ç½®æœ‰ä¸€ä¸ªæ˜¯1ï¼Œåˆ™è¿”å›1\n# \n#ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤åˆ™å¯ä»¥å¾—åˆ°res,ä¸‰å¤©éƒ½ç™»å½•äº†çš„ç”¨æˆ·\nbitop and res mon tue wed\n```\n\n \n","tags":["Redis"],"categories":["æŠ€æœ¯å­¦ä¹ ","Redis"]},{"title":"SpringCloud å­¦ä¹ ","url":"/2020/09/07/SpringCloud-å­¦ä¹ /","content":"\n# 1.ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„\n\nã€€ã€€å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼æˆ–è€…æ¶æ„é£æ ¼ï¼Œ<font color=\"red\">å®ƒæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ†æˆä¸€ç»„å°çš„æœåŠ¡</font>ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¹‹é—´äº’ç›¸åè°ƒï¼Œé…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚\n\n<!-- more -->\n\n# 2.ä»€ä¹ˆæ˜¯SpringCloud\n\nã€€ã€€**SpringCloud** å°±æ˜¯åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ä¸‹çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œæ˜¯å„ä¸ªå¾®æœåŠ¡æ¶æ„è½åœ°æŠ€æœ¯çš„é›†åˆä½“ï¼Œä¿—ç§°ä¸ºæœåŠ¡å…¨å®¶æ¡¶\n\n# 3.SpringCloud å’Œ SpringBoot æ˜¯ä»€ä¹ˆå…³ç³»\n\n1. **SpringBootï¼š**ä¸“æ³¨äºå¿«é€Ÿæ–¹ä¾¿çš„å¼€å‘å•ä¸ªä¸ªä½“å¾®æœåŠ¡\n\n   **SpringCloudï¼š**æ˜¯å…³æ³¨å…¨å±€çš„å¾®æœåŠ¡åè°ƒæ•´ç†æ²»ç†æ¡†æ¶ï¼Œå®ƒå°† **SpringBoot** å¼€å‘çš„ä¸€ä¸ªä¸ªå•ä½“å¾®æœåŠ¡æ•´åˆå¹¶ç®¡ç†èµ·æ¥ï¼Œä¸ºå„ä¸ªå¾®æœåŠ¡ä¹‹é—´æä¾›ï¼Œç®¡ç†é…ç½®ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€è·¯ç”±ã€å¾®ä»£ç†ã€äº‹ä»¶æ€»çº¿ã€å…¨å±€é”ã€å†³ç­–ç«é€‰ã€åˆ†å¸ƒå¼ä¼šè¯ç­‰ç­‰é›†æˆæœåŠ¡\n\n2. **SpringBoot** å¯ä»¥ç¦»å¼€ **SpringCloud** ç‹¬ç«‹ä½¿ç”¨å¼€å‘é¡¹ç›®ï¼Œä½†æ˜¯ **SpringCloud** ç¦»ä¸å¼€ **SpringBoot**ï¼Œå±äºä¾èµ–å…³ç³»ã€‚\n\næ€»çš„æ¥è¯´ï¼Œ**SpringBoot** ä¸“æ³¨äºå¿«é€Ÿã€æ–¹ä¾¿çš„å¼€å‘å•ä¸ªå¾®æœåŠ¡ä¸ªä½“ï¼Œ**SpringCloud** å…³æ³¨å…¨å±€çš„æœåŠ¡æ²»ç†æ¡†æ¶\n\n# 4.SpringCloud å’Œ Dubbo æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n1. åœ¨é€šè®¯æœºåˆ¶æ–¹é¢ï¼š\n\n   **Dubbo** æ˜¯é€šè¿‡ **RPC** è¿œç¨‹è¿‡ç¨‹è°ƒç”¨\n\n   **SpringCloud** æ˜¯é€šè¿‡åŸºäº **HTTP** çš„ **RESTful api**\n\n2. åœ¨è‡ªèº«æŠ€æœ¯æ–¹é¢ï¼š\n\n   **Dubbo** å°±æ˜¯åƒç»„è£…æœºï¼Œä½¿ç”¨çš„åŸºæœ¬éƒ½æ˜¯ç¬¬ä¸‰æ–¹ã€‚é€‰æ‹©çš„è‡ªç”±åº¦å¾ˆé«˜ï¼Œä½†æ˜¯å‡ºé—®é¢˜çš„å¯èƒ½æ€§ä¹Ÿä¼šéšä¹‹æé«˜ã€‚\n\n   **SpringCloud** å°±åƒæ˜¯ä¹°çš„ä¸€ä½“æœºï¼Œä¸€æ•´å¥—éƒ½æ˜¯è‡ªå·±çš„ã€‚åœ¨ **Spring Source** çš„æ•´åˆä¸‹ï¼Œåšäº†å¤§é‡çš„ç¨³å®šæ€§æµ‹è¯•ï¼Œä½¿å…¶æ‹¥æœ‰æ›´é«˜çš„ç¨³å®šæ€§ã€‚\n\n   å…·ä½“è§è¡¨ï¼š\n\n   |              | Dubbo         | Spring Cloud                 |\n   | :----------- | :------------ | :--------------------------- |\n   | æœåŠ¡æ³¨å†Œä¸­å¿ƒ | Zookeeper     | Spring Cloud Netflix Eureka  |\n   | æœåŠ¡è°ƒç”¨æ–¹å¼ | RPC           | REST API                     |\n   | æœåŠ¡ç›‘æ§     | Duboo-monitor | Spring Boot Admin            |\n   | æ–­è·¯å™¨       | ä¸å®Œå–„        | Spring Cloud Netflix Hystrix |\n   | æœåŠ¡ç½‘å…³     | æ—             | Spring Cloud Netflix Zuul    |\n   | åˆ†å¸ƒå¼é…ç½®   | æ—             | Spring Cloud Config          |\n   | æœåŠ¡è·Ÿè¸ª     | æ—             | Spring Cloud Sleuth          |\n   | æ¶ˆæ¯æ€»çº¿     | æ—             | Spring Cloud Bus             |\n   | æ•°æ®æµ       | æ—             | Spring Cloud Stream          |\n   | æ‰¹é‡ä»»åŠ¡     | æ—             | Spring Cloud Task            |\n   | ......       | ......        | ......                       |\n\n\n**å¼€å‘å‚è€ƒæ–‡æ¡£åœ°å€ï¼š**\n\nã€€ã€€ä¸­æ–‡ç‰ˆAPIï¼š[https://www.springcloud.cc/spring-cloud-dalston.html](https://www.springcloud.cc/spring-cloud-dalston.html)\n\nã€€ã€€springcloudä¸­å›½ç¤¾åŒºï¼š[http://springcloud.cn/](http://springcloud.cn/)\n\nã€€ã€€springcloudä¸­æ–‡ç½‘ï¼š[https://www.springcloud.cc/](https://www.springcloud.cc/)\n\nè‡³æ­¤ï¼Œç†è®ºæ¦‚å¿µéƒ¨åˆ†å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä»£ç æ¡ˆä¾‹çš„ç¼–å†™äº†ã€‚\n\n# 5.ä»£ç æ¡ˆä¾‹\n\n## 1)Restå¾®æœåŠ¡æ¡ˆä¾‹-çˆ¶å·¥ç¨‹æ„å»º\n\né¦–å…ˆï¼Œåœ¨working set ä¸­æ–°å»ºä¸€ä¸ªmaven porjectã€‚\n\nArtifact Idï¼šçˆ¶å·¥ç¨‹çš„åå­—\n\nPackagingï¼špom\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](springcloud_1.png)\n\n## 2)pomæ–‡ä»¶ç¼–å†™\n\n```xml\n\n```\n\n\n\n# <font color=\"red\">*</font>æ¡†æ¶æ­å»ºè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é—®é¢˜ä¸è§£å†³æ–¹å¼\n\n## 1) å¯åŠ¨æŠ¥é”™\n\n1. <font color=\"red\"><strong>java.lang.ClassNotFoundException: org.springframework.boot.bind.RelaxedPropertyResolver </strong></font>\n\n    ã€€ã€€å…³äºè¿™ä¸ªæŠ¥é”™ä¿¡æ¯æˆ‘ä¹Ÿç™¾åº¦äº†å¥½ä¹…ï¼Œè¯´ä»€ä¹ˆçš„éƒ½æœ‰ï¼ŒåŸºæœ¬è¯´çš„éƒ½æ˜¯ä¾èµ–ç‰ˆæœ¬é—®é¢˜ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€é¡¿è°ƒæ•´é—®é¢˜ï¼Œåæ¥å°†å…‰æ ‡ç§»åŠ¨åˆ°äº†å¯åŠ¨ç±»çš„ **@SpringBootApplication** æ³¨è§£ä¸Šå‘ç° **spring-boot-autoconfigure** çš„ç‰ˆæœ¬ä¸º 1.5.Xã€‚å› ä¸ºæˆ‘çš„çˆ¶çº§ **pom** ä¸­å®šä¹‰äº† **springboot starter** çš„ç‰ˆæœ¬ä¸º **2.4.5** æ‰€ä»¥æ„è¯†åˆ°ä¸å¯¹äº†ã€‚åæ¥æ‰‹åŠ¨å¼•å…¥ **spring-boot-autoconfigure** è§£å†³è¿™ä¸ªé—®é¢˜\n\n   ```xml\n   <dependency>\n   \t<groupId>org.springframework.boot</groupId>\n       <artifactId>spring-boot-autoconfigure</artifactId>\n       <version>${springboot.stater.version}</version>\n   </dependency>\n   ```\n\n\n## 2ï¼‰æ‰«æä¸åˆ°mapperæ¥å£\n\n1. <font color=\"red\"><strong>org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)</strong></font>\n\n   è¿™ä¸ªæŠ¥é”™äº§ç”Ÿçš„åŸå› å¾ˆå¤šï¼Œåˆ—å‡ºæˆ‘çŸ¥é“çš„å‡ ç§\n\n   - mybatisPlusConfig é…ç½®æ–‡ä»¶ç±»ä¸Šæ˜¯å¦åŠ å…¥äº† @MapperScan(â€mapperè·¯å¾„â€œ) æ³¨è§£\n   - yml.xml é…ç½®æ–‡ä»¶ä¸­ çš„ mapper.xml æ–‡ä»¶æ‰«æè·¯å¾„é…ç½®æ˜¯å¦æ­£ç¡®\n   - mapper.xml æ–‡ä»¶å­˜æ”¾è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œspring boot é»˜è®¤æ˜¯ä¸ä¼šå°† java æ–‡ä»¶å¤¹ä¸‹çš„éjavaæ–‡ä»¶æ‰“åŒ…ã€‚æ‰€ä»¥å¦‚æœmapper.xmlæ–‡ä»¶åº”è¯¥æ”¾åœ¨ resource é™æ€èµ„æºè·¯å¾„ä¸‹ï¼Œå¦‚æœæ”¾åœ¨ javaæ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ™éœ€è¦åœ¨ pom ä¸­é…ç½® resources å°†xmlæ‰“åŒ…\n   - idea å¼€å‘å·¥å…·é¡¹ç›®æ–‡ä»¶è·¯å¾„é—®é¢˜ï¼Œideaæ˜¯ä¼šéšè—ç©ºæ–‡ä»¶å¤¹çš„ï¼Œä¾‹å¦‚æœ‰çš„æ—¶å€™æˆ‘ä»¬åœ¨resource ä¸‹åˆ›å»ºäº† mybatis.mapper ç”¨æ¥å­˜æ”¾ mapper.xml æ–‡ä»¶ã€‚è¿™ä¸ªæ—¶å€™çš„ mybatis.mapper æ–‡ä»¶å¤¹åœ¨ idea ä¸­ä½ å¯èƒ½è®¤ä¸ºä»–æ˜¯ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨ç³»ç»Ÿä¸­æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å¯èƒ½å¹¶ä¸æ˜¯åœ¨ mybatis æ–‡ä»¶ä¸­è¿˜æœ‰ä¸€ä¸ª mapper æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªå« mybatis.mapper çš„æ–‡ä»¶å¤¹ã€‚è¿™ä¸ªçœŸçš„è¦æ³¨æ„ã€‚\n\n   <font color=\"red\"><strong>*</strong></font>**æˆ‘è¿™é‡Œå°±æ˜¯çŠ¯äº†æœ€åä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘æ€ä¹ˆä¹Ÿæ²¡æƒ³åˆ° idea çš„è¿™ä¸ªé—®é¢˜ï¼Œä»–åˆ›å»ºå¤šçº§ç©ºç›®å½•ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘çŸ¥é“ï¼Œä½†æ˜¯å°±æ²¡æœ‰å¾€è¿™è¾¹æƒ³ï¼Œä¸ºæ­¤æˆ‘ä»˜å‡ºäº† <font color=\"red\" size=\"5\">5</font> ä¸ªå°æ—¶çš„ä»£ä»·ã€‚ç‰¹æ­¤è®°å½•ï¼Œå¼•ä»¥ä¸ºæˆ’**\n\n## 3ï¼‰swagger 3.0ç‰ˆæœ¬æ³¨æ„äº‹é¡¹\n\n1. æœ¬æ¥å°ç¼–ç”¨çš„æ˜¯ **swagger2** çš„ç‰ˆæœ¬ï¼Œç»“æœå› ä¸ºæ­å»ºé¡¹ç›®æ¡†æ¶ï¼Œæœ‰çš„ä¾èµ–æœ‰é—®é¢˜ï¼Œåˆ‡æ¢äº† **swagger** çš„ç‰ˆæœ¬ä¸ºï¼š3.0.0.ã€‚åˆ‡æ¢ä¹‹åæœåŠ¡å¯ä»¥æ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯è®¿é—®ä¸äº† **swagger** çš„é¡µé¢äº†ã€‚*(è®¿é—®åœ°å€ï¼šswagger-ui.html)* \n\n   **è§£å†³ï¼š**\n\n   1. swagger3.0 éœ€è¦åœ¨ pom ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š\n\n      ```xml\n      <dependency>\n      \t<groupId>io.springfox</groupId>\n          <artifactId>springfox-boot-starter</artifactId>\n          <version>3.0.0</version>\n      </dependency>\n      ```\n\n   2. éœ€è¦åœ¨å¯åŠ¨ç±»å¢åŠ  **@EnableOpenApi** æ³¨è§£\n\n   3. è®¿é—®åœ°å€å˜ä¸ºï¼šxxx/swagger-ui/index.html\n\n## 4ï¼‰Erueka æŠ¥é”™\n\n1. <font color=\"red\">å¯åŠ¨æŠ¥é”™ï¼šspring cloud erueka  com.google.gson.GsonBuilder:</font>\n\n   å‡çº§ gson çš„ç‰ˆæœ¬å³å¯\n\n2. è®¿é—®eureka ä¸­æœåŠ¡çš„info--ã€‹/actuator/info 404 é—®é¢˜\n\n   - ä¿®æ”¹çˆ¶å·¥ç¨‹pom\n\n     ```xml\n         <build>\n             <finalName>springCloud</finalName>\n             <resources>\n                 <resource>\n                     <directory>src/main/resources</directory>\n                     <filtering>true</filtering>\n                 </resource>\n             </resources>\n             <plugins>\n                 <plugin>\n                     <groupId>org.apache.maven.plugins</groupId>\n                     <artifactId>maven-resources-plugin</artifactId>\n                     <version>${maven.resources.version}</version>\n                     <configuration>\n                         <delimiters>\n                             <!--è¿™é‡Œä½¿ç”¨ä¸åŒ¹é…ymlä¸­çš„é…ç½®ï¼Œéœ€è¦æ³¨æ„æœ‰çš„ç‰ˆæœ¬è¿™é‡Œç”¨çš„æ˜¯<delimit>æ ‡ç­¾-->\n                             <delimiter>$</delimiter>\n                         </delimiters>\n                     </configuration>\n                 </plugin>\n             </plugins>\n         </build>\n     ```\n\n   - ä¿®æ”¹å­å·¥ç¨‹ymlé…ç½®æ–‡ä»¶\n\n     ```yaml\n     eureka:\n       # å®¢æˆ·ç«¯æ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…\n       client:\n         service-url:\n           # å¯¹åº”eurekaæœåŠ¡ç«¯çš„defaultZone\n           defaultZone: http://localhost:7001/eureka\n       # å®ä¾‹é…ç½®\n       instance:\n         # å®ä¾‹idï¼Œeureka ä¸­å®ä¾‹åç§°ï¼Œstatusæ˜¾ç¤ºçš„åç§°\n         instance-id: ProViderDept8001\n         # é…ç½®è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºipåœ°å€\n         prefer-ip-address: true\n     info:\n       app.name: springCloud\n       company.name: www.sy.com\n       build.artifactId: $project.artifactId$\n       build.version: $project.version$\n     \n     #æ­¤å¤„é…ç½®ç”¨äºå¼€å‘eureka çš„actuator/info ä¿¡æ¯ä½¿ç”¨\n     management:\n       endpoints:\n         web:\n           exposure:\n     #       å¼€æ”¾æ‰€æœ‰\n             include: \"*\"\n     ```\n\n     ","tags":["Spring Cloud å­¦ä¹ "],"categories":["æŠ€æœ¯å­¦ä¹ ","Spring Cloud å­¦ä¹ "]},{"title":"Ubuntuç ´è§£Jetbrainså·¥å…·","url":"/2020/08/04/Ubuntuç ´è§£Jetbrainså·¥å…·/","content":"\n\n\nç ´è§£åŒ…ä¸‹è½½ï¼š[jetbrains-agent-2020.1.2](jetbrains-agent-2020.1.2.zip)\n\n<font color=\"red\">æ³¨ï¼šæœ¬ç¯‡æ–‡ç« ä»¥åŠæä¾›çš„ç ´è§£åŒ…ç”¨äº idea2020.1.2ç‰ˆæœ¬ï¼ˆç»æœ¬äººæµ‹è¯•datagrip2020.1.4ä¹Ÿå¯ä»¥ï¼Œåº”è¯¥æ˜¯ä¸´è¿‘idea2020.1.2ç‰ˆæœ¬çš„å³å¯ï¼‰ã€‚</font>\n\n<!-- more -->\n\n## 1ï¼‰ä¸‹è½½å®‰è£…idea\n\nä¸‹è½½åœ°å€ï¼š[https://www.jetbrains.com/idea/download/other.html](https://www.jetbrains.com/idea/download/other.html)\n\né€‰æ‹©2020.1.2ç‰ˆæœ¬è¿›è¡Œä¸‹è½½\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](Jetbrains_1.png)\n\n## 2ï¼‰è¿›è¡Œå®‰è£…ç ´è§£åŒ…\n\n1. ä¸‹è½½ç ´è§£åŒ…å¹¶è§£å‹\n\n2. å®‰è£…å®Œæˆä¹‹åä»¥â€œ**è¯•ç”¨**â€è¿›å…¥ideaã€‚\n\n3. å°†ç ´è§£åŒ…å†…çš„æ–‡ä»¶æ‹‰å…¥ **idea** ä¸­ï¼ˆç›´æ¥æ‹‰å…¥ç ´è§£åŒ…çš„å‹ç¼©åŒ…ä¹Ÿè¡Œï¼Œæœ€å¥½æ˜¯æ‹‰å…¥ç ´è§£åŒ…å†…çš„æ–‡ä»¶:libå†…çš„jetbrains-agent.jarï¼‰\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](Jetbrains_2.png)\n\n4. idea ä¼šé‡æ–°å¯åŠ¨ï¼Œå¯åŠ¨åä¼šå¼¹å‡ºé…ç½®åŠ©æ‰‹ï¼Œæ¿€æ´»æ–¹å¼é€‰æ‹© code æˆ–è€… server éƒ½å¯ä»¥ï¼Œæœ¬äººç”¨çš„æ˜¯ serverã€‚é€‰æ‹©å¥½ä¹‹åç‚¹å‡» â€œä¸ºIDEAå®‰è£…â€ã€‚\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](Jetbrains_3.png)\n\n5. idea ä¼šæç¤ºå®‰è£…æˆåŠŸï¼Œé‡å¯åç”Ÿæ•ˆï¼Œç‚¹å‡» â€œ**æ˜¯**â€\n\n6. idea é‡å¯åï¼Œç‚¹å‡»help - about æŸ¥çœ‹æ˜¯å¦æˆåŠŸ\n\n   ![å›¾ç‰‡åŠ è½½å¤±è´¥](Jetbrains_4.png)\n\n---\n\nè‡³æ­¤ï¼Œç ´è§£å®Œæˆã€‚ï¼ˆç»æœ¬äººäº²è‡ªæµ‹è¯•è¿‡æ˜¯æˆåŠŸçš„ã€‚ï¼‰","tags":["å·¥å…·ç ´è§£"],"categories":["Linux","å·¥å…·ç ´è§£"]},{"title":"Ubuntuå®‰è£…Myslq5.7","url":"/2020/08/03/Ubuntuå®‰è£…Mysql5.7/","content":"\n\n\n## 1.ä¸‹è½½ Myslq5.7\n\nä¸‹è½½åœ°å€ï¼š[https://downloads.mysql.com/archives/community/](https://downloads.mysql.com/archives/community/)\n\n<!-- more -->\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](Mysql_install_1.png)\n\n## 2.ç§»åŠ¨å‹ç¼©åŒ…å¹¶è§£å‹\n\nå›¾ç‰‡ä¸­çš„ç›®å½•æ˜¯æœ¬äººåˆ›å»ºçš„ç”¨äºå®‰è£…å„ç§ç¯å¢ƒçš„ç›®å½•ï¼Œæ ¹æ®ä¸ªäººä¹ æƒ¯ä¸åŒç›®å½•å¯è‡ªè¡Œåˆ›å»ºã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](Mysql_install_2.png)\n\n## 3.é‡å‘½åè§£å‹åçš„æ–‡ä»¶å¤¹\n\nå°†è§£å‹åçš„æ–‡ä»¶å¤¹é‡å‘½åä¸º **mysql-5.7.30**\n\n```shell\nmv mysql-5.7.30-linux-glibc2.12-x86_64 mysql-5.7.30\n```\n\n## 4.æ·»åŠ ç”¨æˆ·ç»„\n\n```shell\ngroupadd mysql\n```\n\n## 5.æ·»åŠ ç”¨æˆ·\n\n```shell\nuseradd -r -g mysql mysql\n```\n\n## 6.æ›´æ–°ç³»ç»Ÿä¾èµ–ç¯å¢ƒ\n\n```shell\napt-get update\n```\n\n## 7.ä¸‹è½½libaioä¾èµ–\n\n```shell\napt-get install libaio*\n```\n\n## 8.ä¸‹è½½libncursesä¾èµ–\n\n```shell\napt-get install libncurses*\n#æ‰§è¡Œç©ä»¥ä¸Šå‘½ä»¤ä¼šé—®ä½ æ˜¯å¦ç»§ç»­æ‰§è¡Œã€‚è¾“å…¥ Y ç»§ç»­æ‰§è¡Œ\n```\n\n## 9.åˆ›å»ºdataç›®å½•\n\n```shell\ncd mysql-5.7.30\nmkdir data\n```\n\n## 10.å°†mysql-5.7.30çš„æ‰€æœ‰è€…ä»¥åŠæ‰€å±ç»„æ”¹ä¸ºmysql\n\n```\nchown -R mysql:mysql /usr/Environment/Mysql/mysql-5.7.30\n```\n\n## 11.åœ¨/usr/Environment/Mysql/mysql-5.7.30/support-filesç›®å½•ä¸‹åˆ›å»ºmy_default.cnf\n\n```shell\n[mysql]\ndefault-character-set=utf8\nsocket=/tmp/mysql.sock\n[mysqld]\nport=3306\nsocket=/tmp/mysql.sock\n#æ ¹æ®ä¸ªäººç›®å½•ä¸åŒbasedirã€datadiréœ€è¦é€‰æ‹©ä½ è‡ªå·±çš„ç›®å½•\nbasedir=/usr/Environment/Mysql/mysql-5.7.30\ndatadir=/usr/Environment/Mysql/mysql-5.7.30/data\nmax_connections=250\ncharacter-set-server=utf8\ndefault-storage-engine=INNODB\nmax_allowed_packet=16M\nlog-error=/usr/Environment/Mysql/mysql-5.7.30/data/mysqld.log\npid-file=/usr/Environment/Mysql/mysql-5.7.30/data/mysqld.pid\n```\n\n## 12.å°†my_default.cnfæ‹·è´è‡³/etc/mysqlä¸‹\n\n```shell\ncp my_default.cnf /etc/mysql/my.cnf\n```\n\n## 13.åˆå§‹åŒ–mysqld\n\n```shell\ncd /usr/Environment/Mysql/mysql-5.7.30\n./bin/mysqld --initialize --user=mysql --basedir=/usr/Environment/Mysql/mysql-5.7.30/ --datadir=/usr/Environment/Mysql/mysql-5.7.30/data/ \n```\n\n## 14.åˆå§‹åŒ–å®ŒæˆåæŸ¥çœ‹æ—¥å¿—ä¸­çš„ä¸´æ—¶å¯†ç \n\n```shell\ncd data/\ncat mysqld.log\n```\n\nä¸´æ—¶å¯†ç ä¸ºï¼ši>;+lyB5Ojon\n\n```shell\n2020-08-07T07:37:17.198965Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).\n2020-08-07T07:37:17.594529Z 0 [Warning] InnoDB: New log files created, LSN=45790\n2020-08-07T07:37:17.700675Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.\n2020-08-07T07:37:17.769067Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: d1ee4afd-d880-11ea-8942-a0c589328791.\n2020-08-07T07:37:17.772722Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.\n2020-08-07T07:37:19.446295Z 0 [Warning] CA certificate ca.pem is self signed.\n2020-08-07T07:37:19.783441Z 1 [Note] A temporary password is generated for root@localhost: i>;+lyB5Ojon\n```\n\n## 15.æŠŠå¯åŠ¨è„šæœ¬æ”¾åˆ°å¼€æœºåˆå§‹åŒ–ç›®å½•\n\n```shell\ncd /usr/Environment/Mysql/mysql-5.7.30/support-files/\ncp mysql.server /etc/init.d/mysql\n```\n\n## 16.ç¼–è¾‘ /etc/init.d/mysql æ–‡ä»¶\n\n```shell\nvim /etc/init.d/mysql\n```\n\nå°†æ–‡ä»¶ä¸­çš„basedirã€datadirèµ‹å€¼ä¸ºä¸Šé¢é…ç½®çš„ç›®å½•å³å¯\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](Mysql_install_3.png)\n\n## 17.é…ç½®ç¯å¢ƒå˜é‡\n\n```shell\nvim /etc/profile\n\n#ç¯å¢ƒå˜é‡ä¸‹é¢å¢åŠ ä»¥ä¸‹ä¸¤è¡Œï¼Œç›®å½•æ ¹æ®ä¸ªäººä¸åŒè¿›è¡Œä¿®æ”¹\n#ç›®çš„æ˜¯å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹å¯åŠ¨ mysql æœåŠ¡ä¸ç™»å½• mysql\nexport MYSQLBIN_HOME=/usr/Environment/Mysql/mysql-5.7.30\nexport PATH=$MYSQLBIN_HOME/bin:$PATH\n```\n\n## 18.ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\n\n```shell\nsource /etc/profile\n```\n\nå¦‚æœåˆ‡æ¢å›æ™®é€šç”¨æˆ·ï¼Œæˆ–è€…é‡å¯ä¹‹åç¯å¢ƒå˜é‡å¤±æ•ˆï¼Œé…ç½® ~/.bashrc æ–‡ä»¶ åœ¨æœ€ä¸‹é¢æ·»åŠ  **source /etc/profile** å³å¯\n\n## 19.å¯åŠ¨MySQLæœåŠ¡\n\n```shell\nservice mysql start\n```\n\n## 20.æŸ¥çœ‹MySQLæœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨\n\n```shell\nservice mysql status\n```\n\nå¦‚ä¸‹å›¾ï¼Œå·²ç»å¯åŠ¨æˆåŠŸ\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](Mysql_install_4.png)\n\n## 21.ç™»å½•mysql\n\n```shell\nmysql -r root -p #æ‰§è¡Œå®Œæ­¤å‘½ä»¤ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œå¯†ç ä¸ºä¸Šæ–‡æ—¥å¿—ä¸­çš„åˆå§‹å¯†ç ï¼Œè¾“å…¥çš„æ—¶å€™å¯†ç æ˜¯ä¸å¯è§çš„ï¼Œç›´æ¥å¤åˆ¶è¿‡å»ä¹Ÿå¯ä»¥\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](Mysql_install_5.png)\n\n## 22.ä¿®æ”¹å¯†ç å¹¶æˆæƒè¿œç¨‹è¿æ¥\n\n```sql\nset password=password('123456');\ngrant all privileges on *.* to root@'%' identified by '123456';\nflush privileges;\n```\n\n## 23.é€€å‡ºMySQL\n\n```sql\nexit\n```\n\n## 24.é‡å¯MySQLç”Ÿæ•ˆ\n\n```shell\nservice mysql stop\nservice mysql start\n#æˆ–\nservice mysql restart\n```\n\n---\n\nè‡³æ­¤ **MySQL** å®‰è£…é…ç½®å®Œæˆ ï¼Œå¯ä»¥ç”¨è¿æ¥å·¥å…·è¿›è¡Œè¿æ¥äº†ã€‚","tags":["ç¯å¢ƒå®‰è£…"],"categories":["Linux","ç¯å¢ƒå®‰è£…"]},{"title":"Hexo&githubåšå®¢è¿ç§»ï¼ˆWindowsè¿ç§»è‡³Ubuntuï¼‰","url":"/2020/08/01/Hexo-githubåšå®¢è¿ç§»ï¼ˆWindowsè¿ç§»è‡³Ubuntuï¼‰/","content":"\n\n\nã€€ã€€è¿™ç¯‡åšå®¢ä¸»è¦è®²çš„æ˜¯å¦‚ä½•è¿›è¡Œ **Hexo&github** åšå®¢è¿ç§»ï¼Œæ­¤å¤„åº”ç”¨åœºæ™¯ä¸ºæ¢ç”µè„‘åè¿›è¡Œè¿ç§»\n\n<!-- more -->\n\nã€€ã€€ç”±äºæœ¬äººç”µè„‘æœ‰ä¸¤å—å›ºæ€ï¼Œæ‰€æœ‰åœ¨ç©ºé—´æ¯”è¾ƒå°çš„å›ºæ€ä¸Šè£…äº†ä¸€ä¸ª **Ubuntu** ç³»ç»Ÿï¼Œå®‰è£…ä¹‹åï¼Œè¿›è¡Œä¸€äº›å¼€å‘åº”ç”¨ï¼Œåœ¨å®‰è£…ä¹‹åæœ‰ä¸€äº›ä½¿ç”¨çš„é—®é¢˜æƒ³è¦è®°å½•ä¸€ä¸‹ï¼Œæ‰€ä»¥å†³å®šè¿ç§»ä¸ªäººåšå®¢åˆ°è¿™ä¸ªç³»ç»Ÿä¸Šã€‚\n\nã€€ã€€å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœ¬äººå®é™…çš„è¿ç§»è¿‡ç¨‹ï¼š\n\n## 1.è¿ç§»å‰ç¯å¢ƒå‡†å¤‡\n\nåœ¨æ–°ç³»ç»Ÿä¸Šå®‰è£…å¦‚ä¸‹ç¯å¢ƒï¼š\n\n1. **å®‰è£…gitï¼š**æ­¤å¤„å‚è€ƒ[Ubuntuä¸‹gitçš„å®‰è£…åŠä½¿ç”¨](https://www.cnblogs.com/lxm20145215----/p/5905765.html)å³å¯\n\n2. **å®‰è£…Nodejsï¼š**æ­¤å¤„å‚è€ƒæœ¬äººåšå®¢ä¸­çš„[Ubuntuå®‰è£…Nodejs](https://sunyubk.github.io/2020/07/16/Ubuntu%E5%AE%89%E8%A3%85NodeJS/)\n\n3. **å®‰è£…Hexoï¼š**æ­¤å¤„å‚è€ƒæœ¬äººåšå®¢ä¸­çš„[Ubuntuå®‰è£…Hexo](https://sunyubk.github.io/2020/08/01/Ubuntu%E5%AE%89%E8%A3%85Hexo/)\n\n## 2.å°†åšå®¢æ–‡ä»¶å­˜è‡³github\n\n### 1ï¼‰åœ¨githubä¸Šåˆ›å»ºä»“åº“ç”¨äºå­˜æ”¾åšå®¢æ–‡ä»¶\n\nå¦‚ä¸‹å›¾ï¼Œç‚¹å‡» New repository åˆ›å»ºä»“åº“ï¼Œblog_allå°±æ˜¯æœ¬äººå­˜æ”¾è¿ç§»åšå®¢çš„çš„ä»“åº“ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªä»“åº“æ˜¯ç§äººçš„ã€‚\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](move_blog_1.png)\n\n\n\n### 2ï¼‰ä¸Šä¼ åšå®¢æ–‡ä»¶è‡³githubä»“åº“\n\nå°†åŸç³»ç»Ÿä¸­åšå®¢ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½ä¸Šä¼ è‡³ **github** ä»“åº“ä¸­ï¼Œå› ä¸ºæœ‰ä¸€äº›æ–‡ä»¶ä¼šä½¿ä¸Šä¼ å¤±è´¥ï¼Œæ‰€ä»¥æœ¬äººçš„å¤„ç†æ–¹å¼æ˜¯ï¼š\n\nåœ¨æœ¬åœ°å­˜æ”¾åšå®¢æ–‡ä»¶çš„æ–‡ä»¶å¤¹åŒçº§åˆ›å»ºç”¨äºå­˜æ”¾å¯èƒ½ä¼šå¹²æ‰°ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæœ¬äººç§»åŠ¨çš„æ–‡ä»¶éƒ½æœ‰ï¼š\n\n1. åšå®¢æ ¹ç›®å½•ä¸‹çš„ï¼š.gitignore æ–‡ä»¶\n2. .deploy_gitæ–‡ä»¶å¤¹ä¸‹çš„ .git æ–‡ä»¶å¤¹\n3. ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„ .git æ–‡ä»¶å¤¹\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](move_blog_3.png)ã€€ã€€\n\nä¸‹å›¾ä¸ºæœ¬äººä¸Šä¼ çš„åçš„ä»“åº“ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](move_blog_2.png)\n\n## 3.å°†githubä»“åº“ä¸­çš„æ–‡ä»¶cloneè‡³æ–°ç³»ç»Ÿä¸­\n\n### 1ï¼‰åœ¨æœ¬åœ°åˆ›å»ºç”¨äºå­˜æ”¾åšå®¢æ–‡ä»¶çš„ç›®å½•\n\nä¸‹å›¾ä¸­çš„ **blog_all** å°±æ˜¯åšå®¢çš„ç›®å½•ï¼Œ**git_config** æ˜¯å­˜æ”¾ä¸€äº›å¯èƒ½ä¼šçƒ¦æ‰°ä¸Šä¼ çš„æ–‡ä»¶\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](move_blog_4.png)\n\n### 2ï¼‰è‡³æ­¤åšå®¢è¿ç§»å°±å·²ç»å®Œæˆäº†\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](move_blog_5.png)\n\n### 3ï¼‰æ£€éªŒåšå®¢æ˜¯å¦å¯ä»¥æˆåŠŸè®¿é—®\n\nåœ¨ **blog_all** æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œä¸€ä¸‹å‘½ä»¤åè®¿é—®ï¼Œlocalhost:4000ï¼š\n\n```shell\nhexo s -g\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](move_blog_6.png)\n\n## 4.ç¼–å†™shellè„šæœ¬ç”¨äºæ›´æ–°åšå®¢è¿ç§»çš„ä»“åº“ï¼Œä¸ºä»¥ååšå®¢è¿ç§»åšå‡†å¤‡\n\n<font color=\"red\">æ³¨ï¼šä»¥ä¸‹å‘½ä»¤ä¸­çš„ç›®å½•æ ¹æ®ä¸ªäººä¸åŒï¼Œè¯·æ³¨æ„ä¿®æ”¹ã€‚</font>\n\n### 1ï¼‰åˆ›å»ºå­˜æ”¾è„šæœ¬çš„ç›®å½•\n\nä¸‹å›¾ä¸ºç›®å½•ç»“æ„ï¼ˆæ ¹æ®ä¸ªäººå–œå¥½è‡ªå·±é…ç½®å³å¯ï¼‰ï¼š\n\n**shell** ç›®å½•ä¸‹çš„update_blog.shæ‰æ˜¯æœ€ç»ˆçš„æ‰§è¡Œæ–‡ä»¶ï¼Œ**libs** ä¸‹çš„æ–‡ä»¶æ‰§è¡Œä¾›å…¶ä»–è„šæœ¬è°ƒç”¨çš„è„šæœ¬\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](move_blog_7.png)\n\n### 2ï¼‰ç¼–å†™ shell è„šæœ¬\n\næ­¤å¤„åˆ†ä¸ºå››æ­¥è¿›è¡Œï¼š\n\n1. å°†å¯èƒ½ä¼šå¹²æ‰°ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æš‚å­˜æ–‡ä»¶å¤¹ä¸­\n2. ä½¿ç”¨ **git** å‘½ä»¤å°†æ–‡ä»¶ä¸Šä¼ \n3. ä¸Šä¼ è¿‡åï¼Œå†å°†æš‚å­˜æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ç§»åŠ¨å›åŸç›®å½•\n4. åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼Œç”¨äºè®°å½•ä»€ä¹ˆæ—¶é—´æ›´æ–°è¿‡\n\n```shell\n#!/bin/bash\n\n#è·å–å½“å‰æ—¶é—´ç”¨äºæäº¤æè¿°ä½¿ç”¨\ntime=$(date \"+%Y-%m-%d %H:%M:%S\")\n\n#å·²ä¸‹å‘½ä»¤ä¸ºç§»åŠ¨ä¸€äº›é…ç½®æ–‡ä»¶\necho \"1.ç§»åŠ¨ .deploy_git ä¸‹çš„ .git æ–‡ä»¶å¤¹åˆ°ç›¸åº”çš„åšå®¢é…ç½®æ–‡ä»¶æš‚å­˜æ–‡ä»¶å¤¹ä¸­\"\nsudo mv /usr/Environment/Hexo/blog_all/.deploy_git/.git /usr/Environment/Hexo/git_config/.deploy_git/\n\necho \"2.ç§»åŠ¨åšå®¢æ–‡ä»¶æ ¹ç›®å½•ä¸‹çš„ .gitignore åˆ°ç›¸åº”çš„åšå®¢é…ç½®æ–‡ä»¶æš‚å­˜æ–‡ä»¶å¤¹ä¸­\"\nsudo mv /usr/Environment/Hexo/blog_all/.gitignore /usr/Environment/Hexo/git_config/blog_git/\n\necho \"3.ç§»åŠ¨åšå®¢ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„ .git æ–‡ä»¶å¤¹åˆ°ç›¸åº”çš„åšå®¢é…ç½®æ–‡ä»¶æš‚å­˜æ–‡ä»¶å¤¹ä¸­\"\nsudo mv /usr/Environment/Hexo/blog_all/themes/stun/.git /usr/Environment/Hexo/git_config/themes_git/stun/\n\n#ä»¥ä¸‹å‘½ä»¤ä¸ºå°†æœ¬åœ°æ”¹åŠ¨æäº¤è‡³è¿œç¨‹åº“\necho \"4.æ‰§è¡Œ git add è·Ÿè¸ªå‘½ä»¤\"\ngit add .\n\necho \"5.æ‰§è¡Œ git commit å‘½ä»¤å°†æš‚å­˜åŒºçš„æ”¹åŠ¨æäº¤è‡³æœ¬åœ°çš„ç‰ˆæœ¬åº“\"\ngit commit -m \"æ›´æ–°äºï¼š${time}\"\n\necho \"6.æ‰§è¡Œ git push å‘½ä»¤å°†æœ¬åœ°åº“æ¨é€è‡³è¿œç¨‹åº“\"\ngit push\n\n#ä»¥ä¸‹å‘½ä»¤ä¸ºå°†ç¬¬ä¸€æ­¥ä¸­ç§»åŠ¨çš„é…ç½®æ–‡ä»¶ç§»åŠ¨å›åŸä½\necho \"7.ç§»åŠ¨ .deploy_git ä¸‹çš„ .git æ–‡ä»¶å¤¹åˆ°ç›¸åº”çš„åšå®¢é…ç½®æ–‡ä»¶æš‚å­˜æ–‡ä»¶å¤¹ä¸­\"\nsudo mv /usr/Environment/Hexo/git_config/.deploy_git/.git /usr/Environment/Hexo/blog_all/.deploy_git/\n\necho \"8.ç§»åŠ¨åšå®¢æ–‡ä»¶æ ¹ç›®å½•ä¸‹çš„ .gitignore åˆ°ç›¸åº”çš„åšå®¢é…ç½®æ–‡ä»¶æš‚å­˜æ–‡ä»¶å¤¹ä¸­\"\nsudo mv /usr/Environment/Hexo/git_config/blog_git/.gitignore /usr/Environment/Hexo/blog_all/\n\necho \"9.ç§»åŠ¨åšå®¢ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„ .git æ–‡ä»¶å¤¹åˆ°ç›¸åº”çš„åšå®¢é…ç½®æ–‡ä»¶æš‚å­˜æ–‡ä»¶å¤¹ä¸­\"\nsudo mv /usr/Environment/Hexo/git_config/themes_git/stun/.git  /usr/Environment/Hexo/blog_all/themes/stun/\n\n#å†™å…¥æ›´æ–°æ—¥å¿—\n# åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸å­˜åœ¨ã€åˆ›å»ºæ–‡ä»¶å¹¶è¾“å…¥å†…å®¹\nfile=\"/usr/Environment/Hexo/update_blog.log\"\n\nif [ ! -f  $file ];then \n\techo \"æ›´æ–°äºï¼š${time}\" >> $file\nelse\n\t# cat $file\n\techo \"æ›´æ–°äºï¼š${time}\" >> $file\nfi\n\necho \"æ–°å®Œæˆï¼Œæ—¥å¿—å†™å…¥å®Œæˆ\"\n```\n\nä»¥ä¸Šè„šæœ¬å·²ç»å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦åœ¨rootç”¨æˆ·ä¸‹ã€‚\n\n### 3ï¼‰åˆ›å»º Expect è„šæœ¬ç”¨äºåˆ‡æ¢ç™»å½•ç”¨æˆ·\n\n1. å®‰è£… **Expectã€Tcl**ã€‚æ­¤å¤„å‚è€ƒæœ¬äººåšå®¢ä¸­çš„[Ubuntuanå®‰è£…Expect&Tcl]()\n\n2. ç¼–å†™ **Expect** è„šæœ¬\n\n   ```shell\n   spawn sudo su root\n   expect \"å¯†ç ï¼š\" {send \".\\r\" }\n   expect \"*#\" {send \"cd /usr/Environment/Hexo/blog_all\\r\"}\n   expect \"blog_all*\" {send \"sh /usr/Environment/Scripts/Shell/libs/shell_update_blog.sh\\r\"}\n   interact\n   ```\n\n3. ç”±äºæœ¬äººå¤ªæ‡’ï¼Œä¸æƒ³æ²¡æœ‰éƒ½è¾“å…¥ expect XXXï¼Œæ‰€ä»¥åˆå†™äº†ä¸€ä¸ªè°ƒç”¨ **Expect** è„šæœ¬çš„ **shell** è„šæœ¬\n\n   ```shell\n   expect /usr/Environment/Scripts/Expect/expect_update_blog.sh\n   ```\n\nè‡³æ­¤ï¼Œæ›´æ–°è„šæœ¬ç¼–å†™å®Œæˆã€‚\n\n## 5.é…ç½® /etc/profile æ–‡ä»¶ ä½¿è„šæœ¬åœ¨ä»»æ„ç›®å½•éƒ½å¯ä»¥æ‰§è¡Œ\n\n1. åœ¨/etc/profile æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š\n\n   ```shell\n   export SHELL_HOME=/usr/Environment/Scripts/Shell\t#ç›®å½•æ ¹æ®ä¸ªäººä¸åŒè¿›è¡Œä¿®æ”¹\n   export PATH=$SHELL_HOME:$PATH\n   ```\n\n2. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼š\n\n   ```shell\n   source /etc/profile\n   ```\n\n   ç°åœ¨å…¶å®å°±å·²ç»å¯ä»¥åœ¨ä»»æ„ç›®å½•æ‰§è¡ŒæŒ‡å®šç›®å½•ä¸­çš„è„šæœ¬æ–‡ä»¶äº†ï¼Œä½†æ˜¯é‡å¯ç»ˆç«¯ä¹‹åå°±ä¸è¡Œäº†ï¼Œä¹Ÿè®¸æ˜¯ä¸ªäººç”µè„‘é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®è¿›è¡Œä¸‹ä¸€æ­¥é…ç½®ã€‚\n\n3. é…ç½® ~/.bashrc æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ç¬¬äºŒæ­¥æ‰§è¡Œçš„å‘½ä»¤ã€‚\n\nè‡³æ­¤ï¼Œè„šæœ¬å°±é…ç½®å¥½äº†ã€‚\n\n---\n\nã€€ã€€å¥½äº†ï¼Œåˆ°è¿™é‡Œæœ¬ç¯‡æ–‡ç« å°±ç»“æŸï¼Œæ›´æ–°å®Œåšå®¢ä¹‹åå¯ä»¥é¡ºä¾¿æ‰§è¡Œä¸€ä¸‹è„šæœ¬ï¼Œå°†åšå®¢æ–‡ä»¶ä¸Šä¼ è‡³ **github** ä»“åº“ä¸­ï¼Œç”¨äºä»¥åè¿ç§»ï¼Œæˆ–è€…å½“ä¸ªä»¥é˜²ä¸‡ä¸€çš„å¤‡ä»½ã€‚","tags":["ä¸ªäººåšå®¢"],"categories":["ä¸ªäººåšå®¢","åšå®¢è¿ç§»"]},{"title":"Ubuntuanå®‰è£…Expect&Tcl","url":"/2020/08/01/Ubuntuanå®‰è£…Expect-Tcl/","content":"\n\n\n<font color=\"red\">æ³¨ï¼šä»¥ä¸‹å‘½ä»¤éƒ½æ˜¯åœ¨ root ç”¨æˆ·ä¸‹æ‰§è¡Œ</font>\n\n<!-- more -->\n\n## 1.æ£€æŸ¥ Tcl çš„å®‰è£…æƒ…å†µ\n\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n```shell\nwhereis tcl\n```\n\nå¦‚æœæ²¡æœ‰æ˜¾ç¤ºï¼Œå°±æ˜¯æ²¡æœ‰å®‰è£… **Tcl**\n\n## 2.ä¸‹è½½å®‰è£…æ–‡ä»¶\n\n```shell\nwget https://nchc.dl.sourceforge.net/project/tcl/Tcl/8.6.10/tcl8.6.10-src.tar.gz\n```\n\n## 3.åˆ›å»ºæ–‡ä»¶å¤¹\n\n```shell\nmkdir /usr/Environment/Tcl #Environmentæ˜¯æœ¬äººåˆ›å»ºç”¨å­˜æ”¾å®‰è£…ç¯å¢ƒçš„ç›®å½•\n```\n\n## 4.ç§»åŠ¨å®‰è£…æ–‡ä»¶è‡³ Tcl ç›®å½•ä¸‹\n\n```shell\nmv tcl8.6.10-src.tar.gz /usr/Environment/Tcl/\n```\n\n## 5.è§£å‹\n\n```shell\ntar -zxvf tcl8.6.10-src.tar.gz\n```\n\n## 6.è¿›å…¥å®‰è£…ç›®å½•\n\n```shell\n#åœ¨ä¸Šä¸€æ­¥è§£å‹åä¼šå¾—åˆ°tcl8.6.10\ncd tcl8.6.10/unix/\n```\n\n## 7.ç”ŸæˆMakefile\n\n```shell\n./configure\n```\n\n## 8.ç¼–è¯‘ã€å®‰è£…\n\n```shell\nmake\nmake install\n```\n\n","tags":["ç¯å¢ƒå®‰è£…"],"categories":["Linux","ç¯å¢ƒå®‰è£…"]},{"title":"Ubuntuå®‰è£…Hexo","url":"/2020/08/01/Ubuntuå®‰è£…Hexo/","content":"\n\n\n## 1.ä½¿ç”¨[ä½¿ç”¨æ·˜å®NPMé•œåƒ](https://developer.aliyun.com/mirror/NPM?from=tnpm)ï¼Œä½¿ç”¨ä¸€ä¸‹å‘½ä»¤ç­‰å¾…å®‰è£…å®Œæˆ\n\n```shell\nnpm install -g cnpm --registry=https://registry.npm.taobao.org\n```\n\n<!-- more -->\n\n## 2.ä½¿ç”¨æ·˜å®NPMå®‰è£…Hexo\n\n```shell\ncnpm install -g hexo-cli\n```\n\n\n\n## 3.å‡ºç°é”™è¯¯ä¸ç”¨ç†ä¼šï¼Œç»§ç»­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤\n\n```shell\ncnpm install hexo --save\n```\n\n\n\n## 4.å®‰è£…å®Œæˆåï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ŒéªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ\n\n```shell\nhexo -v\n```\n\n\n\n## 5.åˆå§‹åŒ–\n\n```shell\nhexo init\n```\n\n","tags":["ç¯å¢ƒå®‰è£…"],"categories":["Linux","ç¯å¢ƒå®‰è£…"]},{"title":"Ubuntuå®‰è£…NodeJS","url":"/2020/07/16/Ubuntuå®‰è£…NodeJS/","content":"\n\n\n## 1.ä¸‹è½½nodeJS\n\nä¸‹è½½åœ°å€ï¼š[https://nodejs.org/en/](https://nodejs.org/en/)\n\n<!-- more -->\n\n<font color=\"red\">LTSï¼šç¨³å®šç‰ˆã€€ã€€Currentï¼šæœ€æ–°ç‰ˆ</font>\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](nodeJS_install_1.png)\n\n## 2.è§£å‹\n\n```shell\n#ä¸‹è½½çš„å‹ç¼©åŒ…ä¸º tar.xz æ ¼å¼ï¼Œæ‰€ä»¥å…ˆç”¨ä»¥ä¸‹å‘½ä»¤è§£å‹ä¸€æ¬¡\nxz -d node-v12.18.2-linux-x64.tar.xz\n#è§£å‹è¿‡ååœ¨ç”¨ tar æ–¹å¼è§£å‹\ntar -xvf node-v12.18.2-linux-x64.tar\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](nodeJS_install_2.png)\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](nodeJS_install_3.png)\n\n\n\n## 3.é…ç½®ç¯å¢ƒå˜é‡\n\n```shell\nvim /etc/profile\t#ç¼–è¾‘å…¨å±€å˜é‡é…ç½®æ–‡ä»¶\n\n#åœ¨é…ç½®æ–‡ä»¶ä¸­è¿½åŠ å¦‚ä¸‹å†…å®¹\nexport NODE_HOME=/usr/Environment/nodeJS/node-v12.18.2-linux-x64\nexport PATH=$NODE_HOME/bin:$PATH\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](nodeJS_install_4.png)\n\n\n\n## 4.ä½¿é…ç½®ç”Ÿæ•ˆ\n\n```shell\nsource /etc/profile\t#ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\n```\n\n\n\n## 5.æ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸ\n\n```shell\nnode -v\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](nodeJS_install_5.png)\n\n\n\nå¦‚å›¾æ‰€ç¤ºå‡ºç°ç‰ˆæœ¬å·å³æˆåŠŸäº†ã€‚","tags":["ç¯å¢ƒå®‰è£…"],"categories":["Linux","ç¯å¢ƒå®‰è£…"]},{"title":"Ubuntuå®‰è£…Maven3.6.3","url":"/2020/07/16/Ubuntuå®‰è£…Maven3.6.3/","content":"\n\n\n## 1.ä¸‹è½½Maven\n\nä¸‹è½½åœ°å€ï¼š[http://maven.apache.org/index.html](http://maven.apache.org/index.html)\n\n<!-- more -->\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_1.png)\n\n\n\n## 2.è§£å‹\n\n```shell \ntar -zxvf apache-maven-3.6.3-bin.tar.gz\nmkdir repository\t#åˆ›å»ºæœ¬åœ°ä»“åº“æ–‡ä»¶å¤¹ï¼Œä¸‹é¢é…ç½®åˆ° setting.xml é…ç½®æ–‡ä»¶ä¸­\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_3.png)\n\n## 3.é…ç½® Maven é…ç½®æ–‡ä»¶ï¼Œé…ç½® æœ¬åœ°ä»“åº“(repository) ä¸ è¿œç¨‹ä»“åº“æº\n\n```shell\ncd apache-maven-3.6.3/conf/\t#è¿›å…¥ setting.xml é…ç½®æ–‡ä»¶ç›®å½•\ncp setting.xml setting.xml.bak\t#å¤‡ä»½é…ç½®æ–‡ä»¶\nvim setting.xml\t#ç¼–è¾‘é…ç½®æ–‡ä»¶\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_4.png)\n\n```xml\n#æ‰¾åˆ° localRepository æ ‡ç­¾ åœ¨æ³¨é‡Šå¤–å¢åŠ ä¸‹åˆ—å†…å®¹ ï¼Œç”¨äºæŒ‡å®šæœ¬åœ°ä»“åº“\n<localRepository>/usr/Environment/maven/repository</localRepository>\n\n#æ‰¾åˆ° mirrors æ ‡ç­¾ï¼Œåœ¨æ ‡ç­¾ä¸­å¢åŠ ä¸‹åˆ—å†…å®¹ï¼Œç”¨äºé…ç½®é˜¿é‡Œäº‘çš„ä»“åº“ \n    <mirror>\n\t\t<id>nexus-aliyun</id>\n\t\t<mirrorOf>central</mirrorOf>\n\t\t<name>Nexus aliyun</name>\n\t\t<url>https://maven.aliyun.com/repository/central</url>\n    </mirror>\n\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_5.png)\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_6.png)\n\n\n\n## 4.é…ç½®ç¯å¢ƒå˜é‡\n\n```shell\nvim /etc/profile\t#ç¼–è¾‘å…¨å±€å˜é‡é…ç½®æ–‡ä»¶\n\n#åœ¨é…ç½®æ–‡ä»¶ä¸­è¿½åŠ å¦‚ä¸‹å†…å®¹\nexport MAVEN_HOME=/usr/Environment/maven/apache-maven-3.6.3\nexport PATH=${MAVEN_HOME}/bin:${PATH}\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_7.png)\n\n\n\n## 5.ä½¿é…ç½®ç”Ÿæ•ˆ\n\n```shell\nsource /etc/profile\t#ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\n```\n\n\n\n## 6.æ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸ\n\n```shell\nmvn -v\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_8.png)\n\n\n\n## 7.åˆå§‹åŒ–æœ¬åœ°ä»“åº“\n\n```shell\nmvn help:system\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](maven_install_9.png)\n\n\n\nåˆ°è¿™é‡Œ Maven å·²ç»å®‰è£…æˆåŠŸï¼Œæœ¬åœ°ä»“åº“ä¸­ä¹Ÿå·²ç»æœ‰äº†åŸºç¡€çš„ jar åŒ…äº†","tags":["ç¯å¢ƒå®‰è£…"],"categories":["Linux","ç¯å¢ƒå®‰è£…"]},{"title":"Ubuntuå®‰è£…tomcat8.5","url":"/2020/07/16/Ubuntuå®‰è£…tomcat8.5/","content":"\n\n\n## 1.ä¸‹è½½ tomcat\n\nä¸‹è½½åœ°å€ï¼š[https://tomcat.apache.org/download-80.cgi](https://tomcat.apache.org/download-80.cgi)\n\n<!-- more -->\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](tomcat_install_1.png)\n\n\n\n## 2.è§£å‹\n\n```shell\ntar -zxvf apache-tomcat-8.5.34.tar.gz\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](tomcat_install_2.png)\n\n\n\n## 3.é…ç½®ç¯å¢ƒå˜é‡\n\n**ç¯å¢ƒå˜é‡ä¹Ÿå¯ä»¥ä¸é…ç½®ï¼Œé…ç½®çš„ç›®çš„æ˜¯ä¸ºäº†å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹å¯åŠ¨ tomcat**\n\n```shell\nvim /etc/profile\t#ç¼–è¾‘å…¨å±€å˜é‡é…ç½®æ–‡ä»¶\n\n#åœ¨é…ç½®æ–‡ä»¶ä¸­è¿½åŠ å¦‚ä¸‹å†…å®¹\nexport PATH=$PATH:/usr/Environment/tomcat/apache-tomcat-8.5.34/bin\n#ç¼–è¾‘å¥½ä¹‹åæŒ‰ ESC è¾“å…¥ :wq é€€å‡ºå¹¶ä¿å­˜é…ç½®æ–‡ä»¶\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](tomcat_install_3.png)\n\n\n\n## 4.ä½¿é…ç½®ç”Ÿæ•ˆ\n\n```shell\nsource /etc/profile\t#ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\n```\n\n\n\n## 5.æ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸ\n\n```shell\nstartup.sh\t#å¯åŠ¨ \nshutdown.sh\t#å…³é—­ \n\n#å¯åŠ¨åå¯è®¿é—® localhost:8080 ï¼Œtomcatç«¯å£é»˜è®¤8080ï¼Œæ˜¾ç¤ºå¦‚ä¸‹é¡µé¢è¡¨ç¤ºå¯åŠ¨æˆåŠŸ\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](tomcat_install_4.png)","tags":["ç¯å¢ƒå®‰è£…"],"categories":["Linux","ç¯å¢ƒå®‰è£…"]},{"title":"Ubuntuå®‰è£…jdk1.8","url":"/2020/07/16/Ubuntuå®‰è£…jdk1.8/","content":"\n\n\n## 1.ä¸‹è½½ JDK\n\njdk8 ä¸‹è½½åœ°å€ï¼š[https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html](https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html)\n\n<!-- more -->\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](jdk_install_1.png)\n\n\n\n## 2.è§£å‹\n\n```shell\ntar -zxvf jdk-8u191-linux-x64.tar.gz\t#å°†å‹ç¼©åŒ…è§£å‹\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](jdk_install_2.png)\n\n*å›¾ä¸­çš„ç›®å½•å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œå°ç¼–æ˜¯åœ¨ **/user** ä¸‹åˆ›å»ºäº†ç¯å¢ƒä¸“ç”¨çš„ç›®å½•\n\n\n\n## 3.é…ç½®ç¯å¢ƒå˜é‡\n\n```shell\nvim /etc/profile\t#ç¼–è¾‘å…¨å±€å˜é‡é…ç½®æ–‡ä»¶\n\n#åœ¨é…ç½®æ–‡ä»¶ä¸­è¿½åŠ ä»¥ä¸‹å†…å®¹\nexport JAVA_HOME=/usr/Environment/jdk/jdk1.8.0_191\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n#ç¼–è¾‘å¥½ä¹‹åæŒ‰ ESC è¾“å…¥ :wq é€€å‡ºå¹¶ä¿å­˜é…ç½®æ–‡ä»¶\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](jdk_install_3.png)\n\n\n\n## 4.ä½¿é…ç½®ç”Ÿæ•ˆ\n\n```shell\nsource /etc/profile\t#ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\n```\n\n\n\n## 5.æ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸ\n\n```shell\njava -version\næˆ–\njavac -version\n```\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](jdk_install_4.png)\n\n\n\n**å‡ºç°å¦‚ä¸Šå›¾æ‰€ç¤ºç‰ˆæœ¬å·å³å®‰è£…æˆåŠŸ**","tags":["ç¯å¢ƒå®‰è£…"],"categories":["Linux","ç¯å¢ƒå®‰è£…"]},{"title":"Java é¢è¯•é¢˜","url":"/2020/07/16/é¢è¯•é¢˜/","content":"\n# ä¸€ã€JavaåŸºç¡€\n\n## 1.JDK å’Œ JRE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n- JDKï¼šjavaå¼€å‘å·¥å…·åŒ…ï¼Œæä¾›äº†javaçš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒã€‚\n- JREï¼šjavaçš„è¿è¡Œç¯å¢ƒï¼Œä¸ºjavaçš„è¿è¡Œæä¾›äº†æ‰€éœ€ç¯å¢ƒã€‚\n\n<!-- more -->\n\n## 2.== å’Œ equals çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\n\n**== è§£è¯»**\n\nå¯¹äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ == çš„ä½œç”¨æ•ˆæœæ˜¯ä¸åŒçš„ï¼š\n\n- åŸºæœ¬ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸åŒã€‚\n- å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¼•ç”¨æ˜¯å¦ç›¸åŒã€‚\n\nä»£ç ç¤ºä¾‹ï¼š\n\n```java\nString x = \"string\";\nString y = \"string\";\nString z = new String(\"string\");\nSystem.out.println(x==y); // true\nSystem.out.println(e==z); // false\nSystem.out.println(x.equals(y)); // true\nSystem.out.println(x.equals(z)); //true\n```\n\nä»£ç è§£è¯»ï¼š\n\n1. å› ä¸º x å’Œ y æŒ‡å‘çš„æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆæŒ‡å‘çš„éƒ½æ˜¯å¸¸é‡æ± ä¸­çš„stringï¼‰ï¼Œæ‰€ä»¥ == ä¹Ÿæ˜¯trueã€‚\n2. å› ä¸º new String()æ–¹æ³•æ˜¯é‡æ–°å¼€è¾Ÿäº†å†…å­˜ç©ºé—´æ‰€æœ‰ == çš„ç»“æœä¸ºfalseã€‚\n3. equalsæ¯”è¾ƒçš„ä¸€ç›´éƒ½æ˜¯å€¼æ‰€ä»¥ä¸€ç›´éƒ½æ˜¯trueã€‚\n\n**equalsè§£è¯»**\n\nequals æœ¬è´¨ä¸Šå°±æ˜¯ ==ï¼Œåªä¸è¿‡ String å’Œ Integer ç­‰é‡å†™äº† equals æ–¹æ³•ï¼ŒæŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒã€‚\n\n**æ€»ç»“**ï¼š== å¯¹äºåŸºæœ¬ç±»å‹æ˜¯å€¼æ¯”è¾ƒï¼Œå¯¹äºå¼•ç”¨ç±»å‹æ˜¯å¼•ç”¨æ¯”è¾ƒï¼›è€Œ equals é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼•ç”¨æ¯”è¾ƒã€‚åªæ˜¯å¾ˆå¤šç±»é‡å†™äº† equals æ–¹æ³•ã€‚æ¯”å¦‚ Stringã€Integer ç­‰æŠŠå®ƒé‡å†™æˆäº†å€¼æ¯”è¾ƒã€‚\n\n## 3.ä¸¤ä¸ªå¯¹è±¡çš„ hashCode()ç›¸åŒï¼Œåˆ™ equals()ä¹Ÿä¸€å®šä¸º trueï¼Œå¯¹å—ï¼Ÿ\n\nä¸å¯¹ï¼Œä¸¤ä¸ªå¯¹è±¡çš„ hashCode()ç›¸åŒï¼Œequals()ä¸ä¸€å®štrueã€‚\n\n**åŸå› **ï¼šåœ¨æ•£åˆ—è¡¨ä¸­ï¼ŒhashCode()ç›¸ç­‰ï¼Œå³ä¸¤ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œç„¶è€Œå“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾—å‡ºé”®å€¼å¯¹ç›¸ç­‰ã€‚\n\n## 4.final åœ¨ java ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ\n\n- final ä¿®é¥°çš„ç±»å«æœ€ç»ˆç±»ï¼Œä¸èƒ½è¢«ç»§æ‰¿ã€‚\n- final ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚\n- final ä¿®é¥°çš„å˜é‡å«å¸¸é‡ï¼Œå¸¸é‡å¿…é¡»åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¹‹åå€¼å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚\n\n## 5.java ä¸­çš„ Math.round(-1.5) ç­‰äºå¤šå°‘ï¼Ÿ\n\nç­‰äº -1ï¼ŒMath.round() å°±æ˜¯åŠ  0.5 å¹¶å‘ä¸‹å–æ•´ã€‚\n\n## 6.String å±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ\n\nString ä¸å±äºåŸºç¡€ç±»å‹ï¼Œè€Œå±äºå¯¹è±¡ã€‚\n\nåŸºç¡€ç±»å‹æœ‰ 8 ä¸­ï¼šbyteã€shortã€intã€longã€floatã€doubleã€booleanã€charã€‚\n\n## 7.java ä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\næ“ä½œå­—ç¬¦ä¸²çš„ç±»æœ‰ï¼šStringã€StringBufferã€StringBuilder\n\n**åŒºåˆ«**ï¼š\n\n1. String å£°æ˜çš„æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ï¼Œè€Œ StringBufferã€StringBuilder å¯ä»¥å†åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¸Šè¿›è¡Œæ“ä½œã€‚\n2. StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒStringBuilder ç›¸åã€‚\n\n## 8.String str = \"i\" ä¸ String str = new String(\"i\") ä¸€æ ·å—ï¼Ÿ\n\nä¸ä¸€æ ·ã€‚\n\n**åŸå› **ï¼šString str = \"i\" æ˜¯è¢« java è™šæ‹Ÿæœºåˆ†é…åˆ°å¸¸é‡æ± ä¸­ï¼Œè€Œ String str = new String(\"i\") æ˜¯è¢«åˆ†é…åˆ°å †å†…å­˜ä¸­ã€‚\n\n## 9.å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬\n\n1. ä½¿ç”¨ StringBuffer æˆ–è€…StringBuilder çš„ reverse() æ–¹æ³•ã€‚\n\n**ç¤ºä¾‹ä»£ç **ï¼š\n\n```java\nString str = \"abc\";\nStringBuffer sb = new StringBuffer(str);\nStringBuffer res = sb.reverse();\nstr = res.toString();\n```\n\n2. ä½¿ç”¨ String çš„ charAt() æ–¹æ³•ï¼Œå°†å­—ç¬¦ä¸²ä»åå‘å‰å–å‡ºï¼Œå­˜å…¥åˆ° StringBuffer æˆ–è€… StringBuilder ä¸­ï¼Œå†è½¬ä¸º Stringã€‚\n\n**ç¤ºä¾‹ä»£ç **ï¼š\n\n```java\nString str = \"abc\";\nStringBuffer sb = new StringBuffer();\nfor(int x = str.length()-1;x >= 0;x--){\n    sb.append(str.charAt(x));\n}\nstr = sb.toString();\n```\n\n## 10.Stringç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ\n\n- indeOf()\tè¿”å›æŒ‡å®šå­—ç¬¦çš„ç´¢\n- charAt()\tè¿”å›æŒ‡å®šç´¢å¼•çš„å­—ç¬¦\n- replace()\tå­—ç¬¦ä¸²æ›¿æ¢\n- trim()\tå»é™¤ä¸¤ç«¯çš„ç©ºç™½\n- split()\tåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„\n- getBytes()\tè¿”å›å­—ç¬¦ä¸²çš„byteç±»å‹æ•°ç»„\n- substring()\tæˆªå–å­—ç¬¦ä¸²\n- length()\tè¿”å›å­—ç¬¦ä¸²é•¿åº¦\n- equals()\tæ¯”è¾ƒå­—ç¬¦ä¸²\n- toLowerCase()\tå°†å­—ç¬¦ä¸²è½¬ä¸ºå°å†™å­—æ¯\n- toUpperCase()\tå°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™å­—æ¯\n\n## 11.ä»€ä¹ˆæ˜¯æŠ½è±¡ï¼Ÿä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ\n\n**æŠ½è±¡**ï¼šæŠ½è±¡æ˜¯å¯¹å…·ä½“å¯¹è±¡è¿›è¡Œæç‚¼ï¼Œæå–å¯¹è±¡çš„åŒç±»å‹çš„ å…±æ€§ç‰¹å¾ çš„è¿‡ç¨‹\n\n**å¤šæ€**ï¼šå¤šæ€å°±æ˜¯å¤šä¸ªå¯¹è±¡å¯¹ä¸€ä¸ªè¡Œä¸ºçš„ä¸åŒå“åº”/å¤šæ€  æ˜¯ å¯¹è±¡æœ¬èº«å…·å¤‡çš„ä¸åŒçŠ¶æ€\n\n**è‡ªæˆ‘æ„Ÿè§‰ â€œæŠ½è±¡â€ å’Œ â€œå¤šæ€â€ å¾ˆåƒ**\n\n## 12.æŠ½è±¡ç±»å¿…é¡»æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿ\n\nä¸æ˜¯çš„ï¼ŒæŠ½è±¡ç±»å¯ä»¥æ²¡æœ‰æŠ½è±¡æ–¹æ³•\n\n## 13.æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n1. æ™®é€šç±»ä¸èƒ½æœ‰æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡ç±»å¯ä»¥æœ‰æŠ½è±¡æ–¹æ³•ã€‚\n2. æ™®é€šç±»å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ï¼ŒæŠ½è±¡ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ã€‚\n\n## 14.æŠ½è±¡ç±»èƒ½ä½¿ç”¨ final ä¿®é¥°å—ï¼Ÿ\n\nä¸èƒ½ï¼Œfinal ä¿®é¥°çš„ç±»ä¸å¯è¢«ç»§æ‰¿ï¼Œè€ŒæŠ½è±¡ç±»å°±æ˜¯ç”¨æ¥ç»§æ‰¿çš„ã€‚\n\n## 15.æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n- å®ç°ï¼šæ¥å£æ˜¯ç”± implements æ¥å®ç°çš„ï¼ŒæŠ½è±¡ç±»æ˜¯ç”± extends ç»§æ‰¿çš„ã€‚\n- æ„é€ æ–¹æ³•ï¼šæ¥å£æ²¡æœ‰æ„é€ æ–¹æ³•ï¼ŒæŠ½è±¡ç±»æœ‰æ„é€ æ–¹æ³•ã€‚\n- å®ç°æ•°é‡ï¼šç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»\n\n**ä¸ªäººç†è§£**ï¼šæŠ½è±¡ç±»å°±æ˜¯å®ç°å¤šæ€çš„ä¸€ç§æ–¹å¼\n\n## 16.Javaä¸­çš„ IO æµåˆ†ä¸ºå“ªå‡ ç§ï¼Ÿ\n\n**æŒ‰åŠŸèƒ½**ï¼šè¾“å…¥æµï¼ˆinputï¼‰ï¼Œè¾“å‡ºæµï¼ˆoutputï¼‰\n\n**æŒ‰ç±»å‹**ï¼šå­—èŠ‚æµï¼Œå­—ç¬¦æµ\n\n**å­—èŠ‚æµï¼šinputStreamã€outputStreamï¼›**\n\n**å­—ç¬¦æµï¼šreaderã€writerï¼›**\n\n## 17.BIOã€NIOã€AIOæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n- **BIO**ï¼šBlock IO åŒæ­¥é˜»å¡å¼ IOï¼Œå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ä¼ ç»Ÿ IOï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ¨¡å¼ç®€å•ä½¿ç”¨æ–¹ä¾¿ï¼Œå¹¶å‘å¤„ç†èƒ½åŠ›ä½ã€‚\n- **NIO**ï¼šNew IO åŒæ­¥éé˜»å¡ IOï¼Œæ˜¯ä¼ ç»Ÿ IO çš„å‡çº§ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šè¿‡ Channelï¼ˆé€šé“ï¼‰é€šè®¯ï¼Œå®ç°äº†å¤šè·¯å¤ç”¨ã€‚\n- **AIO**:Asynchronous IO æ˜¯ NIO çš„å‡çº§ï¼Œä¹Ÿå« NIO2ï¼Œå®ç°äº†å¼‚æ­¥éå µå¡ IO ï¼Œå¼‚æ­¥ IO çš„æ“ä½œåŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶ã€‚\n\n## 18.files çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ\n\n- File.exists()ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Ÿ\n- File.createFile()ï¼šåˆ›å»ºæ–‡ä»¶\n- File.createDirectory()ï¼šåˆ›å»ºæ–‡ä»¶å¤¹\n- File.delete()ï¼šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•\n- File.move()ï¼šç§»åŠ¨æ–‡ä»¶\n- File.copy()ï¼šå¤åˆ¶æ–‡ä»¶\n- File.size()ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸ªæ•°\n- File.read()ï¼šè¯»å–æ–‡ä»¶\n- File.write()ï¼šå†™å…¥æ–‡ä»¶\n\n## 19.ç®€è¿° java é›†åˆä¸­æœ‰å…³æœ‰åºã€æ— åºçš„åŒºåˆ«ï¼Œå¹¶åˆ†åˆ«åˆ—å‡ºå…¶ä¸­çš„å…¸å‹\n\n1. é›†åˆçš„æœ‰åºã€æ— åºæ˜¯æŒ‡æ’å…¥å…ƒç´ æ—¶ï¼Œæ’å…¥çš„é¡ºåºæ€§ï¼Œä¹Ÿå°±æ˜¯å…ˆæ’å…¥çš„å…ƒç´ ä¼˜å…ˆæ”¾åœ¨é›†åˆçš„å‰é¢éƒ¨åˆ†ã€‚\n2. ArrayList æœ‰åºçš„ã€HashMap æ— åºçš„\n\n## 20.ç®€è¿° spring çš„ä¸¤å¤§ç‰¹æ€§\n\n1. Iocï¼šæ§åˆ¶åè½¬ï¼Œå°±æ˜¯å°†æ§åˆ¶æƒä»ç¨‹åºå‘˜äº¤ç”± spring å®¹å™¨æ§åˆ¶\n\n   ä¾‹ï¼šclass A ä¸­è¦ç”¨åˆ° class B ä¸­çš„å¯¹è±¡ï¼Œä¸€èˆ¬æƒ…å†µçš„æƒ…å†µä¸‹æ˜¯åœ¨ A çš„ä»£ç ä¸­ new ä¸€ä¸ª B çš„å¯¹è±¡ã€‚è€Œä½¿ç”¨åˆ°DIæ³¨å…¥åï¼Œåªéœ€è¦åœ¨ A ä¸­å£°æ˜ä¸€ä¸ªç§æœ‰åŒ–çš„ B å¯¹è±¡å°±å¯ä»¥äº†\n\n2. aopï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ¨ªå‘æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼æ¥å®Œæˆä¸€äº›é‡å¤æ€§é«˜çš„æ“ä½œã€‚\n\n   ä¾‹ï¼šæ—¥å¿—ï¼Œäº‹åŠ¡ï¼Œæƒé™ç­‰\n\n## 21.ä»€ä¹ˆæ˜¯æ¥å£ï¼Ÿ\n\nâ€‹\tæ¥å£å°±æ˜¯å®šä¹‰äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¸»è¦æ˜¯å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ï¼Œä½†æ˜¯å…·ä½“æ€ä¹ˆåšæ˜¯ç”±ä»–çš„å®ç°ç±»å®Œæˆçš„ã€‚\n\n## 22.ä»€ä¹ˆæ˜¯æ­»é”ï¼Œäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\n\n1. æ­»é”å¯ä»¥ç†è§£ä¸ºï¼šäº’ç›¸ä¸è®©æ­¥ï¼Œä¸æ”¾å¼ƒï¼ŒåŒæ—¶éœ€è¦å¯¹æ–¹çš„èµ„æºã€‚\n\n   ä¾‹ï¼šä¸¤ä¸ªä»¥ä¸Šçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹æ‰§è¡Œå®Œæ¯•æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¿™æ ·å°±é€ æˆäº†æ— é™ç­‰å¾…ï¼Œä¹Ÿå°±æˆäº†æ­»é”\n\n2. å››ä¸ªå¿…è¦æ¡ä»¶åˆ†åˆ«æ˜¯ï¼š\n\n   - äº’æ–¥ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨\n   - ä¿æŒé”å¹¶è¯·æ±‚é”ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²ç»è·å–åˆ°çš„èµ„æºä¿æŒä¸æ”¾\n   - ä¸å¯æŠ¢å¤ºï¼šè¿›ç¨‹å·²ç»è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œæ˜¯ä¸èƒ½è¢«å¼ºè¡Œå‰¥å¤ºçš„\n   - å¾ªç¯ç­‰å¾…ï¼šè‹¥å¹²çº¿ç¨‹å½¢æˆäº†ä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»\n\n\n\n\n\n\n\n\n\n# äºŒã€å®¹å™¨\n\n## 1.java çš„å¸¸ç”¨å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ\n\nå¸¸ç”¨å®¹å™¨çš„å›¾å½•ï¼š\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](1.jpg)\n\n## 2.Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n- java.util.Collection æ˜¯ä¸€ä¸ªé›†åˆæ¥å£ã€‚ç›´æ¥ç»§æ‰¿ä»–çš„æ¥å£æœ‰ List å’Œ Set\n- Collections æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•ï¼Œç”¨äºé›†åˆä¸­çš„å…ƒç´ æ’åºï¼Œæœç´¢ä»¥åŠçº¿ç¨‹å®‰å…¨ç­‰æ“ä½œã€‚\n\n## 3.Listã€Setã€Mapä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\n\n|    æ¯”è¾ƒ    |                            List                            |                             Set                             |                             Map                              |\n| :--------: | :--------------------------------------------------------: | :---------------------------------------------------------: | :----------------------------------------------------------: |\n|  ç»§æ‰¿æ¥å£  |                         Collection                         |                         Collection                          |                                                              |\n| å¸¸è§å®ç°ç±» | AbstractListï¼ˆå…¶å¸¸ç”¨å­ç±»æœ‰ ArrayListã€LinkedListã€Vectorï¼‰ | AbstractMapï¼ˆå…¶å¸¸ç”¨å­ç±»æœ‰ HashSetã€LinkedHashSetã€TreeSetï¼‰ |                      HashMapã€HashTable                      |\n|  å¸¸è§æ–¹æ³•  |     add()ã€remove()ã€clear() get()ã€contains()ã€size()     |         add()ã€remove()ã€clear() contains()ã€size()         | put()ã€get()ã€remove() clear()ã€containsKey() containsValue()ã€KeySet() values()ã€sizeï¼ˆï¼‰ |\n|    å…ƒç´     |                           å¯é‡å¤                           |                ä¸å¯é‡å¤ï¼ˆç”¨ equals() åˆ¤æ–­ï¼‰                 |                           ä¸å¯é‡å¤                           |\n|    é¡ºåº    |                            æœ‰åº                            |              æ— åºï¼ˆå®é™…ä¸Šæ˜¯ç”± HashCode å†³å®šï¼‰               |                                                              |\n|  çº¿ç¨‹å®‰å…¨  |                      Vector çº¿ç¨‹å®‰å…¨                       |                                                             |                      HashTable çº¿ç¨‹å®‰å…¨                      |\n\n## 4.HashMap å’Œ HashTable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n- HashMap å»æ‰äº† HashTable ä¸­çš„ Contains() æ–¹æ³•ï¼Œä½†æ˜¯åŠ ä¸Šäº† ContainsKey()ã€ContainsValue() æ–¹æ³•ã€‚\n- HashMap æ˜¯åŒæ­¥çš„ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰ï¼ŒHashTable æ˜¯éåŒæ­¥çš„ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ï¼Œæ‰€ä»¥æ•ˆç‡ä¸Š HashTable è¦é«˜äº HashMapã€‚\n- HashMap å…è®¸ç©ºé”®å€¼ï¼Œè€Œ HashTable ä¸å…è®¸ã€‚\n\n\n\n\n\n\n\n\n\n# ä¸‰ã€æ•°æ®åº“ï¼ˆsqlï¼‰\n\n**<font color='red'>æ³¨ï¼šæœ¬éƒ¨åˆ†sqléƒ½å·²ç»è¿›è¡Œå®é™…æµ‹è¯•ï¼Œæ‰€ç”¨æ•°æ®åº“ä¸º MySQLï¼Œå¦‚æœæœ‰ç”¨åˆ°åˆ«çš„æ•°æ®åº“ä¼šæœ‰çº¢è‰²æ ‡æ³¨å‡ºæ¥ã€‚</font>**\n\n## 1.ä¸‹é¢æœ‰ä¸¤å¼ è¡¨ï¼šç”¨æˆ·è¡¨ï¼ˆTable_Userï¼‰ã€è€ƒå‹¤è¡¨ï¼ˆTable_ATtendanceï¼‰\n\n<center>ç”¨æˆ·è¡¨ï¼ˆTable_Userï¼‰</center>\n\n|  ID  | Account | USERNAME |\n| :--: | :-----: | :------: |\n|  1   |   liy   |   æé˜³   |\n|  2   | zhangxw |  å¼ æ™“ä¼Ÿ  |\n|  3   |  liuh   |   åˆ˜å   |\n|  4   |  yangl  |   æ¨æŸ³   |\n|  5   | zhangl  |   å¼ ä¸½   |\n\n<center>è€ƒå‹¤è¡¨ï¼ˆTable_ATtendanceï¼‰</center>\n\n|  ID  | User_ID |        TIME         |\n| :--: | :-----: | :-----------------: |\n|  1   |    2    | 2019-05-04 08:53:24 |\n|  2   |    1    | 2019-05-04 08:55:32 |\n|  3   |    3    | 2019-05-05 08:20:13 |\n|  4   |    2    | 2019-05-05 08:55:33 |\n|  5   |    1    | 2019-05-06 08:57:03 |\n|  6   |    5    | 2019-05-06 08:52:10 |\n|  7   |    4    | 2019-06-01 08:20:14 |\n|  8   |    2    | 2019-05-07 08:45:11 |\n\n**é—®é¢˜ä¸€ï¼šè¯·ç”¨SQLåˆ—å‡ºæ¯ä¸ªç”¨æˆ·æ¯ä¸ªæœˆçš„å‡ºå‹¤ç‡**\n\n```sql\nselect a.*,u.USERNAME,CONCAT(ROUND(count(*)/30*100,2),'%') percent from `1-Attendance` a\nleft JOIN `1-User` u on a.User_ID = u.ID\nGROUP BY a.User_ID,DATE_FORMAT(a.TIME,'%M')\n```\n\n\n\n<center>è¿è¡Œç»“æœ</center>\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](database_sql_1-1.png)\n\n\n\næœ¬é—®é¢˜æ²¡æœ‰ä»€ä¹ˆéš¾ç‚¹ï¼Œå°±æ˜¯åŸºç¡€çš„ count() å‡½æ•°ä¸ group by åˆ†ç»„çš„åº”ç”¨ã€‚\n\næœ¬é¢˜è¿ç”¨åˆ°çš„å‡½æ•°ï¼š\n\n- **CONCAT()**ï¼šç”¨äºå­—ç¬¦ä¸²æ‹¼æ¥ CONCAT(str1,str2,str3,...)ï¼Œè¿”å›çš„ç»“æœæ˜¯æ‹¼æ¥åçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå‚æ•°æ˜¯null åˆ™è¿”å›\n- **ROUND()**ï¼šç”¨äºå¤„ç†å°æ•°ä½ä¿ç•™çš„é—®é¢˜ ROUND(column_name,decimals)ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦è¿›è¡Œå¤„ç†çš„å­—æ®µæˆ–è€…æ•°å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¿ç•™çš„ä½æ•°ã€‚\n\n**é—®é¢˜äºŒï¼šè¯·ç”¨SQLåˆ—å‡ºæ¯æœˆå‡ºå‹¤çš„å‰ä¸¤åå’Œåä¸¤å**\n\n```sql\nselect * from (\n\tselect a.User_ID,DATE_FORMAT(a.TIME,'%m')time,u.USERNAME,ROUND(count(*)/30*100,2) percent from `1-Attendance` a\n\tleft JOIN `1-User` u on a.User_ID = u.ID\n\tGROUP BY a.User_ID,DATE_FORMAT(a.TIME,'%m')\n\tORDER BY TIME\n) aa \nwhere (\n\tselect count(*) from (\n\t\tselect a.User_ID,DATE_FORMAT(a.TIME,'%m') time,u.USERNAME,ROUND(count(*)/30*100,2) percent from `1-Attendance` a\n\t\tleft JOIN `1-User` u on a.User_ID = u.ID\n\t\tGROUP BY a.User_ID,DATE_FORMAT(a.TIME,'%m')\n\t\tORDER BY TIME\n\t)bb\n\twhere bb.time = aa.time and bb.percent >= aa.percent #è·å–å‰ä¸¤ä½\n)<=2\nOR (\n\tselect count(*) from (\n\t\tselect a.User_ID,DATE_FORMAT(a.TIME,'%m') time,u.USERNAME,ROUND(count(*)/30*100,2) percent from `1-Attendance` a\n\t\tleft JOIN `1-User` u on a.User_ID = u.ID\n\t\tGROUP BY a.User_ID,DATE_FORMAT(a.TIME,'%m')\n\t\tORDER BY TIME\n\t)bb\n\twhere bb.time = aa.time and bb.percent <= aa.percent #è·å–åä¸¤ä½\n)<=2\nORDER BY aa.time asc,percent desc\n```\n\n\n\n<center>è¿è¡Œç»“æœ</center>\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](database_sql_1-2.png)\n\n\n\næœ¬äººè®¤ä¸ºè¿™ä¸ªé—®é¢˜è¿˜æ˜¯æœ‰ç‚¹ç»•çš„ï¼Œä¼°è®¡æ˜¯æœ¬äººåŸºç¡€å¤ªå·®çš„é—®é¢˜ã€‚è€Œä¸”åº”è¯¥è¿˜æœ‰æ›´ç®€å•çš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘è¿˜ä¸çŸ¥é“@~@ã€‚è¯·åŒ…æ¶µã€‚ã€‚ã€‚ã€‚\n\nè¿™æ¡ **SQL** ç¼–å†™çš„æ€è·¯ä¸ºï¼š\n\nä½¿ç”¨è‡ªè¿æ¥è¿›è¡Œæ¯”è¾ƒï¼Œå°±æ˜¯åˆ†ä¸ºAã€Bä¸¤ä¸ªè¡¨ã€‚åŠ äº†whereåçš„å­æŸ¥è¯¢æ¡ä»¶åï¼Œå°±æƒ³è±¡æˆåœ¨ A è¡¨åé¢å¤šäº†ä¸€åˆ—count(\\*) ï¼Œbb.percent >= aa.percentï¼Œè¿™ç§æ¯”è¾ƒå°±æ˜¯åœ¨ A è¡¨ä¸­æ’åè¶Šé å‰çš„ count(\\*) çš„å€¼å°±è¶Šå°ã€‚åŒç†å–åä¸¤åå°±æ˜¯ä¸å–å‰ä¸¤åç›¸åã€‚ \n\n\n\n## 2.ä¸‹é¢æœ‰ä¸¤å¼ è¡¨ï¼šç”¨æˆ·è¡¨ï¼ˆTable_Userï¼‰ã€éƒ¨é—¨è¡¨ï¼ˆTable_Departmentï¼‰\n\n<center>ç”¨æˆ·è¡¨ï¼ˆTable_Userï¼‰</center>\n\n|  ID  | ACCOUNT | USERNAME | DEPTID |\n| :--: | :-----: | :------: | :----: |\n|  1   |   liy   |   æé˜³   |   1    |\n|  2   | zhangxw |  å¼ æ™“ä¼Ÿ  |   2    |\n|  3   |  liuh   |   åˆ˜å   |   2    |\n|  4   |  yangl  |   æ¨æŸ³   |   3    |\n|  5   | zhangl  |   å¼ ä¸½   |   4    |\n\n<center>éƒ¨é—¨è¡¨ï¼ˆTable_Departmentï¼‰</center>\n\n|  ID  | DEPTNAME | PARENTID |\n| :--: | :------: | :------: |\n|  1   |  ç¯å«å¤„  |   null   |\n|  2   |  è€ƒæ ¸ç§‘  |    1     |\n|  3   |  ç›‘ç£ç§‘  |    1     |\n|  4   |  æ£€æŸ¥ç§‘  |    1     |\n|  5   |  æ¥å¾…åŠ  |    3     |\n\n**<font color='red'>å‡½æ•°å‚è€ƒåœ°å€ï¼š</font>**[https://www.cnblogs.com/zhizhao/p/9442799.html](https://www.cnblogs.com/zhizhao/p/9442799.html)\n\n**é—®é¢˜ä¸€ï¼šè¯·ç”¨ SQL åˆ—å‡ºâ€œç¯å«å¤„â€ä¸‹å±æ‰€æœ‰éƒ¨é—¨åŠå„è‡ªæˆå‘˜æ•°é‡**\n\næ ¹æ®é—®é¢˜ç†è§£ä¸ºä¸¤ç§çŠ¶å†µï¼š\n\n1ï¼‰åªæŸ¥è¯¢å‡º â€œç¯å«å¤„â€ å­çº§éƒ¨é—¨ï¼Œå°±æ˜¯å‘ä¸‹ä¸€çº§ã€‚\n\n```sql\nselect p.ID,p.DEPTNAME,c.DEPTNAME,c.PARENTID,\n(select count(*) from `2-User` u where u.DEPTID = c.ID) deptcount\nfrom `2-Department` p\njoin `2-Department` c on p.ID = c.PARENTID\nwhere p.DEPTNAME = 'ç¯å«å¤„'\n```\n\n\n\n<center>è¿è¡Œç»“æœ</center>\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](database_sql_2-1.1.png)\n\n\n\nè¿™é‡Œå°±æ˜¯ç®€å•è‡ªè¿æ¥æŸ¥è¯¢ï¼ŒåŸºç¡€è¯­å¥ã€‚\n\n2ï¼‰æŸ¥è¯¢å‡º â€œç¯å«å¤„â€ æ‰€æœ‰è‡ªå·±éƒ¨é—¨ï¼ˆéœ€è‡ªå·±åˆ›å»ºé€’å½’å‡½æ•°ï¼‰\n\n<center>åˆ›å»ºé€’å½’å‡½æ•°</center>\n\n```sql\ndelimiter //\nDROP FUNCTION IF EXISTS `2-getChildList`;\nCREATE FUNCTION `2-getChildList`(rootId INT)\nRETURNS VARCHAR(1000)\n\nBEGIN\n\tDECLARE sTemd VARCHAR(1000);\n\tDECLARE sTemdChd VARCHAR(1000);\n\tSET sTemd = '$';\n\tSet sTemdChd = CAST(rootId AS CHAR);\n\t\n\tWHILE sTemdChd is not null DO\n\t\tset sTemd = CONCAT(sTemd,',',sTemdChd);\n\t\tselect GROUP_CONCAT(id) INTO sTemdChd from `2-Department` where FIND_IN_SET(PARENTID,sTemdChd)>0;\n\t\tEND WHILE;\n\tRETURN sTemd;\nEND\n```\n\n\n\n<center>æŸ¥è¯¢ SQL</center>\n\n```sql\nselect * ,\n(select count(*) from `2-User` u where u.DEPTID = d.ID) deptcount\nfrom `2-Department` d where FIND_IN_SET(id,`2-getChildList`(1));\n```\n\n\n\n<center>æŸ¥è¯¢ç»“æœ</center>\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](database_sql_2-1.2.png)\n\n\n\nè¿™ä¸ªé—®é¢˜æ­£å¸¸æ¥è¯´ç¬¬äºŒç§çŠ¶å†µæ‰æ˜¯å¯¹äºæœ¬é¢˜ç›®æ­£ç¡®çš„ç†è§£ã€‚\n\næˆ‘è®¤ä¸ºè¿™é‡Œçš„éš¾ç‚¹åœ¨äºè¿™ä¸ªé€’å½’å‡½æ•°ï¼ˆå…¶å®ç†è§£ä¹‹åä½ ä¼šå‘ç°è¿™ä¸ªå‡½æ•°æ˜¯çœŸçš„æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡çš„ï¼Œåªä¸è¿‡æˆ‘å¹³å¸¸æ¶‰åŠæ•°æ®åº“çš„è¿˜æ˜¯æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥æ„Ÿè§‰æœ‰ç‚¹éš¾åº¦ï¼Œä½†æ˜¯ç†è§£ä¹‹åå°±å¥½äº†ã€‚ï¼‰ï¼Œå…¶å®è¿™ä¸ªé€’å½’å‡½æ•° copy èµ°æ”¹ä¸€æ”¹å°±å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³æå‡è‡ªå·±ï¼Œä»¥é˜²ä»¥åé‡åˆ°ä¸€ç‚¹éƒ½è¯´ä¸ä¸Šæ¥ã€‚è¿˜æ˜¯å»ºè®®æŠŠè¿™ä¸ªå‡½æ•°ç†è§£é€ã€‚\n\næœ¬é¢˜è¿ç”¨åˆ°çš„å‡½æ•°ï¼š\n\n- **GROUP_CONCAT(column_name)**ï¼šå¤šè¡Œæ•°æ®åˆå¹¶\n\n- **FIND_IN_SET(param1,param2)**ï¼šæŸ¥è¯¢ para2 ä¸­åŒ…å« param1 çš„ç»“æœï¼Œè¿”å› null æˆ–è€… è®°å½•ã€‚è¯¦ç»†å¯æŸ¥çœ‹ï¼š[https://www.cnblogs.com/lixinjun8080/p/11246632.html](https://www.cnblogs.com/lixinjun8080/p/11246632.html)\n\nå…¶å®ç†è§£äº†å‡½æ•°ä¸­çš„é‚£ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ•´ä¸ªå‡½æ•°ä¹Ÿå°±å·®ä¸å¤šäº†ã€‚\n\n**é—®é¢˜äºŒï¼šè¯·ç”¨ SQL åˆ—å‡ºâ€œç¯å«å¤„â€ä¸‹å±æ‰€æœ‰éƒ¨é—¨ä¸­æˆå‘˜æ•°é‡æœ€å¤šçš„ä¸¤ä¸ªéƒ¨é—¨**\n\nå…¶å®è¿™ä¸ªé—®é¢˜æˆ‘ä¸ªäººç†è§£ä¹Ÿæ˜¯ä¸¤ç§ï¼š\n\n1ï¼‰ä¸è€ƒè™‘å¹¶åˆ—æƒ…å†µï¼Œè¿™ç§å°±å¾ˆç®€å•ç›´æ¥åœ¨é—®é¢˜ä¸€çš„åŸºç¡€ä¸Šå¢åŠ  order by æ’åºå’Œ limit å°±å¯ä»¥äº†ã€‚æ‰€ä»¥å°±ä¸åˆ—å‡ºæ­¤ç§æƒ…å†µäº†ã€‚\n\n2ï¼‰è€ƒè™‘å¹¶åˆ—çš„æƒ…å†µï¼Œæˆ‘ä¸ªäººè®¤ä¸ºåº”è¯¥æŠŠå¹¶åˆ—çš„æƒ…å†µä¹Ÿè€ƒè™‘è¿›å»ã€‚\n\n<center>æŸ¥è¯¢ SQL </center>\n\n```sql\nselect * from (\n\tselect d.* ,\n\t(select count(*) from `2-User` u where u.DEPTID = d.ID) deptcount\n\tfrom `2-Department` d where FIND_IN_SET(id,`2-getChildList`(1))\n) b\nwhere FIND_IN_SET(\n\tb.deptcount,\n    (\n    \tselect GROUP_CONCAT(deptcount) from \n        (\n        \tselect d.* ,\n\t\t\t(select count(*) from `2-User` u where u.DEPTID = d.ID) deptcount\n\t\t\tfrom `2-Department` d where FIND_IN_SET(id,`2-getChildList`(1))\n\t\t\tGROUP BY deptcount\n\t\t\tORDER BY deptcount desc\n\t\t\tLIMIT 2\n        )a\n    )\n)\n```\n\n\n\n<center>è¿è¡Œç»“æœ</center>\n\n![å›¾ç‰‡åŠ è½½å¤±è´¥](database_sql_2-2.png)\n\nå…¶å®è¿™æ¡sqléš¾åº¦ä¹Ÿä¸é«˜ï¼Œåªè¦ä½ ä¸€æ­¥ä¸€æ­¥æ¥å°±å¯ä»¥äº†ã€‚\n\nå¤§æ¦‚æ€è·¯å¦‚ä¸‹ï¼š\n\n1. å°† â€œé—®é¢˜ä¸€â€ ä¸­çš„æŸ¥è¯¢è¯­å¥å¢åŠ åˆ†ç»„ï¼Œæ’åºï¼Œå¹¶ç”¨æ—¶ç”¨ limitï¼Œè·å–åˆ°å‰ä¸¤åã€‚\n\n   ```sql\n   select d.* ,\n   (select count(*) from `2-User` u where u.DEPTID = d.ID) deptcount\n   from `2-Department` d where FIND_IN_SET(id,`2-getChildList`(1))\n   GROUP BY deptcount\n   ORDER BY deptcount desc\n   LIMIT 2\n   ```\n\n   \n\n2. å°† 1 ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†ä½œä¸ºä¸€å¼ ä¸´æ—¶è¡¨æŸ¥è¯¢ï¼Œä½¿ç”¨ group_concat() å‡½æ•°å°† 1 ä¸­çš„çš„äººæ•°åˆå¹¶èµ·æ¥ã€‚å…¶å®å°±æ˜¯å°†å‰ä¸¤åçš„äººæ•°æŸ¥è¯¢å‡ºæ¥ï¼Œåˆå¹¶æˆ 2,1 è¿™ç§å½¢å¼ã€‚\n\n   ```sql\n   select GROUP_CONCAT(deptcount) from \n   (\n       select d.* ,\n   \t(select count(*) from `2-User` u where u.DEPTID = d.ID) deptcount\n   \tfrom `2-Department` d where FIND_IN_SET(id,`2-getChildList`(1))\n   \tGROUP BY deptcount\n   \tORDER BY deptcount desc\n   \tLIMIT 2\n   )a\n   ```\n\n   \n\n3. ä»¥ â€œé—®é¢˜ä¸€â€ ä¸­çš„æŸ¥è¯¢çš„ç»“æœé›†ä½œä¸ºä¸´æ—¶è¡¨ï¼Œæ¡ä»¶ä½¿ç”¨ FIND_IN_SET() å‡½æ•°è¿›è¡Œæ§åˆ¶ã€‚FIND_IN_SET() å‡½æ•°å‡½æ•°ä¸­çš„å‚æ•°å°±æ˜¯ï¼šä¸»è¡¨ä¸­çš„äººæ•°ã€å’Œ 2 ä¸­çš„è¯­å¥ã€‚åˆ°æ­¤æœ¬é—®é¢˜å°±ç»“æŸäº†\n\n   ```sql\n   select * from (\n   \tselect d.* ,\n   \t(select count(*) from `2-User` u where u.DEPTID = d.ID) deptcount\n   \tfrom `2-Department` d where FIND_IN_SET(id,`2-getChildList`(1))\n   ) b\n   where FIND_IN_SET(\n   \tb.deptcount,\n       (\n       \tselect GROUP_CONCAT(deptcount) from \n           (\n           \tselect d.* ,\n   \t\t\t(select count(*) from `2-User` u where u.DEPTID = d.ID) deptcount\n   \t\t\tfrom `2-Department` d where FIND_IN_SET(id,`2-getChildList`(1))\n   \t\t\tGROUP BY deptcount\n   \t\t\tORDER BY deptcount desc\n   \t\t\tLIMIT 2\n           )a\n       )\n   )\n   ```\n\n   \n\n<font color='red'>æ­¤å¤„è¿ç”¨åˆ°çš„å‡½æ•°éƒ½åœ¨ â€œé—®é¢˜ä¸€â€ ä¸­è§£é‡Šè¿‡ã€‚å¦‚æœæœ‰ç–‘é—®å°±çœ‹çœ‹ â€œé—®é¢˜ä¸€â€Â  ä¸­çš„è§£é‡Šå§ã€‚</font>\n\n\n\n**æœªå®Œå¾…ç»­**","tags":["Java é¢è¯•"],"categories":["Java é¢è¯•é¢˜"]},{"title":"å¼€å§‹åšå®¢çš„ç¬¬ä¸€å¤©","url":"/2020/07/16/BlogOneDay/","content":"ã€€ã€€**æ³¨**ï¼šå‚è€ƒæ–‡æ¡£è¿˜æœ‰ä¸‹è½½é“¾æ¥éƒ½é™„åœ¨æœ¬æ–‡æœ«å°¾ã€‚\n\nã€€ã€€è¿™ç¯‡æ–‡ç« åªæ˜¯è¯´æ˜ï¼Œæˆ‘æ˜¯ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹å†™åšå®¢ã€ä¸ºä»€ä¹ˆå†™ã€å‚è€ƒé‚£äº›æ–‡æ¡£å†™çš„ï¼Œè‡³äºæ€ä¹ˆæ­å»ºæˆ‘å°±ä¸è¯´äº†ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªåšå®¢å°ç™½ï¼Œç°åœ¨çš„æ–‡æ¡£éƒ½å¾ˆå…¨é¢ï¼Œå°±ä¸è€½è¯¯å„ä½äº†ã€‚\n\n<!-- more -->\n\nã€€ã€€2020å¹´5æœˆ1æ—¥æ˜¯æˆ‘å¼€å§‹å†™åšå®¢çš„ç¬¬ä¸€å¤©ï¼Œå½“ç„¶ä¹Ÿæ˜¯åœ¨ä»Šå¤©å¼€å§‹å­¦ä¹ æ€ä¹ˆå†™åšå®¢çš„ã€‚å› ä¸ºç›®å‰æ­£åœ¨æ‰¾å·¥ä½œï¼Œåœ¨åˆšå¼€å§‹æ‰¾å·¥ä½œçš„æ—¶å€™å°±æƒ³æ­å»ºä¸€ä¸ªåšå®¢æ¥è®°å½•æˆ‘çš„æˆé•¿å†ç¨‹ã€‚\n\nã€€ã€€å…¶å®å¾ˆæ—©å°±æƒ³å†™ä¸€ä¸ªåšå®¢äº†ï¼Œä½†æ˜¯ç”±äºæˆ‘å±äºä¸€æ—¶çƒ­è¡€çš„é‚£ç§äººï¼Œæ‰€ä»¥è¿™ä¸ªäº‹æƒ…ä¹Ÿæ˜¯ä¸€æ‹–å†æ‹–ï¼Œäºæ˜¯æ‹–åˆ°äº†ä»Šå¤©ã€‚è‡³äºæˆ‘ä¸ºä»€ä¹ˆå†™åšå®¢ï¼Œä¸€å¼€å§‹æ˜¯å› ä¸ºé¢è¯•é¢˜æ€»æ˜¯èƒŒä¸ä¸‹æ¥ï¼Œä»Šå¤©èƒŒï¼Œæ˜å¤©å°±å¿˜äº†ä¸€åŠé‚£ç§ã€‚åæ¥æƒ³è‡ªå·±æ­å»ºä¸ªåšå®¢å§ï¼ŒæŠŠçœ‹è¿‡çš„é¢è¯•é¢˜ä»¥è‡ªå·±ç†è§£çš„æ–¹å¼è®°å½•åœ¨åšå®¢ä¸­ã€‚åŒæ—¶ï¼Œä¹Ÿä¼šåœ¨åšå®¢ä¸­è®°å½•æˆ‘å¯¹äºæŠ€æœ¯çš„å­¦ä¹ ã€‚å…³äºä¸ºä»€ä¹ˆä¼šåœ¨ä»Šå¤©å¼€å§‹è¡ŒåŠ¨æ˜¯å› ä¸ºï¼Œä¹‹å‰åœ¨åˆ·æŠ–éŸ³çš„æ—¶å€™ï¼Œå…³æ³¨äº†ä¸€ä¸ªæŠ€æœ¯å¤§ä½¬ï¼Œå°±åœ¨ä»Šå¤©æ—©ä¸Šåˆ·åˆ°äº†ä»–æ›´æ–°çš„è§†é¢‘ï¼Œæ­£å¥½æœ€è¿‘è¿™å‡ å¤©ä¸€ç›´åœ¨æƒ³æ€ä¹ˆæå‡è‡ªå·±ï¼Œä½†æ˜¯è‡ªå·±ä¸çŸ¥é“è¯¥æ€ä¹ˆå­¦ï¼Œæ‰€ä»¥ç»™ä»–å‘äº†ä¸€æ¡ç§ä¿¡ï¼Œå’¨è¯¢äº†ä»–æˆ‘è¯¥å­¦ä»€ä¹ˆï¼Œè¯¥æ€ä¹ˆå­¦ï¼Œè®©ä»–ç»™æˆ‘æ¨èä¸¤æœ¬ä¹¦ã€‚å¾ˆå¹¸è¿çš„æ˜¯ä»–å›å¤æˆ‘äº†ï¼Œæˆ‘åŠ äº†ä»–çš„å¾®ä¿¡ï¼Œå’Œä»–è¯´äº†ä¸€ä¸‹æˆ‘ç›®å‰çš„çŠ¶å†µã€‚ä»–ä¹Ÿç»™æˆ‘æäº†ä¸€äº›æ„è§ï¼Œä¹Ÿç»™æˆ‘æ¨èäº†ä¸¤æœ¬ä¹¦ï¼Œè¿˜è¯´çœ‹ä¹¦çš„è¯æœ€å¥½æ˜¯å¤šçœ‹å‡ éï¼Œè€Œä¸”çœ‹ä¹¦çš„æ—¶å€™ä¹Ÿè¦å®ç”¨åˆ°ä»£ç ä¸­ï¼Œå¹¶å†™ä¸€ä¸ªåšå®¢æ¥è®°å½•è‡ªå·±å­¦åˆ°äº†ä»€ä¹ˆã€‚æ‰€ä»¥ï¼Œåœ¨ä»Šå¤©ä¸­åˆå¼€å§‹äº†ç ”ç©¶åšå®¢çš„è·¯ç¨‹ã€‚\n\nã€€ã€€æ­å»ºåšå®¢ä½¿ç”¨çš„æ˜¯ã€€**github+Hexo**ï¼Œå½“ç„¶è‚¯å®šè¦ç”¨åˆ°çš„å°±æ˜¯ **markdown**ï¼Œæˆ‘å†™ **markdown** ä½¿ç”¨çš„å·¥å…·æ˜¯ **Typora** \n\nã€€ã€€12æ­å»ºåšå®¢å‚è€ƒçš„æ–‡æ¡£æˆ‘åœ¨ä¸‹æ–¹å°±å†™äº†ä¸€ä¸ªï¼Œå› ä¸ºé‡åˆ°é—®é¢˜ä¼šç™¾åº¦ï¼Œçœ‹è¿‡ä¹‹åå°±å…³é—­äº†ï¼Œè€Œä¸”å‚è€ƒäº†å¾ˆå¤šã€‚æ‰€ä»¥å°±ä¸ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥äº†ã€‚\n\n<font color=red>**æŠ–éŸ³å¤§ä½¬**ï¼šå¤§çŒ¿å‘å‰å†²ï¼ŒæŠ–éŸ³å·ï¼šdyxqcã€‚å¾®ä¿¡å·æˆ‘å°±ä¸çˆ†äº†</font>\n\nTypora å®˜ç½‘ windows 64ä½ç¨‹åºä¸‹è½½åœ°å€ï¼š[https://www.typora.io/#windows](https://www.typora.io/#windows)\n\næ­å»ºåšå®¢å‚è€ƒæ–‡æ¡£ï¼š[https://www.jianshu.com/p/189fd945f38f](https://www.jianshu.com/p/189fd945f38f)\n\nåšå®¢ä½¿ç”¨çš„æ¨¡æ¿ï¼š[https://liuyib.github.io/reprint/](https://liuyib.github.io/reprint/)\n\næ¨¡æ¿ github åœ°å€ï¼š[https://github.com/liuyib/hexo-theme-stun](https://github.com/liuyib/hexo-theme-stun)\n\næ¨¡æ¿ä½¿ç”¨æ–‡æ¡£ï¼š[https://liuyib.github.io/hexo-theme-stun/zh-CN/](https://liuyib.github.io/hexo-theme-stun/zh-CN/)\n"}]